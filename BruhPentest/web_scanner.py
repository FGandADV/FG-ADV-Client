import base64;exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBzb2NrZXQKaW1wb3J0IHJlCmltcG9ydCB0aW1lCmltcG9ydCByZXF1ZXN0cwppbXBvcnQganNvbgppbXBvcnQgaGFzaGxpYgppbXBvcnQgc3NsCmltcG9ydCBiYXNlNjQKaW1wb3J0IHRocmVhZGluZwppbXBvcnQgcXVldWUKaW1wb3J0IHVybGxpYjMKaW1wb3J0IGRucy5yZXNvbHZlcgppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZSwgcGFyc2VfcXMsIHVybGpvaW4sIHF1b3RlLCB1bnF1b3RlCmZyb20gY29uY3VycmVudC5mdXR1cmVzIGltcG9ydCBUaHJlYWRQb29sRXhlY3V0b3IKZnJvbSBiczQgaW1wb3J0IEJlYXV0aWZ1bFNvdXAKZnJvbSBCcnVoUGVudGVzdC51dGlscyBpbXBvcnQgZ2V0X3JhbmRvbV91c2VyX2FnZW50LCBBRE1JTl9QQU5FTFMsIEpVSUNZX0ZJTEVTLCBKU19QQVRIUywgU1VCX0RPTUFJTlMKCnVybGxpYjMuZGlzYWJsZV93YXJuaW5ncyh1cmxsaWIzLmV4Y2VwdGlvbnMuSW5zZWN1cmVSZXF1ZXN0V2FybmluZykKCgpjbGFzcyBXZWJTY2FubmVyOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYuc2VzcyA9IHJlcXVlc3RzLlNlc3Npb24oKQogICAgICAgIHNlbGYuc2Vzcy5oZWFkZXJzLnVwZGF0ZSh7J1VzZXItQWdlbnQnOiBnZXRfcmFuZG9tX3VzZXJfYWdlbnQoKX0pCgogICAgZGVmIGhpdF9lbmRwb2ludChzZWxmLCB1cmwsIG1ldGhvZD0iR0VUIiwgZGF0YT1Ob25lLCBoZWFkZXJzPU5vbmUsIGZvbGxvd19yZWRpcmVjdHM9VHJ1ZSwgdmVyaWZ5PUZhbHNlLCB0aW1lb3V0PTEwKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGJyb3dzZXIgPSB7J1VzZXItQWdlbnQnOiBnZXRfcmFuZG9tX3VzZXJfYWdlbnQoKX0KICAgICAgICAgICAgaWYgaGVhZGVyczoKICAgICAgICAgICAgICAgIGJyb3dzZXIudXBkYXRlKGhlYWRlcnMpCgogICAgICAgICAgICBpZiBtZXRob2QudXBwZXIoKSA9PSAiR0VUIjoKICAgICAgICAgICAgICAgIHJlc3AgPSBzZWxmLnNlc3MuZ2V0KAogICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWJyb3dzZXIsCiAgICAgICAgICAgICAgICAgICAgYWxsb3dfcmVkaXJlY3RzPWZvbGxvd19yZWRpcmVjdHMsCiAgICAgICAgICAgICAgICAgICAgdmVyaWZ5PXZlcmlmeSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxpZiBtZXRob2QudXBwZXIoKSA9PSAiUE9TVCI6CiAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5zZXNzLnBvc3QoCiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIGRhdGE9ZGF0YSwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWJyb3dzZXIsCiAgICAgICAgICAgICAgICAgICAgYWxsb3dfcmVkaXJlY3RzPWZvbGxvd19yZWRpcmVjdHMsCiAgICAgICAgICAgICAgICAgICAgdmVyaWZ5PXZlcmlmeSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxpZiBtZXRob2QudXBwZXIoKSA9PSAiSEVBRCI6CiAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5zZXNzLmhlYWQoCiAgICAgICAgICAgICAgICAgICAgdXJsLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM9YnJvd3NlciwKICAgICAgICAgICAgICAgICAgICBhbGxvd19yZWRpcmVjdHM9Zm9sbG93X3JlZGlyZWN0cywKICAgICAgICAgICAgICAgICAgICB2ZXJpZnk9dmVyaWZ5LAogICAgICAgICAgICAgICAgICAgIHRpbWVvdXQ9dGltZW91dAogICAgICAgICAgICAgICAgKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgICAgIHJldHVybiByZXNwCiAgICAgICAgZXhjZXB0IHJlcXVlc3RzLlJlcXVlc3RFeGNlcHRpb246CiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGdldF9zZXJ2ZXJfaW5mbyhzZWxmLCB1cmwpOgogICAgICAgIHJlc3AgPSBzZWxmLmhpdF9lbmRwb2ludCh1cmwsIG1ldGhvZD0iSEVBRCIpCiAgICAgICAgaW5mbyA9IHt9CgogICAgICAgIGlmIHJlc3A6CiAgICAgICAgICAgIGhkcnMgPSByZXNwLmhlYWRlcnMKICAgICAgICAgICAgaW5mb1sic3RhdHVzX2NvZGUiXSA9IHJlc3Auc3RhdHVzX2NvZGUKICAgICAgICAgICAgaW5mb1sic2VydmVyIl0gPSBoZHJzLmdldCgiU2VydmVyIiwgItCd0LUg0L3QsNC50LTQtdC90L4iKQogICAgICAgICAgICBpbmZvWyJ4X3Bvd2VyZWRfYnkiXSA9IGhkcnMuZ2V0KCJYLVBvd2VyZWQtQnkiLCAi0J3QtSDQvdCw0LnQtNC10L3QviIpCiAgICAgICAgICAgIGluZm9bImNvbnRlbnRfdHlwZSJdID0gaGRycy5nZXQoIkNvbnRlbnQtVHlwZSIsICLQndC1INC90LDQudC00LXQvdC+IikKCiAgICAgICAgcmV0dXJuIGluZm8KCiAgICBkZWYgY2hlY2tfcm9ib3RzX3R4dChzZWxmLCB1cmwpOgogICAgICAgIHJvYm90c191cmwgPSB1cmxqb2luKHVybCwgIi9yb2JvdHMudHh0IikKICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQocm9ib3RzX3VybCkKCiAgICAgICAgaWYgcmVzcCBhbmQgcmVzcC5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgIGxpbmVzID0gcmVzcC50ZXh0LnNwbGl0KCdcbicpCiAgICAgICAgICAgIGRpc2FsbG93ZWQgPSBbbGluZS5zcGxpdCgnOiAnKVsxXS5zdHJpcCgpIGZvciBsaW5lIGluIGxpbmVzIGlmIGxpbmUubG93ZXIoKS5zdGFydHN3aXRoKCdkaXNhbGxvdzonKV0KICAgICAgICAgICAgcmV0dXJuIGRpc2FsbG93ZWQKCiAgICAgICAgcmV0dXJuIFtdCgogICAgZGVmIGNoZWNrX3dhZihzZWxmLCB1cmwpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcGF5bG9hZHMgPSBbCiAgICAgICAgICAgICAgICAiP2lkPTEnIiwKICAgICAgICAgICAgICAgICI/aWQ9MStBTkQrMT0xIiwKICAgICAgICAgICAgICAgICI/cT08c2NyaXB0PmFsZXJ0KDEpPC9zY3JpcHQ+IiwKICAgICAgICAgICAgICAgICI/cT0xKi9PUkRFUi8qKi9CWS8qKi8xLS0iLAogICAgICAgICAgICAgICAgIj9zPS4uLy4uLy4uLy4uLy4uL2V0Yy9wYXNzd2QiCiAgICAgICAgICAgIF0KCiAgICAgICAgICAgIGZvciBwYXlsb2FkIGluIHBheWxvYWRzOgogICAgICAgICAgICAgICAgdGVzdF91cmwgPSB1cmwgKyBwYXlsb2FkCiAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQodGVzdF91cmwpCgogICAgICAgICAgICAgICAgaWYgcmVzcCBhbmQgcmVzcC5zdGF0dXNfY29kZSA9PSA0MDM6CiAgICAgICAgICAgICAgICAgICAgaGRycyA9IHJlc3AuaGVhZGVycwogICAgICAgICAgICAgICAgICAgIGZvciBoZHIgaW4gaGRyczoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYW55KHdhZiBpbiBoZHIubG93ZXIoKSBvciB3YWYgaW4gc3RyKGhkcnNbaGRyXSkubG93ZXIoKSBmb3Igd2FmIGluCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBbImNsb3VkZmxhcmUiLCAiYWthbWFpIiwgImluY2Fwc3VsYSIsICJzdWN1cmkiLCAiaW1wZXJ2YSIsICJkaXN0aWwiXSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSBXQUYg0L3QsNC50LTQtdC9OiB7aGRyfToge2hkcnNbaGRyXX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICAgICAgICAgICAgICAgICAgYm9keSA9IHJlc3AudGV4dC5sb3dlcigpCiAgICAgICAgICAgICAgICAgICAgd2FmX3BocmFzZXMgPSBbImJsb2NrZWQiLCAiZmlyZXdhbGwiLCAicHJvdGVjdGlvbiIsICJzZWN1cml0eSIsICJmb3JiaWRkZW4iLCAid2FmIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZGV0ZWN0ZWQgYXR0YWNrIl0KICAgICAgICAgICAgICAgICAgICBpZiBhbnkocGhyYXNlIGluIGJvZHkgZm9yIHBocmFzZSBpbiB3YWZfcGhyYXNlcyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdIFdBRiDQvtCx0L3QsNGA0YPQttC10L0g0LIg0L7RgtCy0LXRgtC1IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKCiAgICAgICAgICAgIHByaW50KGYiWytdIFdBRiDQvdC1INC+0LHQvdCw0YDRg9C20LXQvSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDQv9GA0L7QstC10YDQutC1IFdBRjoge3N0cihlKX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgZmluZF9zdWJkb21haW5zKHNlbGYsIGRvbWFpbiwgbWF4X3N1YmRvbWFpbnM9NTApOgogICAgICAgIGZvdW5kX3N1YnMgPSBzZXQoKQoKICAgICAgICBmb3Igc3ViIGluIFNVQl9ET01BSU5TWzptYXhfc3ViZG9tYWluc106CiAgICAgICAgICAgIHVybCA9IGYiaHR0cDovL3tzdWJ9Lntkb21haW59IgoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHVybCwgdGltZW91dD01KQogICAgICAgICAgICAgICAgaWYgcmVzcDoKICAgICAgICAgICAgICAgICAgICBmb3VuZF9zdWJzLmFkZChmIntzdWJ9Lntkb21haW59IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQn9C+0LTQtNC+0LzQtdC9INC90LDQudC00LXQvToge3N1Yn0ue2RvbWFpbn0iKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCgogICAgICAgIHJldHVybiBsaXN0KGZvdW5kX3N1YnMpCgogICAgZGVmIHNjYW5fZGlycyhzZWxmLCB1cmwpOgogICAgICAgIGNvbW1vbl9kaXJzID0gWwogICAgICAgICAgICAiYWRtaW4iLCAibG9naW4iLCAid3AtYWRtaW4iLCAiY3BhbmVsIiwgInBocG15YWRtaW4iLAogICAgICAgICAgICAiYWRtaW5pc3RyYXRvciIsICJ3ZWJhZG1pbiIsICJhZG1pbmRhc2hib2FyZCIsICJ3cC1sb2dpbiIsCiAgICAgICAgICAgICJ1c2VyIiwgIm1hbmFnZXIiLCAibWFuYWdlbWVudCIsICJzaXRlIiwgImJhY2t1cCIsICJiYWNrdXBzIiwKICAgICAgICAgICAgImNtcyIsICJjb250cm9sIiwgInBhbmVsIiwgImNvbnNvbGUiLCAiYXBpIiwgImFwaXMiLAogICAgICAgICAgICAidXBsb2FkIiwgInVwbG9hZHMiLCAiZG93bmxvYWQiLCAiZG93bmxvYWRzIiwgImNvbnRlbnQiLAogICAgICAgICAgICAid3AtY29udGVudCIsICJpbWFnZXMiLCAiaW1nIiwgInN0YXRpYyIsICJhc3NldHMiLCAianMiLAogICAgICAgICAgICAiY3NzIiwgInN0eWxlcyIsICJpbmNsdWRlcyIsICJpbmMiLCAidmVuZG9yIiwgImNvbmZpZyIsCiAgICAgICAgICAgICJjb25maWd1cmF0aW9uIiwgInNldHVwIiwgImluc3RhbGwiLCAiZGIiLCAiZGF0YWJhc2UiLAogICAgICAgICAgICAic3FsIiwgImRhdGEiLCAidGVtcCIsICJ0bXAiLCAidGVzdCIsICJ0ZXN0cyIsICJkZXYiLAogICAgICAgICAgICAiZGV2ZWxvcG1lbnQiLCAicHJvZCIsICJwcm9kdWN0aW9uIiwgInN0YWdlIiwgInN0YWdpbmciCiAgICAgICAgXQoKICAgICAgICBmb3VuZF9kaXJzID0gW10KCiAgICAgICAgZm9yIGQgaW4gY29tbW9uX2RpcnM6CiAgICAgICAgICAgIGRpcl91cmwgPSB1cmxqb2luKHVybCwgZCArICIvIikKICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KGRpcl91cmwsIG1ldGhvZD0iSEVBRCIsIGZvbGxvd19yZWRpcmVjdHM9RmFsc2UpCgogICAgICAgICAgICBpZiBub3QgcmVzcDoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBpZiByZXNwLnN0YXR1c19jb2RlIGluIFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF06CiAgICAgICAgICAgICAgICByZWRpcl91cmwgPSByZXNwLmhlYWRlcnMuZ2V0KCdMb2NhdGlvbicsICcnKQogICAgICAgICAgICAgICAgaWYgcmVkaXJfdXJsIGFuZCBub3QgKHJlZGlyX3VybCA9PSAnLycgb3IgcmVkaXJfdXJsID09IHVybCBvciByZWRpcl91cmwgPT0gdXJsICsgJy8nKToKICAgICAgICAgICAgICAgICAgICBmb3VuZF9kaXJzLmFwcGVuZChkaXJfdXJsKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCa0LDRgtCw0LvQvtCzINC90LDQudC00LXQvToge2Rpcl91cmx9ICh7cmVzcC5zdGF0dXNfY29kZX0gLT4ge3JlZGlyX3VybH0pIikKICAgICAgICAgICAgZWxpZiByZXNwLnN0YXR1c19jb2RlIGluIFsyMDAsIDQwMSwgNDAzXToKICAgICAgICAgICAgICAgIGlmIHJlc3Auc3RhdHVzX2NvZGUgaW4gWzQwMSwgNDAzXToKICAgICAgICAgICAgICAgICAgICBmb3VuZF9kaXJzLmFwcGVuZChkaXJfdXJsKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCX0LDRidC40YnQtdC90L3Ri9C5INC60LDRgtCw0LvQvtCzINC90LDQudC00LXQvToge2Rpcl91cmx9ICh7cmVzcC5zdGF0dXNfY29kZX0pIikKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgaXNfZGlyID0gVHJ1ZQoKICAgICAgICAgICAgICAgICAgICBpZiBkIGluIFsiaW1hZ2VzIiwgImltZyIsICJjc3MiLCAianMiLCAiYXNzZXRzIiwgInN0YXRpYyJdOgogICAgICAgICAgICAgICAgICAgICAgICBpc19kaXIgPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZnVsbF9yZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQoZGlyX3VybCkKICAgICAgICAgICAgICAgICAgICAgICAgaWYgZnVsbF9yZXNwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IGZ1bGxfcmVzcC50ZXh0IG9yIGxlbihmdWxsX3Jlc3AudGV4dCkgPCAxMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfZGlyID0gRmFsc2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgJz5JbmRleCBvZicgaW4gZnVsbF9yZXNwLnRleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNfZGlyID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiAnbm90IGZvdW5kJyBpbiBmdWxsX3Jlc3AudGV4dC5sb3dlcigpIG9yICc0MDQnIGluIGZ1bGxfcmVzcC50ZXh0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzX2RpciA9IEZhbHNlCgogICAgICAgICAgICAgICAgICAgIGlmIGlzX2RpcjoKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfZGlycy5hcHBlbmQoZGlyX3VybCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbK10g0JrQsNGC0LDQu9C+0LMg0L3QsNC50LTQtdC9OiB7ZGlyX3VybH0gKHtyZXNwLnN0YXR1c19jb2RlfSkiKQoKICAgICAgICByZXR1cm4gZm91bmRfZGlycwoKICAgIGRlZiBmaW5kX2FkbWluX3BhbmVscyhzZWxmLCB1cmwpOgogICAgICAgIGJhc2UgPSB1cmwucnN0cmlwKCcvJykKICAgICAgICBkb21haW4gPSB1cmxwYXJzZSh1cmwpLm5ldGxvYwoKICAgICAgICBmb3VuZF9wYW5lbHMgPSBbXQoKICAgICAgICBmb3IgcGFuZWwgaW4gQURNSU5fUEFORUxTOgogICAgICAgICAgICBwYW5lbF91cmwgPSB1cmxqb2luKGJhc2UsIHBhbmVsKQogICAgICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQocGFuZWxfdXJsLCBtZXRob2Q9IkhFQUQiLCBmb2xsb3dfcmVkaXJlY3RzPUZhbHNlKQoKICAgICAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgcmVzcC5zdGF0dXNfY29kZSBpbiBbMjAwLCA0MDEsIDQwM106CiAgICAgICAgICAgICAgICBmb3VuZF9wYW5lbHMuYXBwZW5kKHBhbmVsX3VybCkKICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCQ0LTQvNC40L3QutCwINC90LDQudC00LXQvdCwOiB7cGFuZWxfdXJsfSAoe3Jlc3Auc3RhdHVzX2NvZGV9KSIpCiAgICAgICAgICAgIGVsaWYgcmVzcC5zdGF0dXNfY29kZSBpbiBbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdOgogICAgICAgICAgICAgICAgcmVkaXJfdXJsID0gcmVzcC5oZWFkZXJzLmdldCgnTG9jYXRpb24nLCAnJykKICAgICAgICAgICAgICAgIGlmIHJlZGlyX3VybCBhbmQgbm90IChyZWRpcl91cmwgPT0gJy8nIG9yIHJlZGlyX3VybCA9PSB1cmwgb3IgcmVkaXJfdXJsID09IHVybCArICcvJyk6CiAgICAgICAgICAgICAgICAgICAgcmVzcDIgPSBzZWxmLmhpdF9lbmRwb2ludChwYW5lbF91cmwsIGZvbGxvd19yZWRpcmVjdHM9VHJ1ZSkKICAgICAgICAgICAgICAgICAgICBpZiByZXNwMiBhbmQgcmVzcDIuc3RhdHVzX2NvZGUgaW4gWzIwMCwgNDAxLCA0MDNdOgogICAgICAgICAgICAgICAgICAgICAgICBhdXRoX21hcmtlcnMgPSBbJ2xvZ2luJywgJ2FkbWluJywgJ2F1dGgnLCAnc2lnbiBpbicsICdwYXNzd29yZCcsICd1c2VybmFtZSddCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHJlc3AyLnN0YXR1c19jb2RlIGluIFs0MDEsIDQwM10gb3IgYW55KAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1hcmtlciBpbiByZXNwMi50ZXh0Lmxvd2VyKCkgZm9yIG1hcmtlciBpbiBhdXRoX21hcmtlcnMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfcGFuZWxzLmFwcGVuZChwYW5lbF91cmwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQkNC00LzQuNC90LrQsCDQvdCw0LnQtNC10L3QsDoge3BhbmVsX3VybH0gKHtyZXNwLnN0YXR1c19jb2RlfSAtPiB7cmVzcDIuc3RhdHVzX2NvZGV9KSIpCgogICAgICAgIHJldHVybiBmb3VuZF9wYW5lbHMKCiAgICBkZWYgZmluZF9zZW5zaXRpdmVfZmlsZXMoc2VsZiwgdXJsKToKICAgICAgICBiYXNlID0gdXJsLnJzdHJpcCgnLycpCgogICAgICAgIGZvdW5kX2ZpbGVzID0gW10KCiAgICAgICAgZm9yIGZfcGF0aCBpbiBKVUlDWV9GSUxFUzoKICAgICAgICAgICAgZmlsZV91cmwgPSB1cmxqb2luKGJhc2UsIGZfcGF0aCkKICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KGZpbGVfdXJsLCBtZXRob2Q9IkhFQUQiLCBmb2xsb3dfcmVkaXJlY3RzPUZhbHNlKQoKICAgICAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgcmVzcC5zdGF0dXNfY29kZSBpbiBbMzAxLCAzMDIsIDMwMywgMzA3LCAzMDhdOgogICAgICAgICAgICAgICAgcmVkaXJfdXJsID0gcmVzcC5oZWFkZXJzLmdldCgnTG9jYXRpb24nLCAnJykKICAgICAgICAgICAgICAgIGlmIHJlZGlyX3VybCBhbmQgbm90IChyZWRpcl91cmwgPT0gJy8nIG9yIHJlZGlyX3VybCA9PSB1cmwgb3IgcmVkaXJfdXJsID09IHVybCArICcvJyk6CiAgICAgICAgICAgICAgICAgICAgcmVzcDIgPSBzZWxmLmhpdF9lbmRwb2ludChmaWxlX3VybCwgZm9sbG93X3JlZGlyZWN0cz1UcnVlKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc3AyIGFuZCByZXNwMi5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX2lzX2xpa2VseV9yZWFsX2ZpbGUoZl9wYXRoLCByZXNwMik6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF9maWxlcy5hcHBlbmQoZmlsZV91cmwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludCgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmIlsrXSDQodC10L3RgdC40YLQuNCy0L3Ri9C5INGE0LDQudC7INC90LDQudC00LXQvToge2ZpbGVfdXJsfSAoe3Jlc3Auc3RhdHVzX2NvZGV9IC0+IHtyZXNwMi5zdGF0dXNfY29kZX0pIikKICAgICAgICAgICAgZWxpZiByZXNwLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgICAgIG1pbWVfdHlwZSA9IHJlc3AuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKQogICAgICAgICAgICAgICAgaWYgZl9wYXRoLmVuZHN3aXRoKCcudHh0JykgYW5kICd0ZXh0L3BsYWluJyBpbiBtaW1lX3R5cGU6CiAgICAgICAgICAgICAgICAgICAgZm91bmRfZmlsZXMuYXBwZW5kKGZpbGVfdXJsKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCh0LXQvdGB0LjRgtC40LLQvdGL0Lkg0YTQsNC50Lsg0L3QsNC50LTQtdC9OiB7ZmlsZV91cmx9ICh7cmVzcC5zdGF0dXNfY29kZX0pIikKICAgICAgICAgICAgICAgIGVsaWYgZl9wYXRoLmVuZHN3aXRoKCcucGhwJykgYW5kICd0ZXh0L2h0bWwnIGluIG1pbWVfdHlwZToKICAgICAgICAgICAgICAgICAgICByZXNwMiA9IHNlbGYuaGl0X2VuZHBvaW50KGZpbGVfdXJsKQogICAgICAgICAgICAgICAgICAgIGlmIHJlc3AyIGFuZCAncGhwaW5mbycgaW4gZl9wYXRoIGFuZCAncGhwIHZlcnNpb24nIGluIHJlc3AyLnRleHQubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfZmlsZXMuYXBwZW5kKGZpbGVfdXJsKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSBQSFAg0LjQvdGE0L4g0L3QsNC50LTQtdC90L46IHtmaWxlX3VybH0iKQogICAgICAgICAgICAgICAgZWxpZiBmX3BhdGguZW5kc3dpdGgoKCcuanNvbicsICcueG1sJykpOgogICAgICAgICAgICAgICAgICAgIGlmICdhcHBsaWNhdGlvbi9qc29uJyBpbiBtaW1lX3R5cGUgb3IgJ2FwcGxpY2F0aW9uL3htbCcgaW4gbWltZV90eXBlIG9yICd0ZXh0L3htbCcgaW4gbWltZV90eXBlOgogICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF9maWxlcy5hcHBlbmQoZmlsZV91cmwpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCh0LXQvdGB0LjRgtC40LLQvdGL0Lkg0YTQsNC50Lsg0L3QsNC50LTQtdC9OiB7ZmlsZV91cmx9ICh7cmVzcC5zdGF0dXNfY29kZX0pIikKICAgICAgICAgICAgICAgIGVsaWYgZl9wYXRoLmVuZHN3aXRoKCgnLnppcCcsICcudGFyLmd6JywgJy5yYXInLCAnLmJhaycsICcuc3FsJykpOgogICAgICAgICAgICAgICAgICAgIGlmICd0ZXh0L2h0bWwnIG5vdCBpbiBtaW1lX3R5cGU6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kX2ZpbGVzLmFwcGVuZChmaWxlX3VybCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbK10g0KHQtdC90YHQuNGC0LjQstC90YvQuSDRhNCw0LnQuyDQvdCw0LnQtNC10L06IHtmaWxlX3VybH0gKHtyZXNwLnN0YXR1c19jb2RlfSkiKQogICAgICAgICAgICAgICAgZWxpZiAnLmdpdCcgaW4gZl9wYXRoIG9yICcuZW52JyBpbiBmX3BhdGg6CiAgICAgICAgICAgICAgICAgICAgcmVzcDIgPSBzZWxmLmhpdF9lbmRwb2ludChmaWxlX3VybCkKICAgICAgICAgICAgICAgICAgICBpZiByZXNwMiBhbmQgbGVuKHJlc3AyLnRleHQpIDwgMTAwMDoKICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfZmlsZXMuYXBwZW5kKGZpbGVfdXJsKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQodC10L3RgdC40YLQuNCy0L3Ri9C5INGE0LDQudC7INC90LDQudC00LXQvToge2ZpbGVfdXJsfSAoe3Jlc3Auc3RhdHVzX2NvZGV9KSIpCiAgICAgICAgICAgIGVsaWYgcmVzcC5zdGF0dXNfY29kZSBpbiBbNDAxLCA0MDNdOgogICAgICAgICAgICAgICAgZm91bmRfZmlsZXMuYXBwZW5kKGZpbGVfdXJsKQogICAgICAgICAgICAgICAgcHJpbnQoZiJbK10g0JfQsNGJ0LjRidC10L3QvdGL0Lkg0YHQtdC90YHQuNGC0LjQstC90YvQuSDRhNCw0LnQuzoge2ZpbGVfdXJsfSAoe3Jlc3Auc3RhdHVzX2NvZGV9KSIpCgogICAgICAgIHJldHVybiBmb3VuZF9maWxlcwoKICAgIGRlZiBmaW5kX2pzX2ZpbGVzKHNlbGYsIHVybCk6CiAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHVybCkKCiAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgIHJldHVybiBbXQoKICAgICAgICBqc19maWxlcyA9IFtdCgogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKHJlc3AudGV4dCwgJ2h0bWwucGFyc2VyJykKCiAgICAgICAgZm9yIHNjcmlwdCBpbiBzb3VwLmZpbmRfYWxsKCdzY3JpcHQnKToKICAgICAgICAgICAgaWYgc2NyaXB0LmdldCgnc3JjJyk6CiAgICAgICAgICAgICAgICBqc191cmwgPSB1cmxqb2luKHVybCwgc2NyaXB0WydzcmMnXSkKICAgICAgICAgICAgICAgIGpzX2ZpbGVzLmFwcGVuZChqc191cmwpCgogICAgICAgIGJhc2UgPSB1cmwucnN0cmlwKCcvJykKCiAgICAgICAgZm9yIGVuZHBvaW50IGluIEpTX1BBVEhTOgogICAgICAgICAgICBqc191cmwgPSB1cmxqb2luKGJhc2UsIGVuZHBvaW50KQogICAgICAgICAgICBlbmRwb2ludF9yZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQoanNfdXJsLCBtZXRob2Q9IkhFQUQiKQoKICAgICAgICAgICAgaWYgZW5kcG9pbnRfcmVzcCBhbmQgZW5kcG9pbnRfcmVzcC5zdGF0dXNfY29kZSAhPSA0MDQ6CiAgICAgICAgICAgICAgICBqc19maWxlcy5hcHBlbmQoanNfdXJsKQoKICAgICAgICByZXR1cm4gbGlzdChzZXQoanNfZmlsZXMpKQoKICAgIGRlZiBleHRyYWN0X2hpZGRlbl9lbmRwb2ludHMoc2VsZiwganNfZmlsZXMpOgogICAgICAgIGVuZHBvaW50cyA9IFtdCgogICAgICAgIGZvciBqc19maWxlIGluIGpzX2ZpbGVzOgogICAgICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQoanNfZmlsZSkKCiAgICAgICAgICAgIGlmIG5vdCByZXNwOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIGpzX2NvbnRlbnQgPSByZXNwLnRleHQKCiAgICAgICAgICAgIHBvdGVudGlhbF9lcHMgPSByZS5maW5kYWxsKHInWyJcJ10oL1thLXpBLVowLTlfXC0uL10rKVsiXCddJywganNfY29udGVudCkKICAgICAgICAgICAgYXBpX2VwcyA9IHJlLmZpbmRhbGwocidbIlwnXSgvYXBpL1thLXpBLVowLTlfXC0uL10rKVsiXCddJywganNfY29udGVudCkKCiAgICAgICAgICAgIGJhc2UgPSAnLycuam9pbihqc19maWxlLnNwbGl0KCcvJylbOjNdKQoKICAgICAgICAgICAgZm9yIGVwIGluIHNldChwb3RlbnRpYWxfZXBzICsgYXBpX2Vwcyk6CiAgICAgICAgICAgICAgICBmdWxsX3VybCA9IHVybGpvaW4oYmFzZSwgZXApCiAgICAgICAgICAgICAgICBlbmRwb2ludHMuYXBwZW5kKGZ1bGxfdXJsKQoKICAgICAgICByZXR1cm4gbGlzdChzZXQoZW5kcG9pbnRzKSkKCiAgICBkZWYgY2hlY2tfZW5kcG9pbnRzKHNlbGYsIGVuZHBvaW50cyk6CiAgICAgICAgdmFsaWRfZXBzID0gW10KCiAgICAgICAgZm9yIGVwIGluIGVuZHBvaW50czoKICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KGVwLCBtZXRob2Q9IkhFQUQiKQoKICAgICAgICAgICAgaWYgcmVzcCBhbmQgcmVzcC5zdGF0dXNfY29kZSAhPSA0MDQ6CiAgICAgICAgICAgICAgICB2YWxpZF9lcHMuYXBwZW5kKGVwKQogICAgICAgICAgICAgICAgcHJpbnQoZiJbK10g0JLQsNC70LjQtNC90YvQuSDRjdC90LTQv9C+0LjQvdGCOiB7ZXB9ICh7cmVzcC5zdGF0dXNfY29kZX0pIikKCiAgICAgICAgcmV0dXJuIHZhbGlkX2VwcwoKICAgIGRlZiBleHRyYWN0X2Zvcm1zKHNlbGYsIHVybCk6CiAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHVybCkKCiAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgIHJldHVybiBbXQoKICAgICAgICBmb3JtcyA9IFtdCgogICAgICAgIHNvdXAgPSBCZWF1dGlmdWxTb3VwKHJlc3AudGV4dCwgJ2h0bWwucGFyc2VyJykKCiAgICAgICAgZm9yIGZvcm0gaW4gc291cC5maW5kX2FsbCgnZm9ybScpOgogICAgICAgICAgICBmb3JtX2RhdGEgPSB7CiAgICAgICAgICAgICAgICAiYWN0aW9uIjogdXJsam9pbih1cmwsIGZvcm0uZ2V0KCdhY3Rpb24nLCAnJykpLAogICAgICAgICAgICAgICAgIm1ldGhvZCI6IGZvcm0uZ2V0KCdtZXRob2QnLCAnZ2V0JykudXBwZXIoKSwKICAgICAgICAgICAgICAgICJpbnB1dHMiOiBbXQogICAgICAgICAgICB9CgogICAgICAgICAgICBmb3IgaW5wdXRfZmllbGQgaW4gZm9ybS5maW5kX2FsbChbJ2lucHV0JywgJ3NlbGVjdCcsICd0ZXh0YXJlYSddKToKICAgICAgICAgICAgICAgIGlucHV0X2RhdGEgPSB7CiAgICAgICAgICAgICAgICAgICAgIm5hbWUiOiBpbnB1dF9maWVsZC5nZXQoJ25hbWUnLCAnJyksCiAgICAgICAgICAgICAgICAgICAgInR5cGUiOiBpbnB1dF9maWVsZC5nZXQoJ3R5cGUnLCAndGV4dCcpIGlmIGlucHV0X2ZpZWxkLm5hbWUgPT0gJ2lucHV0JyBlbHNlIGlucHV0X2ZpZWxkLm5hbWUsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogaW5wdXRfZmllbGQuZ2V0KCd2YWx1ZScsICcnKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgZm9ybV9kYXRhWyJpbnB1dHMiXS5hcHBlbmQoaW5wdXRfZGF0YSkKCiAgICAgICAgICAgIGZvcm1zLmFwcGVuZChmb3JtX2RhdGEpCgogICAgICAgIHJldHVybiBmb3JtcwoKICAgIGRlZiBwb3J0X3NjYW4oc2VsZiwgaG9zdCwgcG9ydHM9Tm9uZSk6CiAgICAgICAgaWYgcG9ydHMgaXMgTm9uZToKICAgICAgICAgICAgcG9ydHMgPSBbMjEsIDIyLCAyMywgMjUsIDUzLCA4MCwgMTEwLCAxMTEsIDEzNSwgMTM5LCAxNDMsIDQ0MywgNDQ1LCA5OTMsIDk5NSwgMTcyMywgMzMwNiwgMzM4OSwgNTkwMCwgODA4MF0KCiAgICAgICAgb3Blbl9wb3J0cyA9IHt9CgogICAgICAgIHByaW50KGYiWypdINCh0LrQsNC90LjQvCDQv9C+0YDRgtGLINC00LvRjyB7aG9zdH0uLi4iKQoKICAgICAgICBmb3IgcG9ydCBpbiBwb3J0czoKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc29jayA9IHNvY2tldC5zb2NrZXQoc29ja2V0LkFGX0lORVQsIHNvY2tldC5TT0NLX1NUUkVBTSkKICAgICAgICAgICAgICAgIHNvY2suc2V0dGltZW91dCgxKQogICAgICAgICAgICAgICAgcmVzdWx0ID0gc29jay5jb25uZWN0X2V4KChob3N0LCBwb3J0KSkKICAgICAgICAgICAgICAgIGlmIHJlc3VsdCA9PSAwOgogICAgICAgICAgICAgICAgICAgIHNlcnZpY2UgPSBzb2NrZXQuZ2V0c2VydmJ5cG9ydChwb3J0LCAndGNwJykgaWYgcG9ydCA8IDEwMjQgZWxzZSAi0YXQtyIKICAgICAgICAgICAgICAgICAgICBvcGVuX3BvcnRzW3BvcnRdID0gc2VydmljZQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCf0L7RgNGCIHtwb3J0fSAoe3NlcnZpY2V9KSDQvtGC0LrRgNGL0YIiKQogICAgICAgICAgICAgICAgc29jay5jbG9zZSgpCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIHBhc3MKCiAgICAgICAgcmV0dXJuIG9wZW5fcG9ydHMKCiAgICBkZWYgZG5zX2xvb2t1cChzZWxmLCBkb21haW4pOgogICAgICAgIGRuc19pbmZvID0ge30KCiAgICAgICAgcHJpbnQoZiJbKl0gRE5TLdC/0L7QuNGB0Log0LTQu9GPIHtkb21haW59Li4uIikKCiAgICAgICAgcmVjX3R5cGVzID0gWyJBIiwgIkFBQUEiLCAiTVgiLCAiTlMiLCAiVFhUIiwgIlNPQSIsICJDTkFNRSJdCgogICAgICAgIGZvciByZWNfdHlwZSBpbiByZWNfdHlwZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGFuc3dlcnMgPSBkbnMucmVzb2x2ZXIucmVzb2x2ZShkb21haW4sIHJlY190eXBlKQogICAgICAgICAgICAgICAgZG5zX2luZm9bcmVjX3R5cGVdID0gW3N0cihhbnN3ZXIpIGZvciBhbnN3ZXIgaW4gYW5zd2Vyc10KICAgICAgICAgICAgICAgIHByaW50KGYiWytdIHtyZWNfdHlwZX0g0LfQsNC/0LjRgdC4OiIpCiAgICAgICAgICAgICAgICBmb3IgYW5zd2VyIGluIGFuc3dlcnM6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge2Fuc3dlcn0iKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBkbnNfaW5mb1tyZWNfdHlwZV0gPSBbXQoKICAgICAgICByZXR1cm4gZG5zX2luZm8KCiAgICBkZWYgYW5hbHl6ZV9oZWFkZXJzKHNlbGYsIHVybCk6CiAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHVybCkKICAgICAgICBoZWFkZXJzX2FuYWx5c2lzID0ge30KCiAgICAgICAgaWYgcmVzcDoKICAgICAgICAgICAgaGRycyA9IHJlc3AuaGVhZGVycwoKICAgICAgICAgICAgcHJpbnQoZiJbKl0g0JDQvdCw0LvQuNC3INC30LDQs9C+0LvQvtCy0LrQvtCyINC00LvRjyB7dXJsfS4uLiIpCgogICAgICAgICAgICBoZWFkZXJzX2FuYWx5c2lzWyJzZXJ2ZXIiXSA9IGhkcnMuZ2V0KCJTZXJ2ZXIiLCAi0J3QtSDQvdCw0LnQtNC10L3QviIpCiAgICAgICAgICAgIGhlYWRlcnNfYW5hbHlzaXNbInhfcG93ZXJlZF9ieSJdID0gaGRycy5nZXQoIlgtUG93ZXJlZC1CeSIsICLQndC1INC90LDQudC00LXQvdC+IikKCiAgICAgICAgICAgIHNlY19oZWFkZXJzID0gewogICAgICAgICAgICAgICAgIlN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHkiOiBoZHJzLmdldCgiU3RyaWN0LVRyYW5zcG9ydC1TZWN1cml0eSIsICLQntGC0YHRg9GC0YHRgtCy0YPQtdGCIiksCiAgICAgICAgICAgICAgICAiQ29udGVudC1TZWN1cml0eS1Qb2xpY3kiOiBoZHJzLmdldCgiQ29udGVudC1TZWN1cml0eS1Qb2xpY3kiLCAi0J7RgtGB0YPRgtGB0YLQstGD0LXRgiIpLAogICAgICAgICAgICAgICAgIlgtQ29udGVudC1UeXBlLU9wdGlvbnMiOiBoZHJzLmdldCgiWC1Db250ZW50LVR5cGUtT3B0aW9ucyIsICLQntGC0YHRg9GC0YHRgtCy0YPQtdGCIiksCiAgICAgICAgICAgICAgICAiWC1GcmFtZS1PcHRpb25zIjogaGRycy5nZXQoIlgtRnJhbWUtT3B0aW9ucyIsICLQntGC0YHRg9GC0YHRgtCy0YPQtdGCIiksCiAgICAgICAgICAgICAgICAiWC1YU1MtUHJvdGVjdGlvbiI6IGhkcnMuZ2V0KCJYLVhTUy1Qcm90ZWN0aW9uIiwgItCe0YLRgdGD0YLRgdGC0LLRg9C10YIiKSwKICAgICAgICAgICAgICAgICJSZWZlcnJlci1Qb2xpY3kiOiBoZHJzLmdldCgiUmVmZXJyZXItUG9saWN5IiwgItCe0YLRgdGD0YLRgdGC0LLRg9C10YIiKSwKICAgICAgICAgICAgICAgICJGZWF0dXJlLVBvbGljeSI6IGhkcnMuZ2V0KCJGZWF0dXJlLVBvbGljeSIsICLQntGC0YHRg9GC0YHRgtCy0YPQtdGCIiksCiAgICAgICAgICAgICAgICAiUGVybWlzc2lvbnMtUG9saWN5IjogaGRycy5nZXQoIlBlcm1pc3Npb25zLVBvbGljeSIsICLQntGC0YHRg9GC0YHRgtCy0YPQtdGCIikKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm9yIGhlYWRlciwgdmFsdWUgaW4gc2VjX2hlYWRlcnMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGhlYWRlcnNfYW5hbHlzaXNbaGVhZGVyXSA9IHZhbHVlCiAgICAgICAgICAgICAgICBwcmludChmIlsrXSB7aGVhZGVyfToge3ZhbHVlfSIpCgogICAgICAgIHJldHVybiBoZWFkZXJzX2FuYWx5c2lzCgogICAgZGVmIF9leHRyYWN0X3RpdGxlKHNlbGYsIGh0bWwpOgogICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHInPHRpdGxlW14+XSo+KC4qPyk8L3RpdGxlPicsIGh0bWwsIHJlLklHTk9SRUNBU0UgfCByZS5ET1RBTEwpCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKS5zdHJpcCgpCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIF9leHRyYWN0X2gxKHNlbGYsIGh0bWwpOgogICAgICAgIG1hdGNoID0gcmUuc2VhcmNoKHInPGgxW14+XSo+KC4qPyk8L2gxPicsIGh0bWwsIHJlLklHTk9SRUNBU0UgfCByZS5ET1RBTEwpCiAgICAgICAgaWYgbWF0Y2g6CiAgICAgICAgICAgIHJldHVybiBtYXRjaC5ncm91cCgxKS5zdHJpcCgpCiAgICAgICAgcmV0dXJuICIiCgogICAgZGVmIGFuYWx5emVfc3NsKHNlbGYsIHVybCk6CiAgICAgICAgaWYgbm90IHVybC5zdGFydHN3aXRoKCdodHRwczovLycpOgogICAgICAgICAgICBwcmludCgiWy1dIFVSTCDQvdC1INGO0LfQsNC10YIgU1NML1RMUyIpCiAgICAgICAgICAgIHJldHVybiB7InNzbF9lbmFibGVkIjogRmFsc2V9CgogICAgICAgIHRyeToKICAgICAgICAgICAgZG9tYWluID0gdXJscGFyc2UodXJsKS5uZXRsb2Muc3BsaXQoJzonKVswXQogICAgICAgICAgICBjdHggPSBzc2wuY3JlYXRlX2RlZmF1bHRfY29udGV4dCgpCgogICAgICAgICAgICB3aXRoIHNvY2tldC5jcmVhdGVfY29ubmVjdGlvbigoZG9tYWluLCA0NDMpKSBhcyBzb2NrOgogICAgICAgICAgICAgICAgd2l0aCBjdHgud3JhcF9zb2NrZXQoc29jaywgc2VydmVyX2hvc3RuYW1lPWRvbWFpbikgYXMgc3NvY2s6CiAgICAgICAgICAgICAgICAgICAgY2VydCA9IHNzb2NrLmdldHBlZXJjZXJ0KCkKCiAgICAgICAgICAgICAgICAgICAgc3NsX2luZm8gPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICJzc2xfZW5hYmxlZCI6IFRydWUsCiAgICAgICAgICAgICAgICAgICAgICAgICJpc3N1ZXIiOiAiLCAiLmpvaW4oW2Yie2t9PXt2fSIgZm9yIGssIHYgaW4gY2VydFsiaXNzdWVyIl1bMF1dKSwKICAgICAgICAgICAgICAgICAgICAgICAgInN1YmplY3QiOiAiLCAiLmpvaW4oW2Yie2t9PXt2fSIgZm9yIGssIHYgaW4gY2VydFsic3ViamVjdCJdWzBdXSksCiAgICAgICAgICAgICAgICAgICAgICAgICJ2ZXJzaW9uIjogY2VydFsidmVyc2lvbiJdLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsaWRfZnJvbSI6IGNlcnRbIm5vdEJlZm9yZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAidmFsaWRfdW50aWwiOiBjZXJ0WyJub3RBZnRlciJdLAogICAgICAgICAgICAgICAgICAgICAgICAic2VyaWFsX251bWJlciI6IGNlcnRbInNlcmlhbE51bWJlciJdCiAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSBTU0wg0LLQutC70Y7Rh9C10L06IHtzc2xfaW5mb1snc3NsX2VuYWJsZWQnXX0iKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCY0LfQtNCw0YLQtdC70Yw6IHtzc2xfaW5mb1snaXNzdWVyJ119IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQodGD0LHRitC10LrRgjoge3NzbF9pbmZvWydzdWJqZWN0J119IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQktC10YDRgdC40Y86IHtzc2xfaW5mb1sndmVyc2lvbiddfSIpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbK10g0JTQtdC50YHRgtCy0LjRgtC10LvQtdC9INGBOiB7c3NsX2luZm9bJ3ZhbGlkX2Zyb20nXX0iKQogICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCU0LXQudGB0YLQstC40YLQtdC70LXQvSDQtNC+OiB7c3NsX2luZm9bJ3ZhbGlkX3VudGlsJ119IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQodC10YDQuNC50L3QuNC6OiB7c3NsX2luZm9bJ3NlcmlhbF9udW1iZXInXX0iKQoKICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3NsX2luZm8KICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiWy1dINCe0YjQuNCx0LrQsCDQv9GA0Lgg0LDQvdCw0LvQuNC30LUgU1NMOiB7c3RyKGUpfSIpCiAgICAgICAgICAgIHJldHVybiB7InNzbF9lbmFibGVkIjogVHJ1ZSwgImVycm9yIjogc3RyKGUpfQoKICAgIGRlZiBzY2FuX3dhZihzZWxmLCB1cmwpOgogICAgICAgIHdhZl9zaWdzID0gewogICAgICAgICAgICAiQ2xvdWRmbGFyZSI6IFsiY2xvdWRmbGFyZSIsICJfX2NmZHVpZCIsICJjZi1yYXkiXSwKICAgICAgICAgICAgIkluY2Fwc3VsYSI6IFsiaW5jYXBzdWxhIiwgImluY2FwX3NlcyIsICJ2aXNpZF9pbmNhcCJdLAogICAgICAgICAgICAiQWthbWFpIjogWyJha2FtYWkiLCAiYWthbWFpZ2hvc3QiXSwKICAgICAgICAgICAgIlN1Y3VyaSI6IFsic3VjdXJpIiwgInN1Y3VyaWlmcmFtZSJdLAogICAgICAgICAgICAiRjUgQklHLUlQIjogWyJiaWdpcCIsICJmNSJdLAogICAgICAgICAgICAiSW1wZXJ2YSI6IFsiaW1wZXJ2YSIsICJpbmNhcHN1bGEiXSwKICAgICAgICAgICAgIkJhcnJhY3VkYSI6IFsiYmFycmFjdWRhIl0sCiAgICAgICAgICAgICJNb2RTZWN1cml0eSI6IFsibW9kX3NlY3VyaXR5IiwgIm1vZHNlY3VyaXR5Il0sCiAgICAgICAgICAgICJBV1MgV0FGIjogWyJhd3MiLCAiYW1hem9uIl0sCiAgICAgICAgICAgICJGb3J0aW5ldCI6IFsiZm9ydGluZXQiLCAiZm9ydGlnYXRlIl0sCiAgICAgICAgICAgICJEaXN0aWwgTmV0d29ya3MiOiBbImRpc3RpbCIsICJfX2Rpc3RpbGxlcnkiXQogICAgICAgIH0KCiAgICAgICAgcHJpbnQoZiJbKl0g0KHQutCw0L3QuNC8IFdBRiDQtNC70Y8ge3VybH0uLi4iKQoKICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQodXJsKQogICAgICAgIHdhZl9pbmZvID0geyJkZXRlY3RlZCI6IEZhbHNlfQoKICAgICAgICBpZiByZXNwOgogICAgICAgICAgICBoZHJzID0gcmVzcC5oZWFkZXJzCiAgICAgICAgICAgIGNvb2tpZXMgPSByZXNwLmNvb2tpZXMKCiAgICAgICAgICAgIGZvciB3YWYsIHNpZ3MgaW4gd2FmX3NpZ3MuaXRlbXMoKToKICAgICAgICAgICAgICAgIGZvciBoZWFkZXJfbmFtZSwgaGVhZGVyX3ZhbHVlIGluIGhkcnMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiBhbnkoc2lnLmxvd2VyKCkgaW4gaGVhZGVyX25hbWUubG93ZXIoKSBvciBzaWcubG93ZXIoKSBpbiBoZWFkZXJfdmFsdWUubG93ZXIoKSBmb3Igc2lnIGluIHNpZ3MpOgogICAgICAgICAgICAgICAgICAgICAgICB3YWZfaW5mb1siZGV0ZWN0ZWQiXSA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FmX2luZm9bInR5cGUiXSA9ICJIZWFkZXItYmFzZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIHdhZl9pbmZvWyJ2ZW5kb3IiXSA9IHdhZgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSBXQUYg0L7QsdC90LDRgNGD0LbQtdC9OiB7d2FmfSAo0LfQsNCz0L7Qu9C+0LLQvtC6OiB7aGVhZGVyX25hbWV9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3YWZfaW5mbwoKICAgICAgICAgICAgICAgIGZvciBjb29raWUgaW4gY29va2llczoKICAgICAgICAgICAgICAgICAgICBpZiBhbnkoc2lnLmxvd2VyKCkgaW4gY29va2llLm5hbWUubG93ZXIoKSBvciBzaWcubG93ZXIoKSBpbiBjb29raWUudmFsdWUubG93ZXIoKSBmb3Igc2lnIGluIHNpZ3MpOgogICAgICAgICAgICAgICAgICAgICAgICB3YWZfaW5mb1siZGV0ZWN0ZWQiXSA9IFRydWUKICAgICAgICAgICAgICAgICAgICAgICAgd2FmX2luZm9bInR5cGUiXSA9ICJDb29raWUtYmFzZWQiCiAgICAgICAgICAgICAgICAgICAgICAgIHdhZl9pbmZvWyJ2ZW5kb3IiXSA9IHdhZgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSBXQUYg0L7QsdC90LDRgNGD0LbQtdC9OiB7d2FmfSAoY29va2llOiB7Y29va2llLm5hbWV9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB3YWZfaW5mbwoKICAgICAgICAgICAgdGVzdF9wYXlsb2FkcyA9IFsKICAgICAgICAgICAgICAgICI/aWQ9MSciLAogICAgICAgICAgICAgICAgIj9pZD0xK0FORCsxPTEiLAogICAgICAgICAgICAgICAgIj9xPTxzY3JpcHQ+YWxlcnQoMSk8L3NjcmlwdD4iLAogICAgICAgICAgICAgICAgIj9xPTEqL09SREVSLyoqL0JZLyoqLzEtLSIsCiAgICAgICAgICAgICAgICAiP3M9Li4vLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZCIKICAgICAgICAgICAgXQoKICAgICAgICAgICAgZm9yIHBheWxvYWQgaW4gdGVzdF9wYXlsb2FkczoKICAgICAgICAgICAgICAgIHRlc3RfdXJsID0gdXJsICsgcGF5bG9hZAogICAgICAgICAgICAgICAgdGVzdF9yZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQodGVzdF91cmwpCgogICAgICAgICAgICAgICAgaWYgdGVzdF9yZXNwIGFuZCB0ZXN0X3Jlc3Auc3RhdHVzX2NvZGUgPT0gNDAzOgogICAgICAgICAgICAgICAgICAgIGJvZHkgPSB0ZXN0X3Jlc3AudGV4dC5sb3dlcigpCiAgICAgICAgICAgICAgICAgICAgZm9yIHdhZiwgc2lncyBpbiB3YWZfc2lncy5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgICAgICBpZiBhbnkoc2lnLmxvd2VyKCkgaW4gYm9keSBmb3Igc2lnIGluIHNpZ3MpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FmX2luZm9bImRldGVjdGVkIl0gPSBUcnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWZfaW5mb1sidHlwZSJdID0gIlJlc3BvbnNlLWJhc2VkIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FmX2luZm9bInZlbmRvciJdID0gd2FmCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSBXQUYg0L7QsdC90LDRgNGD0LbQtdC9OiB7d2FmfSAo0L7RgtCy0LXRgikiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHdhZl9pbmZvCgogICAgICAgICAgICAgICAgICAgIHdhZl9pbmZvWyJkZXRlY3RlZCJdID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgIHdhZl9pbmZvWyJ0eXBlIl0gPSAiQmVoYXZpb3ItYmFzZWQiCiAgICAgICAgICAgICAgICAgICAgd2FmX2luZm9bInZlbmRvciJdID0gIlVua25vd24iCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlsrXSBXQUYg0L7QsdC90LDRgNGD0LbQtdC9OiDRgtC40L8g0L3QtdC40LfQstC10YHRgtC10L0iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiB3YWZfaW5mbwoKICAgICAgICBwcmludCgiWy1dIFdBRiDQvdC1INC+0LHQvdCw0YDRg9C20LXQvSIpCiAgICAgICAgcmV0dXJuIHdhZl9pbmZvCgogICAgZGVmIGRldGVjdF90ZWNobm9sb2dpZXMoc2VsZiwgdXJsKToKICAgICAgICB0ZWNoX3NpZ3MgPSB7CiAgICAgICAgICAgICJXZWIgU2VydmVycyI6IHsKICAgICAgICAgICAgICAgICJBcGFjaGUiOiBbImFwYWNoZSIsICJ4LXBvd2VyZWQtYnk6IHBocCJdLAogICAgICAgICAgICAgICAgIk5naW54IjogWyJuZ2lueCJdLAogICAgICAgICAgICAgICAgIklJUyI6IFsiaWlzIiwgIm1pY3Jvc29mdC1paXMiLCAieC1wb3dlcmVkLWJ5OiBhc3AubmV0Il0sCiAgICAgICAgICAgICAgICAiTGl0ZVNwZWVkIjogWyJsaXRlc3BlZWQiXSwKICAgICAgICAgICAgICAgICJUb21jYXQiOiBbInRvbWNhdCJdLAogICAgICAgICAgICAgICAgIk5vZGUuanMiOiBbIm5vZGUiLCAiZXhwcmVzcyJdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJDTVMiOiB7CiAgICAgICAgICAgICAgICAiV29yZFByZXNzIjogWyJ3cC1jb250ZW50IiwgIndwLWluY2x1ZGVzIiwgIndvcmRwcmVzcyJdLAogICAgICAgICAgICAgICAgIkpvb21sYSI6IFsiam9vbWxhIiwgImFkbWluaXN0cmF0b3IvaW5kZXgucGhwIiwgImNvbV9jb250ZW50Il0sCiAgICAgICAgICAgICAgICAiRHJ1cGFsIjogWyJkcnVwYWwiLCAic2l0ZXMvZGVmYXVsdCIsICJzaXRlcy9hbGwiXSwKICAgICAgICAgICAgICAgICJNYWdlbnRvIjogWyJtYWdlbnRvIiwgInNraW4vZnJvbnRlbmQiLCAibWFnZSJdLAogICAgICAgICAgICAgICAgIlNob3BpZnkiOiBbInNob3BpZnkiLCAiY2RuLnNob3BpZnkuY29tIl0sCiAgICAgICAgICAgICAgICAiV29vQ29tbWVyY2UiOiBbIndvb2NvbW1lcmNlIl0sCiAgICAgICAgICAgICAgICAiUHJlc3RhU2hvcCI6IFsicHJlc3Rhc2hvcCJdCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgICJKUyBGcmFtZXdvcmtzIjogewogICAgICAgICAgICAgICAgImpRdWVyeSI6IFsianF1ZXJ5Il0sCiAgICAgICAgICAgICAgICAiUmVhY3QiOiBbInJlYWN0IiwgInJlYWN0anMiXSwKICAgICAgICAgICAgICAgICJBbmd1bGFyIjogWyJhbmd1bGFyIiwgIm5nLSJdLAogICAgICAgICAgICAgICAgIlZ1ZS5qcyI6IFsidnVlIiwgInZ1ZWpzIl0sCiAgICAgICAgICAgICAgICAiRW1iZXIuanMiOiBbImVtYmVyIl0sCiAgICAgICAgICAgICAgICAiQmFja2JvbmUuanMiOiBbImJhY2tib25lIl0sCiAgICAgICAgICAgICAgICAiTmV4dC5qcyI6IFsibmV4dCIsICJfX25leHQiXQogICAgICAgICAgICB9LAogICAgICAgICAgICAiQW5hbHl0aWNzICYgVHJhY2tpbmciOiB7CiAgICAgICAgICAgICAgICAiR29vZ2xlIEFuYWx5dGljcyI6IFsiZ29vZ2xlLWFuYWx5dGljcy5jb20iLCAiZ2EoJ2NyZWF0ZSciLCAiZ3RhZyJdLAogICAgICAgICAgICAgICAgIkdvb2dsZSBUYWcgTWFuYWdlciI6IFsiZ29vZ2xldGFnbWFuYWdlci5jb20iXSwKICAgICAgICAgICAgICAgICJGYWNlYm9vayBQaXhlbCI6IFsiY29ubmVjdC5mYWNlYm9vay5uZXQiLCAiZmJxKCJdLAogICAgICAgICAgICAgICAgIllhbmRleC5NZXRyaWNhIjogWyJtYy55YW5kZXgucnUiXSwKICAgICAgICAgICAgICAgICJIb3RqYXIiOiBbImhvdGphci5jb20iLCAiaGpMYXVuY2hFZGl0b3IiXQogICAgICAgICAgICB9LAogICAgICAgICAgICAiQ0ROIjogewogICAgICAgICAgICAgICAgIkNsb3VkZmxhcmUiOiBbImNsb3VkZmxhcmUiLCAiY2RuanMuY2xvdWRmbGFyZS5jb20iXSwKICAgICAgICAgICAgICAgICJBa2FtYWkiOiBbImFrYW1haSIsICJha2FtYWloZC5uZXQiXSwKICAgICAgICAgICAgICAgICJGYXN0bHkiOiBbImZhc3RseSJdLAogICAgICAgICAgICAgICAgIk1heENETiI6IFsibWF4Y2RuIl0sCiAgICAgICAgICAgICAgICAiU3RhY2tQYXRoIjogWyJzdGFja3BhdGgiXQogICAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBwcmludChmIlsqXSDQmNGJ0LXQvCDRgtC10YXQvdC+0LvQvtCz0LjQuCDQtNC70Y8ge3VybH0uLi4iKQoKICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQodXJsKQogICAgICAgIGZvdW5kX3RlY2ggPSB7fQoKICAgICAgICBpZiByZXNwOgogICAgICAgICAgICBoZHJzID0gcmVzcC5oZWFkZXJzCiAgICAgICAgICAgIGhlYWRlcnNfc3RyID0gIlxuIi5qb2luKFtmIntrfToge3Z9IiBmb3IgaywgdiBpbiBoZHJzLml0ZW1zKCldKQogICAgICAgICAgICBodG1sID0gcmVzcC50ZXh0CgogICAgICAgICAgICBmb3IgY2F0LCB0ZWNobm9sb2dpZXMgaW4gdGVjaF9zaWdzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBmb3IgdGVjaCwgc2lncyBpbiB0ZWNobm9sb2dpZXMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBmb3Igc2lnIGluIHNpZ3M6CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNpZy5sb3dlcigpIGluIGhlYWRlcnNfc3RyLmxvd2VyKCkgb3Igc2lnLmxvd2VyKCkgaW4gaHRtbC5sb3dlcigpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgY2F0IG5vdCBpbiBmb3VuZF90ZWNoOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kX3RlY2hbY2F0XSA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiB0ZWNoIG5vdCBpbiBmb3VuZF90ZWNoW2NhdF06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm91bmRfdGVjaFtjYXRdLmFwcGVuZCh0ZWNoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCe0LHQvdCw0YDRg9C20LjQu9C4OiB7dGVjaH0gKHtjYXR9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAganNfZmlsZXMgPSBzZWxmLmZpbmRfanNfZmlsZXModXJsKQogICAgICAgIGZvciBqc19maWxlIGluIGpzX2ZpbGVzWzo1XToKICAgICAgICAgICAganNfcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KGpzX2ZpbGUpCiAgICAgICAgICAgIGlmIGpzX3Jlc3A6CiAgICAgICAgICAgICAgICBqc19jb250ZW50ID0ganNfcmVzcC50ZXh0CiAgICAgICAgICAgICAgICBmb3IgY2F0LCB0ZWNobm9sb2dpZXMgaW4gdGVjaF9zaWdzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgZm9yIHRlY2gsIHNpZ3MgaW4gdGVjaG5vbG9naWVzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzaWcgaW4gc2lnczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNpZy5sb3dlcigpIGluIGpzX2NvbnRlbnQubG93ZXIoKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBjYXQgbm90IGluIGZvdW5kX3RlY2g6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kX3RlY2hbY2F0XSA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgdGVjaCBub3QgaW4gZm91bmRfdGVjaFtjYXRdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZF90ZWNoW2NhdF0uYXBwZW5kKHRlY2gpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCe0LHQvdCw0YDRg9C20LjQu9C4INCyIEpTOiB7dGVjaH0gKHtjYXR9KSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIHJldHVybiBmb3VuZF90ZWNoCgogICAgZGVmIHNjYW5fZGlyZWN0b3J5X2xpc3Rpbmcoc2VsZiwgdXJsKToKICAgICAgICBjb21tb25fZGlycyA9IFsKICAgICAgICAgICAgImJhY2t1cCIsICJiYWNrdXBzIiwgInRlbXAiLCAidG1wIiwgImZpbGVzIiwgInVwbG9hZHMiLAogICAgICAgICAgICAiZG93bmxvYWQiLCAiZG93bmxvYWRzIiwgImRvY3MiLCAiZG9jdW1lbnRzIiwgImltYWdlcyIsCiAgICAgICAgICAgICJpbWciLCAicGhvdG9zIiwgInBpY3MiLCAiY3NzIiwgImpzIiwgImphdmFzY3JpcHQiLAogICAgICAgICAgICAic2NyaXB0cyIsICJpbmNsdWRlcyIsICJpbmMiLCAiaW5jbHVkZSIsICJsb2dzIiwgImxvZyIsCiAgICAgICAgICAgICJhZG1pbiIsICJhZG1pbmlzdHJhdG9yIiwgIndwLWNvbnRlbnQiLCAid3AtaW5jbHVkZXMiLAogICAgICAgICAgICAiZGF0YSIsICJkYiIsICJkYXRhYmFzZSIsICJzcWwiLCAidGVzdCIsICJ0ZXN0cyIsCiAgICAgICAgICAgICJkZXYiLCAiZGV2ZWxvcG1lbnQiLCAiZGVtbyIsICJiZXRhIiwgIm9sZCIsICJuZXciLAogICAgICAgICAgICAiYXJjaGl2ZSIsICJhcmNoaXZlcyIsICJzcmMiLCAic291cmNlIiwgImxpYiIsICJsaWJzIiwKICAgICAgICAgICAgImxpYnJhcnkiLCAibGlicmFyaWVzIiwgInZlbmRvciIsICJ2ZW5kb3JzIiwgIndlYiIsCiAgICAgICAgICAgICJ3ZWJyb290IiwgInd3dyIsICJ3d3dyb290IiwgInB1YmxpYyIsICJwdWJsaWNfaHRtbCIsCiAgICAgICAgICAgICJwcml2YXRlIiwgInNlY3JldCIsICJoaWRkZW4iLCAiYmFja3VwX29sZCIsICJiYWsiCiAgICAgICAgXQoKICAgICAgICBwcmludChmIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0LvQuNGB0YLQuNC90LMg0LTQuNGA0LXQutGC0L7RgNC40Lkg0LTQu9GPIHt1cmx9Li4uIikKCiAgICAgICAgZGlyX2xpc3RpbmcgPSBbXQoKICAgICAgICBmb3IgZGlyX25hbWUgaW4gY29tbW9uX2RpcnM6CiAgICAgICAgICAgIGRpcl91cmwgPSB1cmxqb2luKHVybCwgZGlyX25hbWUgKyAiLyIpCiAgICAgICAgICAgIHJlc3AgPSBzZWxmLmhpdF9lbmRwb2ludChkaXJfdXJsKQoKICAgICAgICAgICAgaWYgcmVzcCBhbmQgcmVzcC5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICBodG1sID0gcmVzcC50ZXh0Lmxvd2VyKCkKCiAgICAgICAgICAgICAgICBpZiAiaW5kZXggb2YiIGluIGh0bWwgYW5kIChkaXJfbmFtZSArICIvIikgaW4gaHRtbDoKICAgICAgICAgICAgICAgICAgICBkaXJfbGlzdGluZy5hcHBlbmQoZGlyX3VybCkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQndCw0YjQu9C4INC70LjRgdGC0LjQvdCzINC00LjRgNC10LrRgtC+0YDQuNC5OiB7ZGlyX3VybH0iKQogICAgICAgICAgICAgICAgZWxpZiAiZGlyZWN0b3J5IGxpc3RpbmciIGluIGh0bWw6CiAgICAgICAgICAgICAgICAgICAgZGlyX2xpc3RpbmcuYXBwZW5kKGRpcl91cmwpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbK10g0J3QsNGI0LvQuCDQu9C40YHRgtC40L3QsyDQtNC40YDQtdC60YLQvtGA0LjQuToge2Rpcl91cmx9IikKICAgICAgICAgICAgICAgIGVsaWYgIjxwcmU+IiBpbiBodG1sIGFuZCAicGFyZW50IGRpcmVjdG9yeSIgaW4gaHRtbDoKICAgICAgICAgICAgICAgICAgICBkaXJfbGlzdGluZy5hcHBlbmQoZGlyX3VybCkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQndCw0YjQu9C4INC70LjRgdGC0LjQvdCzINC00LjRgNC10LrRgtC+0YDQuNC5OiB7ZGlyX3VybH0iKQogICAgICAgICAgICAgICAgZWxpZiAidG8gcGFyZW50IGRpcmVjdG9yeSIgaW4gaHRtbDoKICAgICAgICAgICAgICAgICAgICBkaXJfbGlzdGluZy5hcHBlbmQoZGlyX3VybCkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQndCw0YjQu9C4INC70LjRgdGC0LjQvdCzINC00LjRgNC10LrRgtC+0YDQuNC5OiB7ZGlyX3VybH0iKQoKICAgICAgICByZXR1cm4gZGlyX2xpc3RpbmcKCiAgICBkZWYgY3Jhd2xfd2Vic2l0ZShzZWxmLCB1cmwsIG1heF91cmxzPTEwMCk6CiAgICAgICAgcHJpbnQoZiJbKl0g0KHQutCw0L3QuNC8INGB0LDQudGCINC00LvRjyB7dXJsfS4uLiIpCgogICAgICAgIGJhc2UgPSB1cmwKICAgICAgICBkb21haW4gPSB1cmxwYXJzZSh1cmwpLm5ldGxvYwoKICAgICAgICB2aXNpdGVkID0gc2V0KCkKICAgICAgICB0b192aXNpdCA9IFt1cmxdCiAgICAgICAgZm9ybXMgPSBbXQogICAgICAgIGZvdW5kX3VybHMgPSBbXQoKICAgICAgICB3aGlsZSB0b192aXNpdCBhbmQgbGVuKHZpc2l0ZWQpIDwgbWF4X3VybHM6CiAgICAgICAgICAgIGN1cnJfdXJsID0gdG9fdmlzaXQucG9wKDApCgogICAgICAgICAgICBpZiBjdXJyX3VybCBpbiB2aXNpdGVkOgogICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgIHByaW50KGYiWypdINCh0LrQsNC90LjQvCBVUkw6IHtjdXJyX3VybH0iKQoKICAgICAgICAgICAgdmlzaXRlZC5hZGQoY3Vycl91cmwpCiAgICAgICAgICAgIGZvdW5kX3VybHMuYXBwZW5kKGN1cnJfdXJsKQoKICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KGN1cnJfdXJsKQoKICAgICAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgICAgICBjb250aW51ZQoKICAgICAgICAgICAgaWYgJ3RleHQvaHRtbCcgbm90IGluIHJlc3AuaGVhZGVycy5nZXQoJ0NvbnRlbnQtVHlwZScsICcnKToKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBzb3VwID0gQmVhdXRpZnVsU291cChyZXNwLnRleHQsICdodG1sLnBhcnNlcicpCgogICAgICAgICAgICBwYWdlX2Zvcm1zID0gc2VsZi5leHRyYWN0X2Zvcm1zKGN1cnJfdXJsKQogICAgICAgICAgICBmb3Jtcy5leHRlbmQocGFnZV9mb3JtcykKCiAgICAgICAgICAgIGZvciBhX3RhZyBpbiBzb3VwLmZpbmRfYWxsKCdhJywgaHJlZj1UcnVlKToKICAgICAgICAgICAgICAgIGhyZWYgPSBhX3RhZ1snaHJlZiddCgogICAgICAgICAgICAgICAgaWYgbm90IGhyZWYgb3IgaHJlZi5zdGFydHN3aXRoKCcjJyk6CiAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICBmdWxsX3VybCA9IHVybGpvaW4oY3Vycl91cmwsIGhyZWYpCgogICAgICAgICAgICAgICAgcGFyc2VkID0gdXJscGFyc2UoZnVsbF91cmwpCgogICAgICAgICAgICAgICAgaWYgcGFyc2VkLm5ldGxvYyA9PSBkb21haW4gYW5kIGZ1bGxfdXJsIG5vdCBpbiB2aXNpdGVkIGFuZCBmdWxsX3VybCBub3QgaW4gdG9fdmlzaXQ6CiAgICAgICAgICAgICAgICAgICAgdG9fdmlzaXQuYXBwZW5kKGZ1bGxfdXJsKQoKICAgICAgICByZXR1cm4gewogICAgICAgICAgICAidXJscyI6IGZvdW5kX3VybHMsCiAgICAgICAgICAgICJmb3JtcyI6IGZvcm1zCiAgICAgICAgfQoKICAgIGRlZiBzY2FuX3dvcmRwcmVzcyhzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiWypdINCh0LrQsNC90LjQvCBXb3JkUHJlc3Mg0LTQu9GPIHt1cmx9Li4uIikKCiAgICAgICAgd3BfaW5mbyA9IHt9CgogICAgICAgIHJlc3AgPSBzZWxmLmhpdF9lbmRwb2ludCh1cmwpCgogICAgICAgIGlmIG5vdCByZXNwOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgICAgICBodG1sID0gcmVzcC50ZXh0CgogICAgICAgIGlmICd3cC1jb250ZW50JyBub3QgaW4gaHRtbCBhbmQgJ3dwLWluY2x1ZGVzJyBub3QgaW4gaHRtbDoKICAgICAgICAgICAgd3BfYWRtaW5fdXJsID0gdXJsam9pbih1cmwsICd3cC1sb2dpbi5waHAnKQogICAgICAgICAgICB3cF9hZG1pbl9yZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQod3BfYWRtaW5fdXJsKQoKICAgICAgICAgICAgaWYgbm90IHdwX2FkbWluX3Jlc3Agb3IgJ3dvcmRwcmVzcycgbm90IGluIHdwX2FkbWluX3Jlc3AudGV4dC5sb3dlcigpOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSBXb3JkUHJlc3Mg0L3QtSDQvtCx0L3QsNGA0YPQttC10L0iKQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICAgICAgcHJpbnQoIlsrXSBXb3JkUHJlc3Mg0L7QsdC90LDRgNGD0LbQtdC9IikKCiAgICAgICAgdmVyc2lvbl91cmwgPSB1cmxqb2luKHVybCwgJ3dwLWluY2x1ZGVzL3ZlcnNpb24ucGhwJykKICAgICAgICB2ZXJzaW9uX3Jlc3AgPSBzZWxmLmhpdF9lbmRwb2ludCh2ZXJzaW9uX3VybCkKCiAgICAgICAgaWYgdmVyc2lvbl9yZXNwIGFuZCB2ZXJzaW9uX3Jlc3Auc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICB2ZXJzaW9uX21hdGNoID0gcmUuc2VhcmNoKHInXCR3cF92ZXJzaW9uXHMqPVxzKltcJyJdKFteXCciXSspW1wnIl0nLCB2ZXJzaW9uX3Jlc3AudGV4dCkKICAgICAgICAgICAgaWYgdmVyc2lvbl9tYXRjaDoKICAgICAgICAgICAgICAgIHdwX2luZm9bJ3ZlcnNpb24nXSA9IHZlcnNpb25fbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgIHByaW50KGYiWytdINCS0LXRgNGB0LjRjyBXb3JkUHJlc3M6IHt3cF9pbmZvWyd2ZXJzaW9uJ119IikKCiAgICAgICAgaWYgJ3ZlcnNpb24nIG5vdCBpbiB3cF9pbmZvOgogICAgICAgICAgICByZWFkbWVfdXJsID0gdXJsam9pbih1cmwsICdyZWFkbWUuaHRtbCcpCiAgICAgICAgICAgIHJlYWRtZV9yZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQocmVhZG1lX3VybCkKCiAgICAgICAgICAgIGlmIHJlYWRtZV9yZXNwIGFuZCByZWFkbWVfcmVzcC5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICB2ZXJzaW9uX21hdGNoID0gcmUuc2VhcmNoKHInVmVyc2lvblxzKyhbMC05Ll0rKScsIHJlYWRtZV9yZXNwLnRleHQpCiAgICAgICAgICAgICAgICBpZiB2ZXJzaW9uX21hdGNoOgogICAgICAgICAgICAgICAgICAgIHdwX2luZm9bJ3ZlcnNpb24nXSA9IHZlcnNpb25fbWF0Y2guZ3JvdXAoMSkKICAgICAgICAgICAgICAgICAgICBwcmludChmIlsrXSDQktC10YDRgdC40Y8gV29yZFByZXNzOiB7d3BfaW5mb1sndmVyc2lvbiddfSIpCgogICAgICAgIHdwX2luZm9bJ3RoZW1lcyddID0gW10KCiAgICAgICAgY29udGVudF91cmwgPSB1cmxqb2luKHVybCwgJ3dwLWNvbnRlbnQvdGhlbWVzLycpCiAgICAgICAgY29udGVudF9yZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQoY29udGVudF91cmwpCgogICAgICAgIGlmIGNvbnRlbnRfcmVzcCBhbmQgY29udGVudF9yZXNwLnN0YXR1c19jb2RlID09IDIwMDoKICAgICAgICAgICAgaWYgJ0luZGV4IG9mJyBpbiBjb250ZW50X3Jlc3AudGV4dDoKICAgICAgICAgICAgICAgIHRoZW1lX2xpbmtzID0gcmUuZmluZGFsbChyJ2hyZWY9IihbXiJdKz8pLyInLCBjb250ZW50X3Jlc3AudGV4dCkKICAgICAgICAgICAgICAgIGZvciB0aGVtZSBpbiB0aGVtZV9saW5rczoKICAgICAgICAgICAgICAgICAgICBpZiB0aGVtZSBub3QgaW4gWycuJywgJy4uJ106CiAgICAgICAgICAgICAgICAgICAgICAgIHdwX2luZm9bJ3RoZW1lcyddLmFwcGVuZCh0aGVtZSkKCiAgICAgICAgaWYgcmVzcDoKICAgICAgICAgICAgdGhlbWVfbWF0Y2hlcyA9IHJlLmZpbmRhbGwocid3cC1jb250ZW50L3RoZW1lcy8oW14vXSspJywgcmVzcC50ZXh0KQogICAgICAgICAgICBmb3IgdGhlbWUgaW4gdGhlbWVfbWF0Y2hlczoKICAgICAgICAgICAgICAgIGlmIHRoZW1lIG5vdCBpbiB3cF9pbmZvWyd0aGVtZXMnXToKICAgICAgICAgICAgICAgICAgICB3cF9pbmZvWyd0aGVtZXMnXS5hcHBlbmQodGhlbWUpCgogICAgICAgIGlmIHdwX2luZm9bJ3RoZW1lcyddOgogICAgICAgICAgICBwcmludCgiWytdINCd0LDQudC00LXQvdC90YvQtSDRgtC10LzRiyBXb3JkUHJlc3M6IikKICAgICAgICAgICAgZm9yIHRoZW1lIGluIHdwX2luZm9bJ3RoZW1lcyddOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge3RoZW1lfSIpCgogICAgICAgIHdwX2luZm9bJ3BsdWdpbnMnXSA9IFtdCgogICAgICAgIHBsdWdpbnNfdXJsID0gdXJsam9pbih1cmwsICd3cC1jb250ZW50L3BsdWdpbnMvJykKICAgICAgICBwbHVnaW5zX3Jlc3AgPSBzZWxmLmhpdF9lbmRwb2ludChwbHVnaW5zX3VybCkKCiAgICAgICAgaWYgcGx1Z2luc19yZXNwIGFuZCBwbHVnaW5zX3Jlc3Auc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICBpZiAnSW5kZXggb2YnIGluIHBsdWdpbnNfcmVzcC50ZXh0OgogICAgICAgICAgICAgICAgcGx1Z2luX2xpbmtzID0gcmUuZmluZGFsbChyJ2hyZWY9IihbXiJdKz8pLyInLCBwbHVnaW5zX3Jlc3AudGV4dCkKICAgICAgICAgICAgICAgIGZvciBwbHVnaW4gaW4gcGx1Z2luX2xpbmtzOgogICAgICAgICAgICAgICAgICAgIGlmIHBsdWdpbiBub3QgaW4gWycuJywgJy4uJ106CiAgICAgICAgICAgICAgICAgICAgICAgIHdwX2luZm9bJ3BsdWdpbnMnXS5hcHBlbmQocGx1Z2luKQoKICAgICAgICBpZiByZXNwOgogICAgICAgICAgICBwbHVnaW5fbWF0Y2hlcyA9IHJlLmZpbmRhbGwocid3cC1jb250ZW50L3BsdWdpbnMvKFteL10rKScsIHJlc3AudGV4dCkKICAgICAgICAgICAgZm9yIHBsdWdpbiBpbiBwbHVnaW5fbWF0Y2hlczoKICAgICAgICAgICAgICAgIGlmIHBsdWdpbiBub3QgaW4gd3BfaW5mb1sncGx1Z2lucyddOgogICAgICAgICAgICAgICAgICAgIHdwX2luZm9bJ3BsdWdpbnMnXS5hcHBlbmQocGx1Z2luKQoKICAgICAgICBpZiB3cF9pbmZvWydwbHVnaW5zJ106CiAgICAgICAgICAgIHByaW50KCJbK10g0J3QsNC50LTQtdC90L3Ri9C1INC/0LvQsNCz0LjQvdGLIFdvcmRQcmVzczoiKQogICAgICAgICAgICBmb3IgcGx1Z2luIGluIHdwX2luZm9bJ3BsdWdpbnMnXToKICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHtwbHVnaW59IikKCiAgICAgICAgd3BfaW5mb1sndXNlcnMnXSA9IFtdCgogICAgICAgIGZvciBpIGluIHJhbmdlKDEsIDUpOgogICAgICAgICAgICBhdXRob3JfdXJsID0gdXJsam9pbih1cmwsIGYnP2F1dGhvcj17aX0nKQogICAgICAgICAgICBhdXRob3JfcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KGF1dGhvcl91cmwpCgogICAgICAgICAgICBpZiBhdXRob3JfcmVzcCBhbmQgYXV0aG9yX3Jlc3Auc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgaWYgJ2F1dGhvcicgaW4gYXV0aG9yX3Jlc3AudXJsOgogICAgICAgICAgICAgICAgICAgIGF1dGhvciA9IHVybHBhcnNlKGF1dGhvcl9yZXNwLnVybCkucGF0aC5zcGxpdCgnLycpWy0yXQogICAgICAgICAgICAgICAgICAgIGlmIGF1dGhvciBhbmQgYXV0aG9yIG5vdCBpbiB3cF9pbmZvWyd1c2VycyddOgogICAgICAgICAgICAgICAgICAgICAgICB3cF9pbmZvWyd1c2VycyddLmFwcGVuZChhdXRob3IpCgogICAgICAgICAgICAgICAgc291cCA9IEJlYXV0aWZ1bFNvdXAoYXV0aG9yX3Jlc3AudGV4dCwgJ2h0bWwucGFyc2VyJykKICAgICAgICAgICAgICAgIGZvciBsaW5rIGluIHNvdXAuZmluZF9hbGwoJ2EnLCBocmVmPVRydWUpOgogICAgICAgICAgICAgICAgICAgIGlmICdhdXRob3InIGluIGxpbmtbJ2hyZWYnXToKICAgICAgICAgICAgICAgICAgICAgICAgYXV0aG9yID0gbGlua1snaHJlZiddLnNwbGl0KCcvJylbLTJdCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGF1dGhvciBhbmQgYXV0aG9yIG5vdCBpbiB3cF9pbmZvWyd1c2VycyddOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgd3BfaW5mb1sndXNlcnMnXS5hcHBlbmQoYXV0aG9yKQoKICAgICAgICBpZiB3cF9pbmZvWyd1c2VycyddOgogICAgICAgICAgICBwcmludCgiWytdINCd0LDQudC00LXQvdC90YvQtSDRjtC30LXRgNGLIFdvcmRQcmVzczoiKQogICAgICAgICAgICBmb3IgdXNlciBpbiB3cF9pbmZvWyd1c2VycyddOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge3VzZXJ9IikKCiAgICAgICAgd3BfaW5mb1sndnVsbmVyYWJpbGl0aWVzJ10gPSBbXQoKICAgICAgICBpZiAndmVyc2lvbicgaW4gd3BfaW5mbzoKICAgICAgICAgICAgaWYgd3BfaW5mb1sndmVyc2lvbiddLnN0YXJ0c3dpdGgoJzQuJykgYW5kIGludCh3cF9pbmZvWyd2ZXJzaW9uJ10uc3BsaXQoJy4nKVsxXSkgPCA3OgogICAgICAgICAgICAgICAgd3BfaW5mb1sndnVsbmVyYWJpbGl0aWVzJ10uYXBwZW5kKAogICAgICAgICAgICAgICAgICAgIGYiV29yZFByZXNzIHt3cF9pbmZvWyd2ZXJzaW9uJ119INGD0Y/Qt9Cy0LjQvCDQuiBTUUwg0LjQvdGK0LXQutGG0LjQuCAoQ1ZFLTIwMTctOTA1OSkiKQoKICAgICAgICAgICAgaWYgd3BfaW5mb1sndmVyc2lvbiddLnN0YXJ0c3dpdGgoJzMuJykgb3IgKAogICAgICAgICAgICAgICAgICAgIHdwX2luZm9bJ3ZlcnNpb24nXS5zdGFydHN3aXRoKCc0LicpIGFuZCBpbnQod3BfaW5mb1sndmVyc2lvbiddLnNwbGl0KCcuJylbMV0pIDwgMik6CiAgICAgICAgICAgICAgICB3cF9pbmZvWyd2dWxuZXJhYmlsaXRpZXMnXS5hcHBlbmQoZiJXb3JkUHJlc3Mge3dwX2luZm9bJ3ZlcnNpb24nXX0g0YPRj9C30LLQuNC8INC6IENTUkYgKENWRS0yMDE0LTAxNjYpIikKCiAgICAgICAgZm9yIHBsdWdpbiBpbiB3cF9pbmZvLmdldCgncGx1Z2lucycsIFtdKToKICAgICAgICAgICAgaWYgcGx1Z2luID09ICd3cC1zdXBlci1jYWNoZScgYW5kICd2ZXJzaW9uJyBpbiB3cF9pbmZvIGFuZCB3cF9pbmZvWyd2ZXJzaW9uJ10gPCAnMS40LjgnOgogICAgICAgICAgICAgICAgd3BfaW5mb1sndnVsbmVyYWJpbGl0aWVzJ10uYXBwZW5kKGYi0J/Qu9Cw0LPQuNC9IHdwLXN1cGVyLWNhY2hlINGD0Y/Qt9Cy0LjQvCDQuiBSQ0UgKENWRS0yMDE3LTU2MTIpIikKCiAgICAgICAgICAgIGlmIHBsdWdpbiA9PSAnY29udGFjdC1mb3JtLTcnIGFuZCAndmVyc2lvbicgaW4gd3BfaW5mbyBhbmQgd3BfaW5mb1sndmVyc2lvbiddIDwgJzUuMy4yJzoKICAgICAgICAgICAgICAgIHdwX2luZm9bJ3Z1bG5lcmFiaWxpdGllcyddLmFwcGVuZChmItCf0LvQsNCz0LjQvSBjb250YWN0LWZvcm0tNyDRg9GP0LfQstC40Lwg0LogWFNTIChDVkUtMjAyMC0zNTQ4OSkiKQoKICAgICAgICBpZiB3cF9pbmZvLmdldCgndnVsbmVyYWJpbGl0aWVzJyk6CiAgICAgICAgICAgIHByaW50KCJbK10g0J3QsNC50LTQtdC90L3Ri9C1INGD0Y/Qt9Cy0LjQvNC+0YHRgtC4IFdvcmRQcmVzczoiKQogICAgICAgICAgICBmb3IgdnVsbiBpbiB3cF9pbmZvWyd2dWxuZXJhYmlsaXRpZXMnXToKICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHt2dWxufSIpCgogICAgICAgIHJldHVybiB3cF9pbmZvCgogICAgZGVmIHNjYW5fd2Vic2l0ZShzZWxmLCB1cmwpOgogICAgICAgIHJlc3VsdHMgPSB7fQoKICAgICAgICBwcmludChmIlsqXSDQndCw0YfQuNC90LDQtdC8INGB0LrQsNC90LjRgtGMOiB7dXJsfSIpCgogICAgICAgIHBhcnNlZCA9IHVybHBhcnNlKHVybCkKICAgICAgICBpZiBub3QgcGFyc2VkLnNjaGVtZToKICAgICAgICAgICAgdXJsID0gJ2h0dHA6Ly8nICsgdXJsCgogICAgICAgIHByaW50KGYiWypdINCf0L7Qu9GD0YfQsNC10Lwg0LjQvdGE0YMg0L4g0YHQtdGA0LLQtdGA0LUuLi4iKQogICAgICAgIHJlc3VsdHNbInNlcnZlcl9pbmZvIl0gPSBzZWxmLmdldF9zZXJ2ZXJfaW5mbyh1cmwpCgogICAgICAgIHByaW50KGYiWypdINCf0YDQvtCy0LXRgNGP0LXQvCDQvdCw0LvQuNGH0LjQtSBXQUYuLi4iKQogICAgICAgIHJlc3VsdHNbIndhZl9kZXRlY3RlZCJdID0gc2VsZi5jaGVja193YWYodXJsKQoKICAgICAgICBwcmludChmIlsqXSDQn9GA0L7QstC10YDRj9C10Lwgcm9ib3RzLnR4dC4uLiIpCiAgICAgICAgcmVzdWx0c1sicm9ib3RzX3R4dCJdID0gc2VsZi5jaGVja19yb2JvdHNfdHh0KHVybCkKCiAgICAgICAgZG9tYWluID0gdXJscGFyc2UodXJsKS5uZXRsb2MKICAgICAgICBwcmludChmIlsqXSDQmNGJ0LXQvCDQv9C+0LTQtNC+0LzQtdC90Ysg0LTQu9GPIHtkb21haW59Li4uIikKICAgICAgICByZXN1bHRzWyJzdWJkb21haW5zIl0gPSBzZWxmLmZpbmRfc3ViZG9tYWlucyhkb21haW4pCgogICAgICAgIHByaW50KGYiWypdINCh0LrQsNC90LjQvCDQtNC40YDQtdC60YLQvtGA0LjQuC4uLiIpCiAgICAgICAgcmVzdWx0c1siZGlyZWN0b3JpZXMiXSA9IHNlbGYuc2Nhbl9kaXJzKHVybCkKCiAgICAgICAgcHJpbnQoZiJbKl0g0JjRidC10Lwg0LDQtNC80LjQvdC60LguLi4iKQogICAgICAgIHJlc3VsdHNbImFkbWluX3BhbmVscyJdID0gc2VsZi5maW5kX2FkbWluX3BhbmVscyh1cmwpCgogICAgICAgIHByaW50KGYiWypdINCY0YnQtdC8INGB0LXQvdGB0LjRgtC40LLQvdGL0LUg0YTQsNC50LvRiy4uLiIpCiAgICAgICAgcmVzdWx0c1sic2Vuc2l0aXZlX2ZpbGVzIl0gPSBzZWxmLmZpbmRfc2Vuc2l0aXZlX2ZpbGVzKHVybCkKCiAgICAgICAgcHJpbnQoZiJbKl0g0JjRidC10LwgSlMg0YTQsNC50LvRiy4uLiIpCiAgICAgICAganNfZmlsZXMgPSBzZWxmLmZpbmRfanNfZmlsZXModXJsKQogICAgICAgIHJlc3VsdHNbImpzX2ZpbGVzIl0gPSBqc19maWxlcwoKICAgICAgICBwcmludChmIlsqXSDQmNC30LLQu9C10LrQsNC10Lwg0YHQutGA0YvRgtGL0LUg0Y3QvdC00L/QvtC40L3RgtGLINC40LcgSlMg0YTQsNC50LvQvtCyLi4uIikKICAgICAgICBlbmRwb2ludHMgPSBzZWxmLmV4dHJhY3RfaGlkZGVuX2VuZHBvaW50cyhqc19maWxlcykKCiAgICAgICAgcHJpbnQoZiJbKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INCy0LDQu9C40LTQvdC+0YHRgtGMINGN0L3QtNC/0L7QuNC90YLQvtCyLi4uIikKICAgICAgICByZXN1bHRzWyJ2YWxpZF9lbmRwb2ludHMiXSA9IHNlbGYuY2hlY2tfZW5kcG9pbnRzKGVuZHBvaW50cykKCiAgICAgICAgcHJpbnQoZiJbKl0g0JjRidC10Lwg0YTQvtGA0LzRiy4uLiIpCiAgICAgICAgcmVzdWx0c1siZm9ybXMiXSA9IHNlbGYuZXh0cmFjdF9mb3Jtcyh1cmwpCgogICAgICAgIHByaW50KGYiWytdINCh0LrQsNC90LjRgNC+0LLQsNC90LjQtSDRgdCw0LnRgtCwINC30LDQstC10YDRiNC10L3QviEiKQoKICAgICAgICByZXR1cm4gcmVzdWx0cw==').decode('utf-8'))