import base64;exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBzb2NrZXQKaW1wb3J0IHJlCmltcG9ydCB0aW1lCmltcG9ydCByZXF1ZXN0cwppbXBvcnQgc3NsCmltcG9ydCB1cmxsaWIzCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZSwgcGFyc2VfcXMsIHVybGpvaW4sIHF1b3RlCmZyb20gYnM0IGltcG9ydCBCZWF1dGlmdWxTb3VwCmZyb20gQnJ1aFBlbnRlc3QudXRpbHMgaW1wb3J0IGdldF9yYW5kb21fdXNlcl9hZ2VudAoKdXJsbGliMy5kaXNhYmxlX3dhcm5pbmdzKHVybGxpYjMuZXhjZXB0aW9ucy5JbnNlY3VyZVJlcXVlc3RXYXJuaW5nKQoKCmNsYXNzIFNlY3VyaXR5U2Nhbm5lcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLnNlc3MgPSByZXF1ZXN0cy5TZXNzaW9uKCkKICAgICAgICBzZWxmLnNlc3MuaGVhZGVycy51cGRhdGUoeydVc2VyLUFnZW50JzogZ2V0X3JhbmRvbV91c2VyX2FnZW50KCl9KQoKICAgIGRlZiBoaXRfZW5kcG9pbnQoc2VsZiwgdXJsLCBtZXRob2Q9IkdFVCIsIGRhdGE9Tm9uZSwgaGVhZGVycz1Ob25lLCBmb2xsb3dfcmVkaXJlY3RzPVRydWUsIHZlcmlmeT1GYWxzZSwgdGltZW91dD0xMCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBicm93c2VyID0geydVc2VyLUFnZW50JzogZ2V0X3JhbmRvbV91c2VyX2FnZW50KCl9CiAgICAgICAgICAgIGlmIGhlYWRlcnM6CiAgICAgICAgICAgICAgICBicm93c2VyLnVwZGF0ZShoZWFkZXJzKQoKICAgICAgICAgICAgaWYgbWV0aG9kLnVwcGVyKCkgPT0gIkdFVCI6CiAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5zZXNzLmdldCgKICAgICAgICAgICAgICAgICAgICB1cmwsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1icm93c2VyLAogICAgICAgICAgICAgICAgICAgIGFsbG93X3JlZGlyZWN0cz1mb2xsb3dfcmVkaXJlY3RzLAogICAgICAgICAgICAgICAgICAgIHZlcmlmeT12ZXJpZnksCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsaWYgbWV0aG9kLnVwcGVyKCkgPT0gIlBPU1QiOgogICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuc2Vzcy5wb3N0KAogICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICBkYXRhPWRhdGEsCiAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1icm93c2VyLAogICAgICAgICAgICAgICAgICAgIGFsbG93X3JlZGlyZWN0cz1mb2xsb3dfcmVkaXJlY3RzLAogICAgICAgICAgICAgICAgICAgIHZlcmlmeT12ZXJpZnksCiAgICAgICAgICAgICAgICAgICAgdGltZW91dD10aW1lb3V0CiAgICAgICAgICAgICAgICApCiAgICAgICAgICAgIGVsaWYgbWV0aG9kLnVwcGVyKCkgPT0gIkhFQUQiOgogICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuc2Vzcy5oZWFkKAogICAgICAgICAgICAgICAgICAgIHVybCwKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPWJyb3dzZXIsCiAgICAgICAgICAgICAgICAgICAgYWxsb3dfcmVkaXJlY3RzPWZvbGxvd19yZWRpcmVjdHMsCiAgICAgICAgICAgICAgICAgICAgdmVyaWZ5PXZlcmlmeSwKICAgICAgICAgICAgICAgICAgICB0aW1lb3V0PXRpbWVvdXQKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgICAgICAgICByZXR1cm4gcmVzcAogICAgICAgIGV4Y2VwdCByZXF1ZXN0cy5SZXF1ZXN0RXhjZXB0aW9uOgogICAgICAgICAgICByZXR1cm4gTm9uZQoKICAgIGRlZiBjaGVja19zc2woc2VsZiwgdXJsKToKICAgICAgICBpZiBub3QgdXJsLnN0YXJ0c3dpdGgoJ2h0dHBzOi8vJyk6CiAgICAgICAgICAgIHByaW50KCJbLV0g0KHQsNC50YIg0L3QtSDRjtC30LDQtdGCIFNTTC9UTFMiKQogICAgICAgICAgICByZXR1cm4geyJzZWN1cmUiOiBGYWxzZSwgImlzc3VlcyI6IFsi0KHQsNC50YIg0L3QtSDRjtC30LDQtdGCIFNTTC9UTFMiXX0KCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkb21haW4gPSB1cmxwYXJzZSh1cmwpLm5ldGxvYy5zcGxpdCgnOicpWzBdCiAgICAgICAgICAgIGN0eCA9IHNzbC5jcmVhdGVfZGVmYXVsdF9jb250ZXh0KCkKICAgICAgICAgICAgd2l0aCBzb2NrZXQuY3JlYXRlX2Nvbm5lY3Rpb24oKGRvbWFpbiwgNDQzKSkgYXMgc29jazoKICAgICAgICAgICAgICAgIHdpdGggY3R4LndyYXBfc29ja2V0KHNvY2ssIHNlcnZlcl9ob3N0bmFtZT1kb21haW4pIGFzIHNzb2NrOgogICAgICAgICAgICAgICAgICAgIGNlcnQgPSBzc29jay5nZXRwZWVyY2VydCgpCgogICAgICAgICAgICAgICAgICAgIGlzc3VlcyA9IFtdCgogICAgICAgICAgICAgICAgICAgIG5vdF9hZnRlciA9IGRhdGV0aW1lLnN0cnB0aW1lKGNlcnRbJ25vdEFmdGVyJ10sICIlYiAlZCAlSDolTTolUyAlWSAlWiIpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90X2FmdGVyIDwgZGF0ZXRpbWUubm93KCk6CiAgICAgICAgICAgICAgICAgICAgICAgIGlzc3Vlcy5hcHBlbmQoIlNTTCDRgdC10YDRgiDQv9GA0L7RgdGA0L7Rh9C10L0iKQoKICAgICAgICAgICAgICAgICAgICBpc3N1ZXIgPSBkaWN0KGl0ZW1bMF0gZm9yIGl0ZW0gaW4gY2VydFsnaXNzdWVyJ10pCiAgICAgICAgICAgICAgICAgICAgaWYgJ29yZ2FuaXphdGlvbk5hbWUnIG5vdCBpbiBpc3N1ZXI6CiAgICAgICAgICAgICAgICAgICAgICAgIGlzc3Vlcy5hcHBlbmQoItCh0LXRgNGCINCy0YvQtNCw0L0g0L3QtdC40LfQstC10YHRgtC90YvQvCDRhtC10L3RgtGA0L7QvCIpCgogICAgICAgICAgICAgICAgICAgIGlmIGlzc3VlczoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlstXSDQntCx0L3QsNGA0YPQttC10L3RiyDQv9GA0L7QsdC70LXQvNGLINGBIFNTTDoiKQogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaXNzdWUgaW4gaXNzdWVzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge2lzc3VlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7InNlY3VyZSI6IEZhbHNlLCAiaXNzdWVzIjogaXNzdWVzfQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJbK10gU1NMINC90LDRgdGC0YDQvtC10L0g0L/RgNCw0LLQuNC70YzQvdC+IikKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsic2VjdXJlIjogVHJ1ZSwgImlzc3VlcyI6IFtdfQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgaXNzdWUgPSBmItCe0YjQuNCx0LrQsCDQv9GA0Lgg0L/RgNC+0LLQtdGA0LrQtSBTU0w6IHtzdHIoZSl9IgogICAgICAgICAgICBwcmludChmIlstXSB7aXNzdWV9IikKICAgICAgICAgICAgcmV0dXJuIHsic2VjdXJlIjogRmFsc2UsICJpc3N1ZXMiOiBbaXNzdWVdfQoKICAgIGRlZiBjaGVja19oZWFkZXJzKHNlbGYsIHVybCk6CiAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHVybCwgbWV0aG9kPSJIRUFEIikKCiAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgIHJldHVybiB7InNlY3VyZSI6IEZhbHNlLCAiaXNzdWVzIjogWyLQndC1INGD0LTQsNC70L7RgdGMINC/0L7Qu9GD0YfQuNGC0Ywg0LfQsNCz0L7Qu9C+0LLQutC4Il19CgogICAgICAgIGhlYWRlcnMgPSByZXNwLmhlYWRlcnMKICAgICAgICBzZWNfaGVhZGVycyA9IHsKICAgICAgICAgICAgIlN0cmljdC1UcmFuc3BvcnQtU2VjdXJpdHkiOiAibWF4LWFnZT0zMTUzNjAwMDsgaW5jbHVkZVN1YkRvbWFpbnMiLAogICAgICAgICAgICAiQ29udGVudC1TZWN1cml0eS1Qb2xpY3kiOiAiIiwKICAgICAgICAgICAgIlgtQ29udGVudC1UeXBlLU9wdGlvbnMiOiAibm9zbmlmZiIsCiAgICAgICAgICAgICJYLUZyYW1lLU9wdGlvbnMiOiAiREVOWSIsCiAgICAgICAgICAgICJYLVhTUy1Qcm90ZWN0aW9uIjogIjE7IG1vZGU9YmxvY2siLAogICAgICAgICAgICAiUmVmZXJyZXItUG9saWN5IjogIm5vLXJlZmVycmVyLXdoZW4tZG93bmdyYWRlIgogICAgICAgIH0KCiAgICAgICAgbWlzc2luZyA9IFtdCiAgICAgICAgd2VhayA9IFtdCgogICAgICAgIGZvciBoZWFkZXIsIHJlY29tbWVuZGVkIGluIHNlY19oZWFkZXJzLml0ZW1zKCk6CiAgICAgICAgICAgIGlmIGhlYWRlciBub3QgaW4gaGVhZGVyczoKICAgICAgICAgICAgICAgIG1pc3NpbmcuYXBwZW5kKGhlYWRlcikKICAgICAgICAgICAgZWxpZiByZWNvbW1lbmRlZCBhbmQgcmVjb21tZW5kZWQgbm90IGluIGhlYWRlcnNbaGVhZGVyXToKICAgICAgICAgICAgICAgIHdlYWsuYXBwZW5kKGYie2hlYWRlcn06IHtoZWFkZXJzW2hlYWRlcl19IikKCiAgICAgICAgaWYgbWlzc2luZyBvciB3ZWFrOgogICAgICAgICAgICBwcmludCgiWy1dINCe0YLRgdGD0YLRgdGC0LLRg9GO0YIg0LjQu9C4INGB0LvQsNCx0YvQtSDQt9Cw0LPQvtC70L7QstC60Lgg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4OiIpCiAgICAgICAgICAgIGZvciBoZWFkZXIgaW4gbWlzc2luZzoKICAgICAgICAgICAgICAgIHByaW50KGYiICAtINCe0YLRgdGD0YLRgdGC0LLRg9C10YI6IHtoZWFkZXJ9IikKICAgICAgICAgICAgZm9yIGhlYWRlciBpbiB3ZWFrOgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0g0KHQu9Cw0LHRi9C5OiB7aGVhZGVyfSIpCiAgICAgICAgICAgIHJldHVybiB7InNlY3VyZSI6IEZhbHNlLCAibWlzc2luZyI6IG1pc3NpbmcsICJ3ZWFrIjogd2Vha30KICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludCgiWytdINCS0YHQtSDQt9Cw0LPQvtC70L7QstC60Lgg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4INC90LDRgdGC0YDQvtC10L3RiyDQv9GA0LDQstC40LvRjNC90L4iKQogICAgICAgICAgICByZXR1cm4geyJzZWN1cmUiOiBUcnVlLCAibWlzc2luZyI6IFtdLCAid2VhayI6IFtdfQoKICAgIGRlZiBjaGVja19jb29raWVzKHNlbGYsIHVybCk6CiAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHVybCkKCiAgICAgICAgaWYgbm90IHJlc3A6CiAgICAgICAgICAgIHJldHVybiB7InNlY3VyZSI6IEZhbHNlLCAiaXNzdWVzIjogWyLQndC1INGD0LTQsNC70L7RgdGMINC/0L7Qu9GD0YfQuNGC0Ywg0LrRg9C60LgiXX0KCiAgICAgICAgY29va2llcyA9IHJlc3AuY29va2llcwoKICAgICAgICBpZiBub3QgY29va2llczoKICAgICAgICAgICAgcmV0dXJuIHsic2VjdXJlIjogVHJ1ZSwgImlzc3VlcyI6IFtdfQoKICAgICAgICBpbnNlY3VyZV9jb29raWVzID0gW10KCiAgICAgICAgZm9yIGNvb2tpZSBpbiBjb29raWVzOgogICAgICAgICAgICBpc3N1ZXMgPSBbXQoKICAgICAgICAgICAgaWYgbm90IGNvb2tpZS5zZWN1cmU6CiAgICAgICAgICAgICAgICBpc3N1ZXMuYXBwZW5kKCLQndC10YIg0YTQu9Cw0LPQsCBTZWN1cmUiKQoKICAgICAgICAgICAgaWYgbm90IGNvb2tpZS5oYXNfbm9uc3RhbmRhcmRfYXR0cigiSHR0cE9ubHkiKToKICAgICAgICAgICAgICAgIGlzc3Vlcy5hcHBlbmQoItCd0LXRgiDRhNC70LDQs9CwIEh0dHBPbmx5IikKCiAgICAgICAgICAgIGlmIG5vdCBjb29raWUuaGFzX25vbnN0YW5kYXJkX2F0dHIoIlNhbWVTaXRlIik6CiAgICAgICAgICAgICAgICBpc3N1ZXMuYXBwZW5kKCLQndC10YIg0LDRgtGA0LjQsdGD0YLQsCBTYW1lU2l0ZSIpCgogICAgICAgICAgICBpZiBpc3N1ZXM6CiAgICAgICAgICAgICAgICBpbnNlY3VyZV9jb29raWVzLmFwcGVuZCh7Im5hbWUiOiBjb29raWUubmFtZSwgImlzc3VlcyI6IGlzc3Vlc30pCgogICAgICAgIGlmIGluc2VjdXJlX2Nvb2tpZXM6CiAgICAgICAgICAgIHByaW50KCJbLV0g0J7QsdC90LDRgNGD0LbQtdC90Ysg0L3QtdCx0LXQt9C+0L/QsNGB0L3Ri9C1INC60YPQutC4OiIpCiAgICAgICAgICAgIGZvciBjb29raWUgaW4gaW5zZWN1cmVfY29va2llczoKICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHtjb29raWVbJ25hbWUnXX06IHsnLCAnLmpvaW4oY29va2llWydpc3N1ZXMnXSl9IikKICAgICAgICAgICAgcmV0dXJuIHsic2VjdXJlIjogRmFsc2UsICJpbnNlY3VyZV9jb29raWVzIjogaW5zZWN1cmVfY29va2llc30KICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludCgiWytdINCS0YHQtSDQutGD0LrQuCDQvdCw0YHRgtGA0L7QtdC90Ysg0LHQtdC30L7Qv9Cw0YHQvdC+IikKICAgICAgICAgICAgcmV0dXJuIHsic2VjdXJlIjogVHJ1ZSwgImluc2VjdXJlX2Nvb2tpZXMiOiBbXX0KCiAgICBkZWYgY2hlY2tfZm9yX3NxbF9pbmplY3Rpb24oc2VsZiwgdXJsLCBmb3Jtcyk6CiAgICAgICAgc3FsX3BheWxvYWRzID0gWwogICAgICAgICAgICAiJyBPUiAnMSc9JzEiLAogICAgICAgICAgICAiMScgT1IgJzEnPScxJyAtLSIsCiAgICAgICAgICAgICInIE9SIDE9MSAtLSIsCiAgICAgICAgICAgICIxJyBPUiAxPTEgLS0iLAogICAgICAgICAgICAiYWRtaW4nLS0iLAogICAgICAgICAgICAiMScgVU5JT04gU0VMRUNUIDEsMiwzLDQsNSAtLSIsCiAgICAgICAgICAgICIxJyBBTkQgMT0wIFVOSU9OIFNFTEVDVCAxLDIsMyw0LDUgLS0iLAogICAgICAgICAgICAiMScgQU5EIDE9MCBVTklPTiBTRUxFQ1QgMSxkYXRhYmFzZSgpLDMsNCw1IC0tIgogICAgICAgIF0KCiAgICAgICAgdnVsbl9lbmRwb2ludHMgPSBbXQoKICAgICAgICBwcmludCgiWypdINCf0YDQvtCy0LXRgNGP0LXQvCDQv9Cw0YDQsNC80LXRgtGA0YsgVVJMINC90LAgU1FMINC40L3RitC10LrRhtC40LguLi4iKQoKICAgICAgICBwYXJzZWRfdXJsID0gdXJscGFyc2UodXJsKQoKICAgICAgICBpZiBwYXJzZWRfdXJsLnF1ZXJ5OgogICAgICAgICAgICBwYXJhbXMgPSBwYXJzZV9xcyhwYXJzZWRfdXJsLnF1ZXJ5KQoKICAgICAgICAgICAgZm9yIHBhcmFtX25hbWUsIHBhcmFtX3ZhbHVlcyBpbiBwYXJhbXMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGJhc2VfdXJsID0gdXJsLnNwbGl0KCc/JylbMF0KCiAgICAgICAgICAgICAgICBmb3IgcGF5bG9hZCBpbiBzcWxfcGF5bG9hZHM6CiAgICAgICAgICAgICAgICAgICAgdGVzdF91cmwgPSBmIntiYXNlX3VybH0/e3BhcmFtX25hbWV9PXtxdW90ZShwYXlsb2FkKX0iCiAgICAgICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHRlc3RfdXJsKQoKICAgICAgICAgICAgICAgICAgICBpZiByZXNwIGFuZCBhbnkoaW5kaWNhdG9yIGluIHJlc3AudGV4dC5sb3dlcigpIGZvciBpbmRpY2F0b3IgaW4gWwogICAgICAgICAgICAgICAgICAgICAgICAic3FsIHN5bnRheCIsICJteXNxbCBlcnJvciIsICJ1bmNsb3NlZCBxdW90YXRpb24iLCAidW50ZXJtaW5hdGVkIHN0cmluZyIsCiAgICAgICAgICAgICAgICAgICAgICAgICJ3YXJuaW5nOiBteXNxbCIsICJvZGJjIGRyaXZlcnMiLCAic2VydmVyIGVycm9yIiwgIm1pY3Jvc29mdCBvbGVkYiIsCiAgICAgICAgICAgICAgICAgICAgICAgICJzeW50YXggZXJyb3IiLCAibXlzcWxfZmV0Y2giLCAiZ2V0aW1hZ2VzaXplKCkiLCAibXlzcWxpXyIsICJzeWJhc2UiCiAgICAgICAgICAgICAgICAgICAgXSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZ1bG5fZW5kcG9pbnRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogdGVzdF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFyYW0iOiBwYXJhbV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBheWxvYWQiOiBwYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAiR0VUIgogICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIlstXSDQndCw0LnQtNC10L3QsCBTUUwg0LjQvdGK0LXQutGG0LjRjzoge3Rlc3RfdXJsfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIHByaW50KCJbKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INGE0L7RgNC80Ysg0L3QsCBTUUwg0LjQvdGK0LXQutGG0LjQuC4uLiIpCgogICAgICAgIGZvciBmb3JtIGluIGZvcm1zOgogICAgICAgICAgICBmb3IgaW5wdXRfZmllbGQgaW4gZm9ybVsiaW5wdXRzIl06CiAgICAgICAgICAgICAgICBpZiBpbnB1dF9maWVsZFsidHlwZSJdIGluIFsidGV4dCIsICJzZWFyY2giLCAiZW1haWwiLCAidXJsIiwgInBhc3N3b3JkIl06CiAgICAgICAgICAgICAgICAgICAgZm9yIHBheWxvYWQgaW4gc3FsX3BheWxvYWRzOgogICAgICAgICAgICAgICAgICAgICAgICBmb3JtX2RhdGEgPSB7fQoKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGZpZWxkIGluIGZvcm1bImlucHV0cyJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmllbGRbIm5hbWUiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBmaWVsZFsibmFtZSJdID09IGlucHV0X2ZpZWxkWyJuYW1lIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1fZGF0YVtmaWVsZFsibmFtZSJdXSA9IHBheWxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtX2RhdGFbZmllbGRbIm5hbWUiXV0gPSBmaWVsZFsidmFsdWUiXSBvciAidGVzdCIKCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvcm1bIm1ldGhvZCJdID09ICJHRVQiOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcXVlcnkgPSAiJiIuam9pbihbZiJ7a309e3F1b3RlKHYpfSIgZm9yIGssIHYgaW4gZm9ybV9kYXRhLml0ZW1zKCldKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdF91cmwgPSBmIntmb3JtWydhY3Rpb24nXX0/e3F1ZXJ5fSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3AgPSBzZWxmLmhpdF9lbmRwb2ludCh0ZXN0X3VybCkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3AgPSBzZWxmLmhpdF9lbmRwb2ludChmb3JtWyJhY3Rpb24iXSwgbWV0aG9kPSJQT1NUIiwgZGF0YT1mb3JtX2RhdGEpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwIGFuZCBhbnkoaW5kaWNhdG9yIGluIHJlc3AudGV4dC5sb3dlcigpIGZvciBpbmRpY2F0b3IgaW4gWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgInNxbCBzeW50YXgiLCAibXlzcWwgZXJyb3IiLCAidW5jbG9zZWQgcXVvdGF0aW9uIiwgInVudGVybWluYXRlZCBzdHJpbmciLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIndhcm5pbmc6IG15c3FsIiwgIm9kYmMgZHJpdmVycyIsICJzZXJ2ZXIgZXJyb3IiLCAibWljcm9zb2Z0IG9sZWRiIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJzeW50YXggZXJyb3IiLCAibXlzcWxfZmV0Y2giLCAiZ2V0aW1hZ2VzaXplKCkiLCAibXlzcWxpXyIsICJzeWJhc2UiCiAgICAgICAgICAgICAgICAgICAgICAgIF0pOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdnVsbl9lbmRwb2ludHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogZm9ybVsiYWN0aW9uIl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInBhcmFtIjogaW5wdXRfZmllbGRbIm5hbWUiXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGF5bG9hZCI6IHBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiBmb3JtWyJtZXRob2QiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWy1dINCd0LDQudC00LXQvdCwIFNRTCDQuNC90YrQtdC60YbQuNGPINCyINGE0L7RgNC80LU6IHtmb3JtWydhY3Rpb24nXX0gKHBhcmFtOiB7aW5wdXRfZmllbGRbJ25hbWUnXX0pIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGlmIHZ1bG5fZW5kcG9pbnRzOgogICAgICAgICAgICByZXR1cm4geyJ2dWxuZXJhYmxlIjogVHJ1ZSwgImVuZHBvaW50cyI6IHZ1bG5fZW5kcG9pbnRzfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJbK10gU1FMINC40L3RitC10LrRhtC40Lgg0L3QtSDQvtCx0L3QsNGA0YPQttC10L3RiyIpCiAgICAgICAgICAgIHJldHVybiB7InZ1bG5lcmFibGUiOiBGYWxzZSwgImVuZHBvaW50cyI6IFtdfQoKICAgIGRlZiBjaGVja19mb3JfeHNzKHNlbGYsIHVybCwgZm9ybXMpOgogICAgICAgIHhzc19wYXlsb2FkcyA9IFsKICAgICAgICAgICAgIjxzY3JpcHQ+YWxlcnQoMSk8L3NjcmlwdD4iLAogICAgICAgICAgICAiPGltZyBzcmM9eCBvbmVycm9yPWFsZXJ0KDEpPiIsCiAgICAgICAgICAgICI8c3ZnIG9ubG9hZD1hbGVydCgxKT4iLAogICAgICAgICAgICAiamF2YXNjcmlwdDphbGVydCgxKSIsCiAgICAgICAgICAgICJcIj48c2NyaXB0PmFsZXJ0KDEpPC9zY3JpcHQ+IiwKICAgICAgICAgICAgIic+PHNjcmlwdD5hbGVydCgxKTwvc2NyaXB0PiIsCiAgICAgICAgICAgICI8Ym9keSBvbmxvYWQ9YWxlcnQoMSk+IiwKICAgICAgICAgICAgIjxzQ1JpcHQ+YWxlcnQoMSk8L3NDUmlwdD4iCiAgICAgICAgXQoKICAgICAgICB2dWxuX2VuZHBvaW50cyA9IFtdCgogICAgICAgIHByaW50KCJbKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INC/0LDRgNCw0LzQtdGC0YDRiyBVUkwg0L3QsCBYU1MuLi4iKQoKICAgICAgICBwYXJzZWRfdXJsID0gdXJscGFyc2UodXJsKQoKICAgICAgICBpZiBwYXJzZWRfdXJsLnF1ZXJ5OgogICAgICAgICAgICBwYXJhbXMgPSBwYXJzZV9xcyhwYXJzZWRfdXJsLnF1ZXJ5KQoKICAgICAgICAgICAgZm9yIHBhcmFtX25hbWUsIHBhcmFtX3ZhbHVlcyBpbiBwYXJhbXMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGJhc2VfdXJsID0gdXJsLnNwbGl0KCc/JylbMF0KCiAgICAgICAgICAgICAgICBmb3IgcGF5bG9hZCBpbiB4c3NfcGF5bG9hZHM6CiAgICAgICAgICAgICAgICAgICAgdGVzdF91cmwgPSBmIntiYXNlX3VybH0/e3BhcmFtX25hbWV9PXtxdW90ZShwYXlsb2FkKX0iCiAgICAgICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHRlc3RfdXJsKQoKICAgICAgICAgICAgICAgICAgICBpZiByZXNwIGFuZCBwYXlsb2FkIGluIHJlc3AudGV4dDoKICAgICAgICAgICAgICAgICAgICAgICAgdnVsbl9lbmRwb2ludHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1cmwiOiB0ZXN0X3VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXJhbSI6IHBhcmFtX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGF5bG9hZCI6IHBheWxvYWQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6ICJHRVQiCiAgICAgICAgICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWy1dINCd0LDQudC00LXQvdCwIFhTUzoge3Rlc3RfdXJsfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIHByaW50KCJbKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INGE0L7RgNC80Ysg0L3QsCBYU1MuLi4iKQoKICAgICAgICBmb3IgZm9ybSBpbiBmb3JtczoKICAgICAgICAgICAgZm9yIGlucHV0X2ZpZWxkIGluIGZvcm1bImlucHV0cyJdOgogICAgICAgICAgICAgICAgaWYgaW5wdXRfZmllbGRbInR5cGUiXSBpbiBbInRleHQiLCAic2VhcmNoIiwgImVtYWlsIiwgInVybCIsICJ0ZXh0YXJlYSJdOgogICAgICAgICAgICAgICAgICAgIGZvciBwYXlsb2FkIGluIHhzc19wYXlsb2FkczoKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybV9kYXRhID0ge30KCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBmaWVsZCBpbiBmb3JtWyJpbnB1dHMiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZpZWxkWyJuYW1lIl06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgZmllbGRbIm5hbWUiXSA9PSBpbnB1dF9maWVsZFsibmFtZSJdOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3JtX2RhdGFbZmllbGRbIm5hbWUiXV0gPSBwYXlsb2FkCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybV9kYXRhW2ZpZWxkWyJuYW1lIl1dID0gZmllbGRbInZhbHVlIl0gb3IgInRlc3QiCgogICAgICAgICAgICAgICAgICAgICAgICBpZiBmb3JtWyJtZXRob2QiXSA9PSAiR0VUIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXJ5ID0gIiYiLmpvaW4oW2Yie2t9PXtxdW90ZSh2KX0iIGZvciBrLCB2IGluIGZvcm1fZGF0YS5pdGVtcygpXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RfdXJsID0gZiJ7Zm9ybVsnYWN0aW9uJ119P3txdWVyeX0iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQodGVzdF91cmwpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQoZm9ybVsiYWN0aW9uIl0sIG1ldGhvZD0iUE9TVCIsIGRhdGE9Zm9ybV9kYXRhKQoKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcCBhbmQgcGF5bG9hZCBpbiByZXNwLnRleHQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2dWxuX2VuZHBvaW50cy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1cmwiOiBmb3JtWyJhY3Rpb24iXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFyYW0iOiBpbnB1dF9maWVsZFsibmFtZSJdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXlsb2FkIjogcGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidHlwZSI6IGZvcm1bIm1ldGhvZCJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J3QsNC50LTQtdC90LAgWFNTINCyINGE0L7RgNC80LU6IHtmb3JtWydhY3Rpb24nXX0gKHBhcmFtOiB7aW5wdXRfZmllbGRbJ25hbWUnXX0pIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGlmIHZ1bG5fZW5kcG9pbnRzOgogICAgICAgICAgICByZXR1cm4geyJ2dWxuZXJhYmxlIjogVHJ1ZSwgImVuZHBvaW50cyI6IHZ1bG5fZW5kcG9pbnRzfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJbK10gWFNTINC90LUg0L7QsdC90LDRgNGD0LbQtdC90YsiKQogICAgICAgICAgICByZXR1cm4geyJ2dWxuZXJhYmxlIjogRmFsc2UsICJlbmRwb2ludHMiOiBbXX0KCiAgICBkZWYgY2hlY2tfZm9yX29wZW5fcmVkaXJlY3Qoc2VsZiwgdXJsLCBmb3Jtcyk6CiAgICAgICAgcmVkaXJlY3RfcGF5bG9hZHMgPSBbCiAgICAgICAgICAgICJodHRwczovL2V4YW1wbGUuY29tIiwKICAgICAgICAgICAgIi8vZXhhbXBsZS5jb20iLAogICAgICAgICAgICAiXFxcXGV4YW1wbGUuY29tIiwKICAgICAgICAgICAgImV4YW1wbGUuY29tIiwKICAgICAgICAgICAgIiUyRiUyRmV4YW1wbGUuY29tIiwKICAgICAgICAgICAgImphdmFzY3JpcHQ6YWxlcnQoZG9jdW1lbnQuZG9tYWluKSIKICAgICAgICBdCgogICAgICAgIHZ1bG5fZW5kcG9pbnRzID0gW10KCiAgICAgICAgcHJpbnQoIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0L/QsNGA0LDQvNC10YLRgNGLIFVSTCDQvdCwINC+0YLQutGA0YvRgtC+0LUg0L/QtdGA0LXQvdCw0L/RgNCw0LLQu9C10L3QuNC1Li4uIikKCiAgICAgICAgcGFyc2VkX3VybCA9IHVybHBhcnNlKHVybCkKCiAgICAgICAgaWYgcGFyc2VkX3VybC5xdWVyeToKICAgICAgICAgICAgcGFyYW1zID0gcGFyc2VfcXMocGFyc2VkX3VybC5xdWVyeSkKCiAgICAgICAgICAgIGZvciBwYXJhbV9uYW1lLCBwYXJhbV92YWx1ZXMgaW4gcGFyYW1zLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBpZiBhbnkocmVkaXJlY3RfcGFyYW0gaW4gcGFyYW1fbmFtZS5sb3dlcigpIGZvciByZWRpcmVjdF9wYXJhbSBpbgogICAgICAgICAgICAgICAgICAgICAgIFsicmVkaXJlY3QiLCAidXJsIiwgIm5leHQiLCAiZ290byIsICJyZXR1cm4iLCAicmV0dXJudG8iLCAicmV0dXJudXJsIiwgImNvbnRpbnVlIiwgInJldHVybl90byIsCiAgICAgICAgICAgICAgICAgICAgICAgICJyZXR1cm5fcGF0aCIsICJwYXRoIl0pOgogICAgICAgICAgICAgICAgICAgIGJhc2VfdXJsID0gdXJsLnNwbGl0KCc/JylbMF0KCiAgICAgICAgICAgICAgICAgICAgZm9yIHBheWxvYWQgaW4gcmVkaXJlY3RfcGF5bG9hZHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHRlc3RfdXJsID0gZiJ7YmFzZV91cmx9P3twYXJhbV9uYW1lfT17cXVvdGUocGF5bG9hZCl9IgogICAgICAgICAgICAgICAgICAgICAgICByZXNwID0gc2VsZi5oaXRfZW5kcG9pbnQodGVzdF91cmwsIGZvbGxvd19yZWRpcmVjdHM9RmFsc2UpCgogICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwIGFuZCByZXNwLnN0YXR1c19jb2RlIGluIFszMDEsIDMwMiwgMzAzLCAzMDcsIDMwOF06CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2NhdGlvbiA9IHJlc3AuaGVhZGVycy5nZXQoJ0xvY2F0aW9uJywgJycpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhbnkoaW5kaWNhdG9yIGluIGxvY2F0aW9uIGZvciBpbmRpY2F0b3IgaW4gWyJleGFtcGxlLmNvbSIsICJqYXZhc2NyaXB0OiJdKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2dWxuX2VuZHBvaW50cy5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogdGVzdF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXJhbSI6IHBhcmFtX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXlsb2FkIjogcGF5bG9hZCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxvY2F0aW9uIjogbG9jYXRpb24KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiWy1dINCd0LDQudC00LXQvdC+INC+0YLQutGA0YvRgtC+0LUg0L/QtdGA0LXQvdCw0L/RgNCw0LLQu9C10L3QuNC1OiB7dGVzdF91cmx9IC0+IHtsb2NhdGlvbn0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCgogICAgICAgIGlmIHZ1bG5fZW5kcG9pbnRzOgogICAgICAgICAgICByZXR1cm4geyJ2dWxuZXJhYmxlIjogVHJ1ZSwgImVuZHBvaW50cyI6IHZ1bG5fZW5kcG9pbnRzfQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJbK10g0J7RgtC60YDRi9GC0YvQtSDQv9C10YDQtdC90LDQv9GA0LDQstC70LXQvdC40Y8g0L3QtSDQvtCx0L3QsNGA0YPQttC10L3RiyIpCiAgICAgICAgICAgIHJldHVybiB7InZ1bG5lcmFibGUiOiBGYWxzZSwgImVuZHBvaW50cyI6IFtdfQoKICAgIGRlZiBjaGVja19mb3JfbGZpKHNlbGYsIHVybCk6CiAgICAgICAgbGZpX3BheWxvYWRzID0gWwogICAgICAgICAgICAiLi4vLi4vLi4vZXRjL3Bhc3N3ZCIsCiAgICAgICAgICAgICIuLi8uLi8uLi9XaW5kb3dzL3dpbi5pbmkiLAogICAgICAgICAgICAiLi4vLi4vLi4vLi4vZXRjL3Bhc3N3ZCIsCiAgICAgICAgICAgICIuLi8uLi8uLi8uLi9XaW5kb3dzL3dpbi5pbmkiLAogICAgICAgICAgICAiLi4lMmYuLiUyZi4uJTJmZXRjJTJmcGFzc3dkIiwKICAgICAgICAgICAgIi4uJTVjLi4lNWMuLiU1Y1dpbmRvd3MlNWN3aW4uaW5pIiwKICAgICAgICAgICAgIiUyZSUyZSUyZiUyZSUyZSUyZiUyZSUyZSUyZmV0YyUyZnBhc3N3ZCIsCiAgICAgICAgICAgICIlMmUlMmUlNWMlMmUlMmUlNWMlMmUlMmUlNWNXaW5kb3dzJTVjd2luLmluaSIKICAgICAgICBdCgogICAgICAgIGxmaV9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAicm9vdDp4OiIsCiAgICAgICAgICAgICJbZm9udHNdIiwKICAgICAgICAgICAgIm1haWw6eDoiLAogICAgICAgICAgICAibm9ib2R5Ong6IiwKICAgICAgICAgICAgImJpbjp4OiIsCiAgICAgICAgICAgICJkYWVtb246eDoiCiAgICAgICAgXQoKICAgICAgICB2dWxuX2VuZHBvaW50cyA9IFtdCgogICAgICAgIHByaW50KCJbKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INC/0LDRgNCw0LzQtdGC0YDRiyBVUkwg0L3QsCBMRkkuLi4iKQoKICAgICAgICBwYXJzZWRfdXJsID0gdXJscGFyc2UodXJsKQoKICAgICAgICBpZiBwYXJzZWRfdXJsLnF1ZXJ5OgogICAgICAgICAgICBwYXJhbXMgPSBwYXJzZV9xcyhwYXJzZWRfdXJsLnF1ZXJ5KQoKICAgICAgICAgICAgZm9yIHBhcmFtX25hbWUsIHBhcmFtX3ZhbHVlcyBpbiBwYXJhbXMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGJhc2VfdXJsID0gdXJsLnNwbGl0KCc/JylbMF0KCiAgICAgICAgICAgICAgICBmb3IgcGF5bG9hZCBpbiBsZmlfcGF5bG9hZHM6CiAgICAgICAgICAgICAgICAgICAgdGVzdF91cmwgPSBmIntiYXNlX3VybH0/e3BhcmFtX25hbWV9PXtxdW90ZShwYXlsb2FkKX0iCiAgICAgICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHRlc3RfdXJsKQoKICAgICAgICAgICAgICAgICAgICBpZiByZXNwIGFuZCBhbnkoaW5kaWNhdG9yIGluIHJlc3AudGV4dCBmb3IgaW5kaWNhdG9yIGluIGxmaV9pbmRpY2F0b3JzKToKICAgICAgICAgICAgICAgICAgICAgICAgdnVsbl9lbmRwb2ludHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJ1cmwiOiB0ZXN0X3VybCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJwYXJhbSI6IHBhcmFtX25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGF5bG9hZCI6IHBheWxvYWQKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J3QsNC50LTQtdC90LAgTEZJOiB7dGVzdF91cmx9IikKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKCiAgICAgICAgaWYgdnVsbl9lbmRwb2ludHM6CiAgICAgICAgICAgIHJldHVybiB7InZ1bG5lcmFibGUiOiBUcnVlLCAiZW5kcG9pbnRzIjogdnVsbl9lbmRwb2ludHN9CiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoIlsrXSBMRkkg0L3QtSDQvtCx0L3QsNGA0YPQttC10L3RiyIpCiAgICAgICAgICAgIHJldHVybiB7InZ1bG5lcmFibGUiOiBGYWxzZSwgImVuZHBvaW50cyI6IFtdfQoKICAgIGRlZiBjaGVja19mb3JfcmNlKHNlbGYsIHVybCk6CiAgICAgICAgcmNlX3BheWxvYWRzID0gWwogICAgICAgICAgICAiaWQiLAogICAgICAgICAgICAid2hvYW1pIiwKICAgICAgICAgICAgInVuYW1lIC1hIiwKICAgICAgICAgICAgImxzIC1sYSIsCiAgICAgICAgICAgICI7aWQ7IiwKICAgICAgICAgICAgIiYgd2hvYW1pICYiLAogICAgICAgICAgICAifCBjYXQgL2V0Yy9wYXNzd2QiLAogICAgICAgICAgICAic2xlZXAgNSIKICAgICAgICBdCgogICAgICAgIHJjZV9pbmRpY2F0b3JzID0gWwogICAgICAgICAgICAidWlkPSIsCiAgICAgICAgICAgICJnaWQ9IiwKICAgICAgICAgICAgInJvb3Q6eDoiLAogICAgICAgICAgICAiTGludXgiLAogICAgICAgICAgICAiV2luZG93cyIKICAgICAgICBdCgogICAgICAgIHZ1bG5fZW5kcG9pbnRzID0gW10KCiAgICAgICAgcHJpbnQoIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0L/QsNGA0LDQvNC10YLRgNGLIFVSTCDQvdCwIFJDRS4uLiIpCgogICAgICAgIHBhcnNlZF91cmwgPSB1cmxwYXJzZSh1cmwpCgogICAgICAgIGlmIHBhcnNlZF91cmwucXVlcnk6CiAgICAgICAgICAgIHBhcmFtcyA9IHBhcnNlX3FzKHBhcnNlZF91cmwucXVlcnkpCgogICAgICAgICAgICBmb3IgcGFyYW1fbmFtZSwgcGFyYW1fdmFsdWVzIGluIHBhcmFtcy5pdGVtcygpOgogICAgICAgICAgICAgICAgYmFzZV91cmwgPSB1cmwuc3BsaXQoJz8nKVswXQoKICAgICAgICAgICAgICAgIGZvciBwYXlsb2FkIGluIHJjZV9wYXlsb2FkczoKICAgICAgICAgICAgICAgICAgICB0ZXN0X3VybCA9IGYie2Jhc2VfdXJsfT97cGFyYW1fbmFtZX09e3F1b3RlKHBheWxvYWQpfSIKCiAgICAgICAgICAgICAgICAgICAgc3RhcnRfdGltZSA9IHRpbWUudGltZSgpCiAgICAgICAgICAgICAgICAgICAgcmVzcCA9IHNlbGYuaGl0X2VuZHBvaW50KHRlc3RfdXJsKQogICAgICAgICAgICAgICAgICAgIGVuZF90aW1lID0gdGltZS50aW1lKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzcCBhbmQgYW55KGluZGljYXRvciBpbiByZXNwLnRleHQgZm9yIGluZGljYXRvciBpbiByY2VfaW5kaWNhdG9ycyk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZ1bG5fZW5kcG9pbnRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogdGVzdF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFyYW0iOiBwYXJhbV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBheWxvYWQiOiBwYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAicGF0dGVybl9tYXRjaCIKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J3QsNC50LTQtdC9IFJDRToge3Rlc3RfdXJsfSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICAgICAgZWxpZiBwYXlsb2FkID09ICJzbGVlcCA1IiBhbmQgKGVuZF90aW1lIC0gc3RhcnRfdGltZSA+IDQuNSk6CiAgICAgICAgICAgICAgICAgICAgICAgIHZ1bG5fZW5kcG9pbnRzLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAidXJsIjogdGVzdF91cmwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAicGFyYW0iOiBwYXJhbV9uYW1lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInBheWxvYWQiOiBwYXlsb2FkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgInR5cGUiOiAidGltZV9iYXNlZCIKICAgICAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J3QsNC50LTQtdC9IFJDRSAo0YLQsNC50Lwt0LHQtdC50LfQtCk6IHt0ZXN0X3VybH0iKQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawoKICAgICAgICBpZiB2dWxuX2VuZHBvaW50czoKICAgICAgICAgICAgcmV0dXJuIHsidnVsbmVyYWJsZSI6IFRydWUsICJlbmRwb2ludHMiOiB2dWxuX2VuZHBvaW50c30KICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludCgiWytdIFJDRSDQvdC1INC+0LHQvdCw0YDRg9C20LXQvdGLIikKICAgICAgICAgICAgcmV0dXJuIHsidnVsbmVyYWJsZSI6IEZhbHNlLCAiZW5kcG9pbnRzIjogW119CgogICAgZGVmIHNjYW5fdnVsbmVyYWJpbGl0aWVzKHNlbGYsIHVybCwgc2Nhbl9yZXN1bHRzPU5vbmUpOgogICAgICAgIGlmIHNjYW5fcmVzdWx0cyBpcyBOb25lOgogICAgICAgICAgICBmcm9tIEJydWhQZW50ZXN0LndlYl9zY2FubmVyIGltcG9ydCBXZWJTY2FubmVyCiAgICAgICAgICAgIHdlYl9zY2FubmVyID0gV2ViU2Nhbm5lcigpCiAgICAgICAgICAgIHNjYW5fcmVzdWx0cyA9IHdlYl9zY2FubmVyLnNjYW5fd2Vic2l0ZSh1cmwpCgogICAgICAgIHZ1bG5fcmVzdWx0cyA9IHt9CgogICAgICAgIHByaW50KGYiWypdINCd0LDRh9C40L3QsNC10Lwg0L/RgNC+0LLQtdGA0LrRgyDQsdC10LfQvtC/0LDRgdC90L7RgdGC0Lgg0LTQu9GPOiB7dXJsfSIpCgogICAgICAgIHByaW50KGYiWypdINCf0YDQvtCy0LXRgNGP0LXQvCBTU0wvVExTLi4uIikKICAgICAgICB2dWxuX3Jlc3VsdHNbInNzbF9jaGVjayJdID0gc2VsZi5jaGVja19zc2wodXJsKQoKICAgICAgICBwcmludChmIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0LfQsNCz0L7Qu9C+0LLQutC4INCx0LXQt9C+0L/QsNGB0L3QvtGB0YLQuC4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJoZWFkZXJzX2NoZWNrIl0gPSBzZWxmLmNoZWNrX2hlYWRlcnModXJsKQoKICAgICAgICBwcmludChmIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtGMINC60YPQui4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJjb29raWVzX2NoZWNrIl0gPSBzZWxmLmNoZWNrX2Nvb2tpZXModXJsKQoKICAgICAgICBwcmludChmIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0L3QsCBTUUwg0LjQvdGK0LXQutGG0LjQuC4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJzcWxfaW5qZWN0aW9uIl0gPSBzZWxmLmNoZWNrX2Zvcl9zcWxfaW5qZWN0aW9uKHVybCwgc2Nhbl9yZXN1bHRzLmdldCgiZm9ybXMiLCBbXSkpCgogICAgICAgIHByaW50KGYiWypdINCf0YDQvtCy0LXRgNGP0LXQvCDQvdCwIFhTUy4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJ4c3MiXSA9IHNlbGYuY2hlY2tfZm9yX3hzcyh1cmwsIHNjYW5fcmVzdWx0cy5nZXQoImZvcm1zIiwgW10pKQoKICAgICAgICBwcmludChmIlsqXSDQn9GA0L7QstC10YDRj9C10Lwg0L3QsCDQvtGC0LrRgNGL0YLRi9C1INGA0LXQtNC40YDQtdC60YLRiy4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJvcGVuX3JlZGlyZWN0Il0gPSBzZWxmLmNoZWNrX2Zvcl9vcGVuX3JlZGlyZWN0KHVybCwgc2Nhbl9yZXN1bHRzLmdldCgiZm9ybXMiLCBbXSkpCgogICAgICAgIHByaW50KGYiWypdINCf0YDQvtCy0LXRgNGP0LXQvCDQvdCwIExGSS4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJsZmkiXSA9IHNlbGYuY2hlY2tfZm9yX2xmaSh1cmwpCgogICAgICAgIHByaW50KGYiWypdINCf0YDQvtCy0LXRgNGP0LXQvCDQvdCwIFJDRS4uLiIpCiAgICAgICAgdnVsbl9yZXN1bHRzWyJyY2UiXSA9IHNlbGYuY2hlY2tfZm9yX3JjZSh1cmwpCgogICAgICAgIHByaW50KGYiWytdINCf0YDQvtCy0LXRgNC60LAg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4INC30LDQstC10YDRiNC10L3QsCEiKQoKICAgICAgICByZXR1cm4gdnVsbl9yZXN1bHRz').decode('utf-8'))