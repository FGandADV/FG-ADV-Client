import base64;exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBzeXMKaW1wb3J0IHRpbWUKaW1wb3J0IHNvY2tldAppbXBvcnQgY29uY3VycmVudC5mdXR1cmVzCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lCmZyb20gdXJsbGliLnBhcnNlIGltcG9ydCB1cmxwYXJzZQppbXBvcnQganNvbgoKc3lzLnBhdGguYXBwZW5kKG9zLnBhdGguZGlybmFtZShvcy5wYXRoLmRpcm5hbWUob3MucGF0aC5hYnNwYXRoKF9fZmlsZV9fKSkpKQpmcm9tIEJydWhQZW50ZXN0LnV0aWxzIGltcG9ydCBjbGVhcl9zY3JlZW4sIGRpc3BsYXlfYmFubmVyLCBwYXJzZV91cmwsIGdldF9yYW5kb21fdXNlcl9hZ2VudApmcm9tIEJydWhQZW50ZXN0LndlYl9zY2FubmVyIGltcG9ydCBXZWJTY2FubmVyCmZyb20gQnJ1aFBlbnRlc3Quc2VjdXJpdHlfc2Nhbm5lciBpbXBvcnQgU2VjdXJpdHlTY2FubmVyCmZyb20gQnJ1aFBlbnRlc3QuZXhwbG9pdF9zY2FubmVyIGltcG9ydCBFeHBsb2l0U2Nhbm5lcgoKCmNsYXNzIFBlbnRlc3RUb29sOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYud2ViX3NjYW5uZXIgPSBXZWJTY2FubmVyKCkKICAgICAgICBzZWxmLnNlY19zY2FubmVyID0gU2VjdXJpdHlTY2FubmVyKCkKICAgICAgICBzZWxmLmV4cGxvaXRfc2Nhbm5lciA9IEV4cGxvaXRTY2FubmVyKCkKCiAgICBkZWYgbWFpbl9tZW51KHNlbGYpOgogICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgICAgIGRpc3BsYXlfYmFubmVyKCkKICAgICAgICAgICAgcHJpbnQoIlsqXSDQk9C70LDQstC90L7QtSDQvNC10L3RjjoiKQogICAgICAgICAgICBwcmludCgiICAxLiDQo9C60LDQt9Cw0YLRjCBVUkwiKQogICAgICAgICAgICBwcmludCgiICAyLiDQktGL0YXQvtC0IikKICAgICAgICAgICAgY2hvaWNlID0gaW5wdXQoIlxuPj4+ICIpCgogICAgICAgICAgICBpZiBjaG9pY2UgPT0gIjEiOgogICAgICAgICAgICAgICAgc2VsZi5zZXRfdGFyZ2V0X3VybCgpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgICAgICAgICBkaXNwbGF5X2Jhbm5lcigpCiAgICAgICAgICAgICAgICBwcmludCgiWypdINCS0YvRhdC+0LQg0LjQtyDQv9GA0L7Qs9GA0LDQvNC80YsuLi4iKQogICAgICAgICAgICAgICAgc3lzLmV4aXQoMCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgICAgICAgICBkaXNwbGF5X2Jhbm5lcigpCiAgICAgICAgICAgICAgICBwcmludCgiWy1dINCd0LXQstC10YDQvdGL0Lkg0LLRi9Cx0L7RgC4g0J/QvtC/0YDQvtCx0YPQuSDQtdGJ0LUg0YDQsNC3LiIpCiAgICAgICAgICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0LTQu9GPINCy0L7Qt9Cy0YDQsNGC0LAuLi4iKQoKICAgIGRlZiBzZXRfdGFyZ2V0X3VybChzZWxmKToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGRpc3BsYXlfYmFubmVyKCkKICAgICAgICBwcmludCgiWypdINCS0LLQtdC00LggVVJMINGB0LDQudGC0LAg0LTQu9GPINCw0L3QsNC70LjQt9CwOiIpCiAgICAgICAgdXJsID0gaW5wdXQoIj4+PiAiKS5zdHJpcCgpCgogICAgICAgIGlmIG5vdCB1cmw6CiAgICAgICAgICAgIHByaW50KCJbLV0gVVJMINC90LUg0LzQvtC20LXRgiDQsdGL0YLRjCDQv9GD0YHRgtGL0LwiKQogICAgICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0LTQu9GPINCy0L7Qt9Cy0YDQsNGC0LAuLi4iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgdXJsID0gcGFyc2VfdXJsKHVybCkKICAgICAgICBzZWxmLnJ1bl9hbmFseXNpc19tZW51KHVybCkKCiAgICBkZWYgcnVuX2FuYWx5c2lzX21lbnUoc2VsZiwgdXJsKToKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgICAgICBkaXNwbGF5X2Jhbm5lcigpCiAgICAgICAgICAgIHByaW50KGYiWypdINCm0LXQu9GMOiB7dXJsfSIpCiAgICAgICAgICAgIHByaW50KCJbKl0g0JLRi9Cx0LXRgNC4INC00LXQudGB0YLQstC40LU6IikKICAgICAgICAgICAgcHJpbnQoIiAgMS4g0J/QvtC70L3Ri9C5INCw0L3QsNC70LjQtyIpCiAgICAgICAgICAgIHByaW50KCIgIDIuINCg0LDRgdGI0LjRgNC10L3QvdC+0LUg0YHQutCw0L3QuNGA0L7QstCw0L3QuNC1IikKICAgICAgICAgICAgcHJpbnQoIiAgMy4g0J3QsNC30LDQtCIpCiAgICAgICAgICAgIGNob2ljZSA9IGlucHV0KCJcbj4+PiAiKQoKICAgICAgICAgICAgaWYgY2hvaWNlID09ICIxIjoKICAgICAgICAgICAgICAgIHNlbGYuZnVsbF9hbmFseXNpcyh1cmwpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICAgICAgICAgIHNlbGYuYWR2YW5jZWRfc2Nhbm5pbmdfbWVudSh1cmwpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIzIjoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSDQndC10LLQtdGA0L3Ri9C5INCy0YvQsdC+0YAiKQogICAgICAgICAgICAgICAgaW5wdXQoIlxu0JbQvNC4IEVudGVyINGH0YLQvtCxINC/0YDQvtC00L7Qu9C20LjRgtGMLi4uIikKCiAgICBkZWYgZnVsbF9hbmFseXNpcyhzZWxmLCB1cmwpOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZGlzcGxheV9iYW5uZXIoKQogICAgICAgIHByaW50KGYiWypdINCf0L7Qs9C90LDQu9C4INCw0L3QsNC70LjQt9C40YDQvtCy0LDRgtGMIHt1cmx9Li4uXG4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHByaW50KGYiWypdINCh0LrQsNC90LjRgNGD0LXQvCDRgdCw0LnRgi4uLiIpCiAgICAgICAgICAgIHNjYW5fcmVzdWx0cyA9IHNlbGYud2ViX3NjYW5uZXIuc2Nhbl93ZWJzaXRlKHVybCkKCiAgICAgICAgICAgIHNlcnZlcl9pbmZvID0gc2Nhbl9yZXN1bHRzLmdldCgic2VydmVyX2luZm8iLCB7fSkKICAgICAgICAgICAgcHJpbnQoIlsrXSDQmNC90YTQsCDQviDRgdC10YDQstC10YDQtToiKQogICAgICAgICAgICBwcmludChmIiAgLSDQodGC0LDRgtGD0YEg0LrQvtC0OiB7c2VydmVyX2luZm8uZ2V0KCdzdGF0dXNfY29kZScsICfQnS/QlCcpfSIpCiAgICAgICAgICAgIHByaW50KGYiICAtINCh0LXRgNCy0LXRgDoge3NlcnZlcl9pbmZvLmdldCgnc2VydmVyJywgJ9Cl0LcnKX0iKQogICAgICAgICAgICBwcmludChmIiAgLSDQotC10YXQvdC+0LvQvtCz0LjRjzoge3NlcnZlcl9pbmZvLmdldCgneF9wb3dlcmVkX2J5JywgJ9Cl0LcnKX0iKQogICAgICAgICAgICBwcmludChmIiAgLSDQotC40L8g0LrQvtC90YLQtdC90YLQsDoge3NlcnZlcl9pbmZvLmdldCgnY29udGVudF90eXBlJywgJ9Cl0LcnKX0iKQoKICAgICAgICAgICAgd2FmX2RldGVjdGVkID0gc2Nhbl9yZXN1bHRzLmdldCgid2FmX2RldGVjdGVkIiwgRmFsc2UpCiAgICAgICAgICAgIHByaW50KGYiXG5bK10gV0FGOiB7J9Ce0LHQvdCw0YDRg9C20LXQvScgaWYgd2FmX2RldGVjdGVkIGVsc2UgJ9Cd0LUg0L7QsdC90LDRgNGD0LbQtdC9J30iKQoKICAgICAgICAgICAgcm9ib3RzX3R4dCA9IHNjYW5fcmVzdWx0cy5nZXQoInJvYm90c190eHQiLCBbXSkKICAgICAgICAgICAgaWYgcm9ib3RzX3R4dDoKICAgICAgICAgICAgICAgIHByaW50KCJcblsrXSDQntCx0L3QsNGA0YPQttC10L3RiyDQv9GD0YLQuCDQsiByb2JvdHMudHh0OiIpCiAgICAgICAgICAgICAgICBmb3IgcGF0aCBpbiByb2JvdHNfdHh0WzoxMF06CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge3BhdGh9IikKICAgICAgICAgICAgICAgIGlmIGxlbihyb2JvdHNfdHh0KSA+IDEwOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAuLi4g0Lgg0LXRidC1IHtsZW4ocm9ib3RzX3R4dCkgLSAxMH0g0L/Rg9GC0LXQuSIpCgogICAgICAgICAgICBwcmludCgiXG5bKl0g0J7RgtC60YDRi9GC0YvQtSDQv9C+0YDRgtGLOiIpCiAgICAgICAgICAgIGRvbWFpbiA9IHVybHBhcnNlKHVybCkubmV0bG9jLnNwbGl0KCc6JylbMF0KICAgICAgICAgICAgcG9ydHMgPSBzZWxmLndlYl9zY2FubmVyLnBvcnRfc2Nhbihkb21haW4pCiAgICAgICAgICAgIGlmIHBvcnRzOgogICAgICAgICAgICAgICAgZm9yIHBvcnQsIHNlcnZpY2UgaW4gcG9ydHMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSDQn9C+0YDRgiB7cG9ydH06IHtzZXJ2aWNlfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiICAtINCe0YLQutGA0YvRgtGL0YUg0L/QvtGA0YLQvtCyINC90LUg0L3QsNC50LTQtdC90L4iKQoKICAgICAgICAgICAgcHJpbnQoIlxuWypdINCd0LDQudC00LXQvdC90YvQtSDQtNC40YDQtdC60YLQvtGA0LjQuDoiKQogICAgICAgICAgICBkaXJlY3RvcmllcyA9IHNjYW5fcmVzdWx0cy5nZXQoImRpcmVjdG9yaWVzIiwgW10pCiAgICAgICAgICAgIGlmIGRpcmVjdG9yaWVzOgogICAgICAgICAgICAgICAgZm9yIGRpcmVjdG9yeSBpbiBkaXJlY3Rvcmllc1s6MTBdOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHtkaXJlY3Rvcnl9IikKICAgICAgICAgICAgICAgIGlmIGxlbihkaXJlY3RvcmllcykgPiAxMDoKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLi4uINC4INC10YnQtSB7bGVuKGRpcmVjdG9yaWVzKSAtIDEwfSDQtNC40YDQtdC60YLQvtGA0LjQuSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiICAtINCU0LjRgNC10LrRgtC+0YDQuNC4INC90LUg0L3QsNC50LTQtdC90YsiKQoKICAgICAgICAgICAgcHJpbnQoIlxuWypdINCd0LDQudC00LXQvdC90YvQtSDQsNC00LzQuNC90LrQuDoiKQogICAgICAgICAgICBhZG1pbl9wYW5lbHMgPSBzY2FuX3Jlc3VsdHMuZ2V0KCJhZG1pbl9wYW5lbHMiLCBbXSkKICAgICAgICAgICAgaWYgYWRtaW5fcGFuZWxzOgogICAgICAgICAgICAgICAgZm9yIHBhbmVsIGluIGFkbWluX3BhbmVsczoKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7cGFuZWx9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCIgIC0g0JDQtNC80LjQvdC60Lgg0L3QtSDQvdCw0LnQtNC10L3RiyIpCgogICAgICAgICAgICBwcmludCgiXG5bKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INGD0Y/Qt9Cy0LjQvNC+0YHRgtC4Li4uIikKICAgICAgICAgICAgdnVsbl9yZXN1bHRzID0gc2VsZi5zZWNfc2Nhbm5lci5zY2FuX3Z1bG5lcmFiaWxpdGllcyh1cmwsIHNjYW5fcmVzdWx0cykKCiAgICAgICAgICAgIHByaW50KCJcblsrXSDQoNC10LfRg9C70YzRgtCw0YLRiyDRgdC60LDQvdC40YDQvtCy0LDQvdC40Y8g0YPRj9C30LLQuNC80L7RgdGC0LXQuToiKQogICAgICAgICAgICBmb3IgdnVsbl90eXBlLCBkYXRhIGluIHZ1bG5fcmVzdWx0cy5pdGVtcygpOgogICAgICAgICAgICAgICAgc3RhdHVzID0gItCj0K/Ql9CS0JjQnNCeIiBpZiBkYXRhLmdldCgidnVsbmVyYWJsZSIsIEZhbHNlKSBlbHNlICLQndCVINCe0JHQndCQ0KDQo9CW0JXQndCeIgogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge3Z1bG5fdHlwZX06IHtzdGF0dXN9IikKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQktGB0ZEg0L/QvtC70LXRgtC10LvQviDQuiDRh9C10YDRgtGP0Lw6IHtzdHIoZSl9IikKICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0YfRgtC+0LEg0LLQtdGA0L3Rg9GC0YzRgdGPINCyINC80LXQvdGOLi4uIikKCiAgICBkZWYgYXV0b19leHBsb2l0X3Z1bG5lcmFiaWxpdGllcyhzZWxmLCB1cmwpOgogICAgICAgIGNsZWFyX3NjcmVlbigpCiAgICAgICAgZGlzcGxheV9iYW5uZXIoKQogICAgICAgIHByaW50KGYiWypdINCX0LDQv9GD0YHQutCw0LXQvCDQsNCy0YLQvtGN0LrRgdC/0LvQvtC50YIg0LTQu9GPIHt1cmx9Li4uXG4iKQogICAgICAgIHRyeToKICAgICAgICAgICAgc2Nhbl9yZXN1bHRzID0gc2VsZi53ZWJfc2Nhbm5lci5zY2FuX3dlYnNpdGUodXJsKQogICAgICAgICAgICB2dWxuX3Jlc3VsdHMgPSBzZWxmLnNlY19zY2FubmVyLnNjYW5fdnVsbmVyYWJpbGl0aWVzKHVybCwgc2Nhbl9yZXN1bHRzKQogICAgICAgICAgICBleHBsb2l0X3Jlc3VsdHMgPSBzZWxmLmV4cGxvaXRfc2Nhbm5lci5leHBsb2l0X3Z1bG5lcmFiaWxpdGllcyh1cmwsIHZ1bG5fcmVzdWx0cykKCiAgICAgICAgICAgIGlmIG5vdCBleHBsb2l0X3Jlc3VsdHM6CiAgICAgICAgICAgICAgICBwcmludCgiWy1dINCd0LUg0L/QvtC70YPRh9C40LvQvtGB0Ywg0Y3QutGB0L/Qu9GD0LDRgtC40YDQvtCy0LDRgtGMINGD0Y/Qt9Cy0LjQvNC+0YHRgtC4IikKICAgICAgICAgICAgICAgIHJldHVybgoKICAgICAgICAgICAgcHJpbnQoIlsrXSDQoNC10LfRg9C70YzRgtCw0YLRiyDQsNCy0YLQvtGN0LrRgdC/0LvQvtC50YLQsDoiKQogICAgICAgICAgICBmb3IgcmVzdWx0IGluIGV4cGxvaXRfcmVzdWx0czoKICAgICAgICAgICAgICAgIHZ1bG5fdHlwZSA9IHJlc3VsdC5nZXQoInZ1bG5lcmFiaWxpdHkiLCAiVW5rbm93biIpCiAgICAgICAgICAgICAgICBwYXlsb2FkID0gcmVzdWx0LmdldCgicGF5bG9hZCIsICJOL0EiKQogICAgICAgICAgICAgICAgZXhwbG9pdF91cmwgPSByZXN1bHQuZ2V0KCJ1cmwiLCB1cmwpCgogICAgICAgICAgICAgICAgcHJpbnQoZiJcblsrXSDQo9GP0LfQstC40LzQvtGB0YLRjDoge3Z1bG5fdHlwZX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIFVSTDoge2V4cGxvaXRfdXJsfSIpCiAgICAgICAgICAgICAgICBwcmludChmIiAgUGF5bG9hZDoge3BheWxvYWR9IikKCiAgICAgICAgICAgICAgICBpZiB2dWxuX3R5cGUgPT0gIlNRTCBJbmplY3Rpb24iOgogICAgICAgICAgICAgICAgICAgIGRiX25hbWUgPSByZXN1bHQuZ2V0KCJkYXRhYmFzZSIsICLQpdC3IikKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAg0JHQsNC30LAg0LTQsNC90L3Ri9GFOiB7ZGJfbmFtZX0iKQogICAgICAgICAgICAgICAgZWxpZiB2dWxuX3R5cGUgPT0gIlJlbW90ZSBDb2RlIEV4ZWN1dGlvbiI6CiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ID0gcmVzdWx0LmdldCgib3V0cHV0IiwgIiIpWzoyMDBdCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgINCS0YvQstC+0LQg0LrQvtC80LDQvdC00Ys6IHtvdXRwdXR9Li4uIikKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQntGI0LjQsdC60LAg0L/RgNC4INGN0LrRgdC/0LvRg9Cw0YLQsNGG0LjQuDoge3N0cihlKX0iKQoKICAgIGRlZiBhZHZhbmNlZF9zY2FubmluZ19tZW51KHNlbGYsIHVybCk6CiAgICAgICAgd2hpbGUgVHJ1ZToKICAgICAgICAgICAgY2xlYXJfc2NyZWVuKCkKICAgICAgICAgICAgZGlzcGxheV9iYW5uZXIoKQogICAgICAgICAgICBwcmludChmIlsqXSDQoNCw0YHRiNC40YDQtdC90L3QvtC1INGB0LrQsNC90LjRgNC+0LLQsNC90LjQtSDQtNC70Y8ge3VybH06IikKICAgICAgICAgICAgcHJpbnQoIiAgMS4g0KHQutCw0L3QuNGA0L7QstCw0L3QuNC1INC/0L7RgNGC0L7QsiIpCiAgICAgICAgICAgIHByaW50KCIgIDIuINCf0L7QuNGB0Log0L/QvtC00LTQvtC80LXQvdC+0LIiKQogICAgICAgICAgICBwcmludCgiICAzLiBETlMt0LjQvdGE0LAiKQogICAgICAgICAgICBwcmludCgiICA0LiDQkNC90LDQu9C40Lcg0LfQsNCz0L7Qu9C+0LLQutC+0LIiKQogICAgICAgICAgICBwcmludCgiICA1LiDQkNC90LDQu9C40LcgU1NML1RMUyIpCiAgICAgICAgICAgIHByaW50KCIgIDYuINCh0LrQsNC90LjRgNC+0LLQsNC90LjQtSBXQUYiKQogICAgICAgICAgICBwcmludCgiICA3LiDQntCx0L3QsNGA0YPQttC10L3QuNC1INGC0LXRhdC90L7Qu9C+0LPQuNC5IikKICAgICAgICAgICAgcHJpbnQoIiAgOC4g0JvQuNGB0YLQuNC90LMg0LTQuNGA0LXQutGC0L7RgNC40LkiKQogICAgICAgICAgICBwcmludCgiICA5LiDQodC60LDQvdC40YDQvtCy0LDQvdC40LUg0YHQsNC50YLQsCIpCiAgICAgICAgICAgIHByaW50KCIgMTAuINCh0LrQsNC90LjRgNC+0LLQsNC90LjQtSBXb3JkUHJlc3MiKQogICAgICAgICAgICBwcmludCgiIDExLiDQkNC90LDQu9C40LcgSlMg0YTQsNC50LvQvtCyIikKICAgICAgICAgICAgcHJpbnQoIiAxMi4g0J/QvtC40YHQuiDQsNC00LzQuNC90L7QuiIpCiAgICAgICAgICAgIHByaW50KCIgMTMuINCQ0LLRgtC+0LzQsNGC0LjRh9C10YHQutC40Lkg0Y3QutGB0L/Qu9C+0LnRgiIpCiAgICAgICAgICAgIHByaW50KCIgMTQuINCd0LDQt9Cw0LQiKQogICAgICAgICAgICBjaG9pY2UgPSBpbnB1dCgiXG4+Pj4gIikKCiAgICAgICAgICAgIGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgICAgICAgICBzZWxmLnNjYW5fcG9ydHModXJsKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMiI6CiAgICAgICAgICAgICAgICBzZWxmLmVudW1lcmF0ZV9zdWJkb21haW5zKHVybCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjMiOgogICAgICAgICAgICAgICAgc2VsZi5kbnNfbG9va3VwKHVybCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjQiOgogICAgICAgICAgICAgICAgc2VsZi5hbmFseXplX2hlYWRlcnModXJsKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiNSI6CiAgICAgICAgICAgICAgICBzZWxmLmFuYWx5emVfc3NsKHVybCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjYiOgogICAgICAgICAgICAgICAgc2VsZi5zY2FuX3dhZih1cmwpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI3IjoKICAgICAgICAgICAgICAgIHNlbGYuZGV0ZWN0X3RlY2hub2xvZ2llcyh1cmwpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI4IjoKICAgICAgICAgICAgICAgIHNlbGYuc2Nhbl9kaXJlY3RvcnlfbGlzdGluZyh1cmwpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICI5IjoKICAgICAgICAgICAgICAgIHNlbGYuY3Jhd2xfd2Vic2l0ZSh1cmwpCiAgICAgICAgICAgIGVsaWYgY2hvaWNlID09ICIxMCI6CiAgICAgICAgICAgICAgICBzZWxmLnNjYW5fd29yZHByZXNzKHVybCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjExIjoKICAgICAgICAgICAgICAgIHNlbGYuYW5hbHl6ZV9qYXZhc2NyaXB0X2ZpbGVzKHVybCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjEyIjoKICAgICAgICAgICAgICAgIHNlbGYuc2Nhbl9hZG1pbl9wYW5lbHModXJsKQogICAgICAgICAgICBlbGlmIGNob2ljZSA9PSAiMTMiOgogICAgICAgICAgICAgICAgc2VsZi5hdXRvX2V4cGxvaXRfdnVsbmVyYWJpbGl0aWVzKHVybCkKICAgICAgICAgICAgZWxpZiBjaG9pY2UgPT0gIjE0IjoKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSDQndC10LLQtdGA0L3Ri9C5INCy0YvQsdC+0YAiKQogICAgICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0YfRgtC+0LEg0L/RgNC+0LTQvtC70LbQuNGC0YwuLi4iKQoKICAgIGRlZiBzY2FuX3BvcnRzKHNlbGYsIHVybCk6CiAgICAgICAgcHJpbnQoZiJcblsqXSDQodC60LDQvdC40Lwg0L/QvtGA0YLRiyDQtNC70Y8ge3VybH0uLi5cbiIpCgogICAgICAgIHRyeToKICAgICAgICAgICAgZG9tYWluID0gdXJscGFyc2UodXJsKS5uZXRsb2Muc3BsaXQoJzonKVswXQogICAgICAgICAgICBwb3J0cyA9IHNlbGYud2ViX3NjYW5uZXIucG9ydF9zY2FuKGRvbWFpbikKCiAgICAgICAgICAgIGlmIHBvcnRzOgogICAgICAgICAgICAgICAgcHJpbnQoIlsrXSDQoNC10LfRg9C70YzRgtCw0YLRiyDRgdC60LDQvdC40YDQvtCy0LDQvdC40Y8g0L/QvtGA0YLQvtCyOiIpCiAgICAgICAgICAgICAgICBmb3IgcG9ydCwgc2VydmljZSBpbiBwb3J0cy5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAtINCf0L7RgNGCIHtwb3J0fToge3NlcnZpY2V9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbLV0g0J7RgtC60YDRi9GC0YvQtSDQv9C+0YDRgtGLINC90LUg0L3QsNC50LTQtdC90YsiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDRgdC60LDQvdC40YDQvtCy0LDQvdC40Lgg0L/QvtGA0YLQvtCyOiB7c3RyKGUpfSIpCgogICAgZGVmIGVudW1lcmF0ZV9zdWJkb21haW5zKHNlbGYsIHVybCk6CiAgICAgICAgcHJpbnQoZiJcblsqXSDQmNGJ0LXQvCDQv9C+0LTQtNC+0LzQtdC90Ysg0LTQu9GPIHt1cmx9Li4uXG4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGRvbWFpbiA9IHVybHBhcnNlKHVybCkubmV0bG9jLnNwbGl0KCc6JylbMF0KICAgICAgICAgICAgc3ViZG9tYWlucyA9IHNlbGYud2ViX3NjYW5uZXIuZmluZF9zdWJkb21haW5zKGRvbWFpbikKCiAgICAgICAgICAgIGlmIHN1YmRvbWFpbnM6CiAgICAgICAgICAgICAgICBwcmludCgiWytdINCd0LDQudC00LXQvdC90YvQtSDQv9C+0LTQtNC+0LzQtdC90Ys6IikKICAgICAgICAgICAgICAgIGZvciBzdWJkb21haW4gaW4gc3ViZG9tYWluczoKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7c3ViZG9tYWlufSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiWy1dINCf0L7QtNC00L7QvNC10L3RiyDQvdC1INC90LDQudC00LXQvdGLIikKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KGYiWy1dINCe0YjQuNCx0LrQsCDQv9GA0Lgg0L/QvtC40YHQutC1INC/0L7QtNC00L7QvNC10L3QvtCyOiB7c3RyKGUpfSIpCgogICAgZGVmIGRuc19sb29rdXAoc2VsZiwgdXJsKToKICAgICAgICBwcmludChmIlxuWypdINCX0LDQv9GD0YHQutCw0LXQvCBETlMt0L/QvtC40YHQuiDQtNC70Y8ge3VybH0uLi5cbiIpCgogICAgICAgIHRyeToKICAgICAgICAgICAgZG9tYWluID0gdXJscGFyc2UodXJsKS5uZXRsb2Muc3BsaXQoJzonKVswXQogICAgICAgICAgICBkbnNfaW5mbyA9IHNlbGYud2ViX3NjYW5uZXIuZG5zX2xvb2t1cChkb21haW4pCgogICAgICAgICAgICBpZiBkbnNfaW5mbzoKICAgICAgICAgICAgICAgIHByaW50KCJbK10gRE5TLdC40L3RhNCwOiIpCiAgICAgICAgICAgICAgICBmb3IgcmVjb3JkX3R5cGUsIHJlY29yZHMgaW4gZG5zX2luZm8uaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBpZiByZWNvcmRzOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7cmVjb3JkX3R5cGV9OiIpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciByZWNvcmQgaW4gcmVjb3JkczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge3JlY29yZH0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSBETlMt0LjQvdGE0LAg0L3QtSDQvdCw0LnQtNC10L3QsCIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQntGI0LjQsdC60LAg0L/RgNC4IEROUy3Qv9C+0LjRgdC60LU6IHtzdHIoZSl9IikKCiAgICBkZWYgYW5hbHl6ZV9oZWFkZXJzKHNlbGYsIHVybCk6CiAgICAgICAgcHJpbnQoZiJcblsqXSDQkNC90LDQu9C40LfQuNGA0YPQtdC8INC30LDQs9C+0LvQvtCy0LrQuCDQtNC70Y8ge3VybH0uLi5cbiIpCgogICAgICAgIHRyeToKICAgICAgICAgICAgaGVhZGVyc19hbmFseXNpcyA9IHNlbGYud2ViX3NjYW5uZXIuYW5hbHl6ZV9oZWFkZXJzKHVybCkKCiAgICAgICAgICAgIGlmIGhlYWRlcnNfYW5hbHlzaXM6CiAgICAgICAgICAgICAgICBwcmludCgiWytdINCQ0L3QsNC70LjQtyDQt9Cw0LPQvtC70L7QstC60L7QsjoiKQogICAgICAgICAgICAgICAgZm9yIGhlYWRlciwgdmFsdWUgaW4gaGVhZGVyc19hbmFseXNpcy5pdGVtcygpOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHtoZWFkZXJ9OiB7dmFsdWV9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbLV0g0J3QtSDRg9C00LDQu9C+0YHRjCDQv9C+0LvRg9GH0LjRgtGMINC30LDQs9C+0LvQvtCy0LrQuCIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQntGI0LjQsdC60LAg0L/RgNC4INCw0L3QsNC70LjQt9C1INC30LDQs9C+0LvQvtCy0LrQvtCyOiB7c3RyKGUpfSIpCgogICAgZGVmIGFuYWx5emVfc3NsKHNlbGYsIHVybCk6CiAgICAgICAgcHJpbnQoZiJcblsqXSDQkNC90LDQu9C40LfQuNGA0YPQtdC8IFNTTC9UTFMg0LTQu9GPIHt1cmx9Li4uXG4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHNzbF9hbmFseXNpcyA9IHNlbGYud2ViX3NjYW5uZXIuYW5hbHl6ZV9zc2wodXJsKQoKICAgICAgICAgICAgaWYgc3NsX2FuYWx5c2lzOgogICAgICAgICAgICAgICAgcHJpbnQoIlsrXSDQkNC90LDQu9C40LcgU1NML1RMUzoiKQogICAgICAgICAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gc3NsX2FuYWx5c2lzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge2tleX06IHt2YWx1ZX0iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSBTU0wvVExTINC90LUg0L3QsNGB0YLRgNC+0LXQvSDQuNC70Lgg0L3QtdC00L7RgdGC0YPQv9C10L0iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDQsNC90LDQu9C40LfQtSBTU0wvVExTOiB7c3RyKGUpfSIpCgogICAgZGVmIHNjYW5fd2FmKHNlbGYsIHVybCk6CiAgICAgICAgcHJpbnQoZiJcblsqXSDQodC60LDQvdC40YDRg9C10LwgV0FGINC00LvRjyB7dXJsfS4uLlxuIikKCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3YWZfaW5mbyA9IHNlbGYud2ViX3NjYW5uZXIuc2Nhbl93YWYodXJsKQoKICAgICAgICAgICAgaWYgd2FmX2luZm8uZ2V0KCJkZXRlY3RlZCIsIEZhbHNlKToKICAgICAgICAgICAgICAgIHByaW50KCJbK10gV0FGINC+0LHQvdCw0YDRg9C20LXQvToiKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0g0KLQuNC/OiB7d2FmX2luZm8uZ2V0KCd0eXBlJywgJ9Cl0LcnKX0iKQogICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0g0JLQtdC90LTQvtGAOiB7d2FmX2luZm8uZ2V0KCd2ZW5kb3InLCAn0KXQtycpfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiWy1dIFdBRiDQvdC1INC+0LHQvdCw0YDRg9C20LXQvSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQntGI0LjQsdC60LAg0L/RgNC4INGB0LrQsNC90LjRgNC+0LLQsNC90LjQuCBXQUY6IHtzdHIoZSl9IikKCiAgICBkZWYgZGV0ZWN0X3RlY2hub2xvZ2llcyhzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiXG5bKl0g0J7Qv9GA0LXQtNC10LvRj9C10Lwg0YLQtdGF0L3QvtC70L7Qs9C40Lgg0LTQu9GPIHt1cmx9Li4uXG4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIHRlY2hub2xvZ2llcyA9IHNlbGYud2ViX3NjYW5uZXIuZGV0ZWN0X3RlY2hub2xvZ2llcyh1cmwpCgogICAgICAgICAgICBpZiB0ZWNobm9sb2dpZXM6CiAgICAgICAgICAgICAgICBwcmludCgiWytdINCd0LDQudC00LXQvdC90YvQtSDRgtC10YXQvdC+0LvQvtCz0LjQuDoiKQogICAgICAgICAgICAgICAgZm9yIGNhdGVnb3J5LCB0ZWNocyBpbiB0ZWNobm9sb2dpZXMuaXRlbXMoKToKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7Y2F0ZWdvcnl9OiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIHRlY2ggaW4gdGVjaHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge3RlY2h9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbLV0g0KLQtdGF0L3QvtC70L7Qs9C40Lgg0L3QtSDQvtCx0L3QsNGA0YPQttC10L3RiyIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQntGI0LjQsdC60LAg0L/RgNC4INC+0L/RgNC10LTQtdC70LXQvdC40Lgg0YLQtdGF0L3QvtC70L7Qs9C40Lk6IHtzdHIoZSl9IikKCiAgICBkZWYgc2Nhbl9kaXJlY3RvcnlfbGlzdGluZyhzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiXG5bKl0g0J/RgNC+0LLQtdGA0Y/QtdC8INC70LjRgdGC0LjQvdCzINC00LjRgNC10LrRgtC+0YDQuNC5INC00LvRjyB7dXJsfS4uLlxuIikKCiAgICAgICAgdHJ5OgogICAgICAgICAgICBkaXJlY3RvcnlfbGlzdGluZyA9IHNlbGYud2ViX3NjYW5uZXIuc2Nhbl9kaXJlY3RvcnlfbGlzdGluZyh1cmwpCgogICAgICAgICAgICBpZiBkaXJlY3RvcnlfbGlzdGluZzoKICAgICAgICAgICAgICAgIHByaW50KCJbK10g0J7QsdC90LDRgNGD0LbQtdC9INC70LjRgdGC0LjQvdCzINC00LjRgNC10LrRgtC+0YDQuNC5OiIpCiAgICAgICAgICAgICAgICBmb3IgZGlyZWN0b3J5IGluIGRpcmVjdG9yeV9saXN0aW5nOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHtkaXJlY3Rvcnl9IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbLV0g0JvQuNGB0YLQuNC90LMg0LTQuNGA0LXQutGC0L7RgNC40Lkg0L3QtSDQvtCx0L3QsNGA0YPQttC10L0iKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDQv9GA0L7QstC10YDQutC1INC70LjRgdGC0LjQvdCz0LAg0LTQuNGA0LXQutGC0L7RgNC40Lk6IHtzdHIoZSl9IikKCiAgICBkZWYgY3Jhd2xfd2Vic2l0ZShzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiXG5bKl0g0KHQutCw0L3QuNGA0YPQtdC8INCy0LXQsS3RgdCw0LnRgiDQtNC70Y8ge3VybH0uLi5cbiIpCgogICAgICAgIHRyeToKICAgICAgICAgICAgY3Jhd2xfcmVzdWx0cyA9IHNlbGYud2ViX3NjYW5uZXIuY3Jhd2xfd2Vic2l0ZSh1cmwpCgogICAgICAgICAgICBpZiBjcmF3bF9yZXN1bHRzOgogICAgICAgICAgICAgICAgcHJpbnQoIlsrXSDQoNC10LfRg9C70YzRgtCw0YLRiyDRgdC60LDQvdC40YDQvtCy0LDQvdC40Y86IikKCiAgICAgICAgICAgICAgICBpZiAidXJscyIgaW4gY3Jhd2xfcmVzdWx0cyBhbmQgY3Jhd2xfcmVzdWx0c1sidXJscyJdOgogICAgICAgICAgICAgICAgICAgIHByaW50KCIgIC0g0J3QsNC50LTQtdC90L3Ri9C1IFVSTDoiKQogICAgICAgICAgICAgICAgICAgIGZvciBmb3VuZF91cmwgaW4gY3Jhd2xfcmVzdWx0c1sidXJscyJdWzoxMF06CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge2ZvdW5kX3VybH0iKQogICAgICAgICAgICAgICAgICAgIGlmIGxlbihjcmF3bF9yZXN1bHRzWyJ1cmxzIl0pID4gMTA6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC4uLiDQuCDQtdGJ0LUge2xlbihjcmF3bF9yZXN1bHRzWyd1cmxzJ10pIC0gMTB9IFVSTCIpCgogICAgICAgICAgICAgICAgaWYgImZvcm1zIiBpbiBjcmF3bF9yZXN1bHRzIGFuZCBjcmF3bF9yZXN1bHRzWyJmb3JtcyJdOgogICAgICAgICAgICAgICAgICAgIHByaW50KCIgIC0g0J3QsNC50LTQtdC90L3Ri9C1INGE0L7RgNC80Ys6IikKICAgICAgICAgICAgICAgICAgICBmb3IgZm9ybSBpbiBjcmF3bF9yZXN1bHRzWyJmb3JtcyJdWzo1XToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgLSB7Zm9ybVsnYWN0aW9uJ119ICh7Zm9ybVsnbWV0aG9kJ119KSIpCiAgICAgICAgICAgICAgICAgICAgaWYgbGVuKGNyYXdsX3Jlc3VsdHNbImZvcm1zIl0pID4gNToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgICAgLi4uINC4INC10YnQtSB7bGVuKGNyYXdsX3Jlc3VsdHNbJ2Zvcm1zJ10pIC0gNX0g0YTQvtGA0LwiKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSDQoNC10LfRg9C70YzRgtCw0YLRiyDRgdC60LDQvdC40YDQvtCy0LDQvdC40Y8g0L3QtSDQvdCw0LnQtNC10L3RiyIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChmIlstXSDQntGI0LjQsdC60LAg0L/RgNC4INGB0LrQsNC90LjRgNC+0LLQsNC90LjQuCDQstC10LEt0YHQsNC50YLQsDoge3N0cihlKX0iKQoKICAgIGRlZiBzY2FuX3dvcmRwcmVzcyhzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiXG5bKl0g0KHQutCw0L3QuNGA0YPQtdC8IFdvcmRQcmVzcyDQtNC70Y8ge3VybH0uLi5cbiIpCgogICAgICAgIHRyeToKICAgICAgICAgICAgd3BfcmVzdWx0cyA9IHNlbGYud2ViX3NjYW5uZXIuc2Nhbl93b3JkcHJlc3ModXJsKQoKICAgICAgICAgICAgaWYgd3BfcmVzdWx0czoKICAgICAgICAgICAgICAgIHByaW50KCJbK10g0KDQtdC30YPQu9GM0YLQsNGC0Ysg0YHQutCw0L3QuNGA0L7QstCw0L3QuNGPIFdvcmRQcmVzczoiKQoKICAgICAgICAgICAgICAgIGlmICJ2ZXJzaW9uIiBpbiB3cF9yZXN1bHRzOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAtINCS0LXRgNGB0LjRjzoge3dwX3Jlc3VsdHNbJ3ZlcnNpb24nXX0iKQoKICAgICAgICAgICAgICAgIGlmICJ0aGVtZXMiIGluIHdwX3Jlc3VsdHMgYW5kIHdwX3Jlc3VsdHNbInRoZW1lcyJdOgogICAgICAgICAgICAgICAgICAgIHByaW50KCIgIC0g0KLQtdC80Ys6IikKICAgICAgICAgICAgICAgICAgICBmb3IgdGhlbWUgaW4gd3BfcmVzdWx0c1sidGhlbWVzIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge3RoZW1lfSIpCgogICAgICAgICAgICAgICAgaWYgInBsdWdpbnMiIGluIHdwX3Jlc3VsdHMgYW5kIHdwX3Jlc3VsdHNbInBsdWdpbnMiXToKICAgICAgICAgICAgICAgICAgICBwcmludCgiICAtINCf0LvQsNCz0LjQvdGLOiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIHBsdWdpbiBpbiB3cF9yZXN1bHRzWyJwbHVnaW5zIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge3BsdWdpbn0iKQoKICAgICAgICAgICAgICAgIGlmICJ1c2VycyIgaW4gd3BfcmVzdWx0cyBhbmQgd3BfcmVzdWx0c1sidXNlcnMiXToKICAgICAgICAgICAgICAgICAgICBwcmludCgiICAtINCf0L7Qu9GM0LfQvtCy0LDRgtC10LvQuDoiKQogICAgICAgICAgICAgICAgICAgIGZvciB1c2VyIGluIHdwX3Jlc3VsdHNbInVzZXJzIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge3VzZXJ9IikKCiAgICAgICAgICAgICAgICBpZiAidnVsbmVyYWJpbGl0aWVzIiBpbiB3cF9yZXN1bHRzIGFuZCB3cF9yZXN1bHRzWyJ2dWxuZXJhYmlsaXRpZXMiXToKICAgICAgICAgICAgICAgICAgICBwcmludCgiICAtINCj0Y/Qt9Cy0LjQvNC+0YHRgtC4OiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIHZ1bG4gaW4gd3BfcmVzdWx0c1sidnVsbmVyYWJpbGl0aWVzIl06CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAgIC0ge3Z1bG59IikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbLV0gV29yZFByZXNzINC90LUg0L7QsdC90LDRgNGD0LbQtdC9INC40LvQuCDQvdC10YIg0LjQvdGE0YsiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDRgdC60LDQvdC40YDQvtCy0LDQvdC40LggV29yZFByZXNzOiB7c3RyKGUpfSIpCgogICAgZGVmIGFuYWx5emVfamF2YXNjcmlwdF9maWxlcyhzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiXG5bKl0g0JDQvdCw0LvQuNC30LjRgNGD0LXQvCBKYXZhU2NyaXB0INGE0LDQudC70Ysg0LTQu9GPIHt1cmx9Li4uXG4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGpzX2ZpbGVzID0gc2VsZi53ZWJfc2Nhbm5lci5maW5kX2pzX2ZpbGVzKHVybCkKCiAgICAgICAgICAgIGlmIGpzX2ZpbGVzOgogICAgICAgICAgICAgICAgcHJpbnQoIlsrXSDQndCw0LnQtNC10L3QvdGL0LUgSmF2YVNjcmlwdCDRhNCw0LnQu9GLOiIpCiAgICAgICAgICAgICAgICBmb3IganNfZmlsZSBpbiBqc19maWxlc1s6MTBdOgogICAgICAgICAgICAgICAgICAgIHByaW50KGYiICAtIHtqc19maWxlfSIpCiAgICAgICAgICAgICAgICBpZiBsZW4oanNfZmlsZXMpID4gMTA6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIC4uLiDQuCDQtdGJ0LUge2xlbihqc19maWxlcykgLSAxMH0g0YTQsNC50LvQvtCyIikKCiAgICAgICAgICAgICAgICBwcmludCgiXG5bKl0g0JjQt9Cy0LvQtdC60LDQtdC8INGB0LrRgNGL0YLRi9C1INGN0L3QtNC/0L7QuNC90YLRiy4uLiIpCiAgICAgICAgICAgICAgICBlbmRwb2ludHMgPSBzZWxmLndlYl9zY2FubmVyLmV4dHJhY3RfaGlkZGVuX2VuZHBvaW50cyhqc19maWxlcykKCiAgICAgICAgICAgICAgICBpZiBlbmRwb2ludHM6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlsrXSDQndCw0LnQtNC10L3QvdGL0LUg0Y3QvdC00L/QvtC40L3RgtGLOiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIGVuZHBvaW50IGluIGVuZHBvaW50c1s6MTBdOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7ZW5kcG9pbnR9IikKICAgICAgICAgICAgICAgICAgICBpZiBsZW4oZW5kcG9pbnRzKSA+IDEwOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLi4uINC4INC10YnQtSB7bGVuKGVuZHBvaW50cykgLSAxMH0g0Y3QvdC00L/QvtC40L3RgtC+0LIiKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludCgiWy1dINCt0L3QtNC/0L7QuNC90YLRiyDQvdC1INC90LDQudC00LXQvdGLIikKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJbLV0gSmF2YVNjcmlwdCDRhNCw0LnQu9GLINC90LUg0L3QsNC50LTQtdC90YsiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDQsNC90LDQu9C40LfQtSBKYXZhU2NyaXB0INGE0LDQudC70L7Qsjoge3N0cihlKX0iKQoKICAgIGRlZiBzY2FuX2FkbWluX3BhbmVscyhzZWxmLCB1cmwpOgogICAgICAgIHByaW50KGYiXG5bKl0g0JjRidC10Lwg0LDQtNC80LjQvdC60Lgg0LTQu9GPIHt1cmx9Li4uXG4iKQoKICAgICAgICB0cnk6CiAgICAgICAgICAgIGFkbWluX3BhbmVscyA9IHNlbGYud2ViX3NjYW5uZXIuZmluZF9hZG1pbl9wYW5lbHModXJsKQoKICAgICAgICAgICAgaWYgYWRtaW5fcGFuZWxzOgogICAgICAgICAgICAgICAgcHJpbnQoIlsrXSDQndCw0LnQtNC10L3QvdGL0LUg0LDQtNC80LjQvdC60Lg6IikKICAgICAgICAgICAgICAgIGZvciBwYW5lbCBpbiBhZG1pbl9wYW5lbHM6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiIgIC0ge3BhbmVsfSIpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludCgiWy1dINCQ0LTQvNC40L3QutC4INC90LUg0L3QsNC50LTQtdC90YsiKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoZiJbLV0g0J7RiNC40LHQutCwINC/0YDQuCDQv9C+0LjRgdC60LUg0LDQtNC80LjQvdC+0Lo6IHtzdHIoZSl9IikKCiAgICBkZWYgc2Nhbl92dWxucyhzZWxmKToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGRpc3BsYXlfYmFubmVyKCkKCiAgICAgICAgcHJpbnQoIlsqXSDQktCy0LXQtNC4IFVSTCDRgdCw0LnRgtCwINC00LvRjyDRgdC60LDQvdC40YDQvtCy0LDQvdC40Y86IikKICAgICAgICB1cmwgPSBpbnB1dCgiPj4+ICIpCgogICAgICAgIGlmIG5vdCB1cmw6CiAgICAgICAgICAgIHByaW50KCJbLV0gVVJMINC90LUg0LzQvtC20LXRgiDQsdGL0YLRjCDQv9GD0YHRgtGL0LwiKQogICAgICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0YfRgtC+0LEg0LLQtdGA0L3Rg9GC0YzRgdGPLi4uIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHVybCA9IHBhcnNlX3VybCh1cmwpCgogICAgICAgIHByaW50KGYiXG5bKl0g0KHQutCw0L3QuNGA0YPQtdC8INGD0Y/Qt9Cy0LjQvNC+0YHRgtC4INC00LvRjyB7dXJsfS4uLlxuIikKCiAgICAgICAgd2ViX3NjYW5uZXIgPSBXZWJTY2FubmVyKCkKICAgICAgICBzY2FuX3Jlc3VsdHMgPSB3ZWJfc2Nhbm5lci5zY2FuX3dlYnNpdGUodXJsKQoKICAgICAgICBzZWN1cml0eV9zY2FubmVyID0gU2VjdXJpdHlTY2FubmVyKCkKICAgICAgICB2dWxuX3Jlc3VsdHMgPSBzZWN1cml0eV9zY2FubmVyLnNjYW5fdnVsbmVyYWJpbGl0aWVzKHVybCwgc2Nhbl9yZXN1bHRzKQoKICAgICAgICBwcmludCgiXG5bK10g0KDQtdC30YPQu9GM0YLQsNGC0Ysg0YHQutCw0L3QuNGA0L7QstCw0L3QuNGPINGD0Y/Qt9Cy0LjQvNC+0YHRgtC10Lk6IikKCiAgICAgICAgZm9yIHZ1bG5fdHlwZSwgZGF0YSBpbiB2dWxuX3Jlc3VsdHMuaXRlbXMoKToKICAgICAgICAgICAgaWYgdnVsbl90eXBlIGluIFsic3NsX2NoZWNrIiwgImhlYWRlcnNfY2hlY2siLCAiY29va2llc19jaGVjayJdOgogICAgICAgICAgICAgICAgc3RhdHVzID0gItCd0JUg0J7QkdCd0JDQoNCj0JbQldCd0J4iIGlmIGRhdGEuZ2V0KCJzZWN1cmUiLCBGYWxzZSkgZWxzZSAi0KPQr9CX0JLQmNCc0J4iCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBzdGF0dXMgPSAi0KPQr9CX0JLQmNCc0J4iIGlmIGRhdGEuZ2V0KCJ2dWxuZXJhYmxlIiwgRmFsc2UpIGVsc2UgItCd0JUg0J7QkdCd0JDQoNCj0JbQldCd0J4iCgogICAgICAgICAgICBwcmludChmIiAgLSB7dnVsbl90eXBlfToge3N0YXR1c30iKQoKICAgICAgICBwcmludCgiXG5bKl0g0KXQvtGH0LXRiNGMINGB0LPQtdC90LXRgNC40YLRjCDQvtGC0YfQtdGCPyAoeS9uKSIpCiAgICAgICAgZ2VuZXJhdGVfcmVwb3J0ID0gaW5wdXQoIj4+PiAiKS5sb3dlcigpID09ICd5JwoKICAgICAgICBpZiBnZW5lcmF0ZV9yZXBvcnQ6CiAgICAgICAgICAgIHByaW50KCJcblsqXSDQktGL0LHQtdGA0Lgg0YTQvtGA0LzQsNGCINC+0YLRh9C10YLQsDoiKQogICAgICAgICAgICBwcmludCgiICAxLiDQotC10LrRgdGCIikKICAgICAgICAgICAgcHJpbnQoIiAgMi4gSFRNTCIpCiAgICAgICAgICAgIHByaW50KCIgIDMuIEpTT04iKQoKICAgICAgICAgICAgcmVwb3J0X2Zvcm1hdCA9IGlucHV0KCI+Pj4gIikKCiAgICAgICAgICAgIGlmIHJlcG9ydF9mb3JtYXQgPT0gIjEiOgogICAgICAgICAgICAgICAgc2VsZi5nZW5lcmF0ZV90ZXh0X3JlcG9ydCh1cmwsIHNjYW5fcmVzdWx0cywgdnVsbl9yZXN1bHRzKQogICAgICAgICAgICBlbGlmIHJlcG9ydF9mb3JtYXQgPT0gIjIiOgogICAgICAgICAgICAgICAgc2VsZi5nZW5lcmF0ZV9odG1sX3JlcG9ydCh1cmwsIHNjYW5fcmVzdWx0cywgdnVsbl9yZXN1bHRzKQogICAgICAgICAgICBlbGlmIHJlcG9ydF9mb3JtYXQgPT0gIjMiOgogICAgICAgICAgICAgICAgc2VsZi5nZW5lcmF0ZV9qc29uX3JlcG9ydCh1cmwsIHNjYW5fcmVzdWx0cywgdnVsbl9yZXN1bHRzKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgcHJpbnQoIlstXSDQndC10LLQtdGA0L3Ri9C5INCy0YvQsdC+0YAg0YTQvtGA0LzQsNGC0LAiKQoKICAgICAgICBwcmludCgiXG5bKl0g0KXQvtGH0LXRiNGMINGB0LPQtdC90LXRgNC40YLRjCDRjdC60YHQv9C70L7QudGC0Ys/ICh5L24pIikKICAgICAgICBnZW5lcmF0ZV9leHBsb2l0cyA9IGlucHV0KCI+Pj4gIikubG93ZXIoKSA9PSAneScKCiAgICAgICAgaWYgZ2VuZXJhdGVfZXhwbG9pdHM6CiAgICAgICAgICAgIGV4cGxvaXRfc2Nhbm5lciA9IEV4cGxvaXRTY2FubmVyKCkKICAgICAgICAgICAgZXhwbG9pdHMgPSBleHBsb2l0X3NjYW5uZXIuZXhwbG9pdF92dWxuZXJhYmlsaXRpZXModXJsLCB2dWxuX3Jlc3VsdHMpCgogICAgICAgICAgICBpZiBleHBsb2l0czoKICAgICAgICAgICAgICAgIHByaW50KCJcblsrXSDQodCz0LXQvdC10YDQuNGA0L7QstCw0L3QvdGL0LUg0Y3QutGB0L/Qu9C+0LnRgtGLOiIpCiAgICAgICAgICAgICAgICBmb3IgZXhwbG9pdCBpbiBleHBsb2l0czoKICAgICAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7ZXhwbG9pdFsndnVsbmVyYWJpbGl0eSddfToge2V4cGxvaXQuZ2V0KCd1cmwnLCB1cmwpfSIpCgogICAgICAgICAgICAgICAgcHJpbnQoIlxuWypdINCh0L7RhdGA0LDQvdC40YLRjCDRjdC60YHQv9C70L7QudGC0Ys/ICh5L24pIikKICAgICAgICAgICAgICAgIHNhdmVfZXhwbG9pdHMgPSBpbnB1dCgiPj4+ICIpLmxvd2VyKCkgPT0gJ3knCgogICAgICAgICAgICAgICAgaWYgc2F2ZV9leHBsb2l0czoKICAgICAgICAgICAgICAgICAgICBzZWxmLnNhdmVfZXhwbG9pdHModXJsLCBleHBsb2l0cykKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KCJcblstXSDQndC1INC/0L7Qu9GD0YfQuNC70L7RgdGMINGB0LPQtdC90LXRgNC40YLRjCDRjdC60YHQv9C70L7QudGC0YsiKQoKICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0YfRgtC+0LEg0LLQtdGA0L3Rg9GC0YzRgdGPLi4uIikKCiAgICBkZWYgZ2VuZXJhdGVfdGV4dF9yZXBvcnQoc2VsZiwgdXJsLCBzY2FuX3Jlc3VsdHMsIHZ1bG5fcmVzdWx0cyk6CiAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZJW0lZF8lSCVNJVMiKQogICAgICAgIGZpbGVuYW1lID0gZiJyZXBvcnRfe3VybHBhcnNlKHVybCkubmV0bG9jfV97dGltZXN0YW1wfS50eHQiCgogICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBmLndyaXRlKGYi0J7RgtGH0LXRgiDQviDRgdC60LDQvdC40YDQvtCy0LDQvdC40Lgg0LTQu9GPIHt1cmx9XG4iKQogICAgICAgICAgICBmLndyaXRlKGYi0JTQsNGC0LA6IHtkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKX1cblxuIikKCiAgICAgICAgICAgIGYud3JpdGUoItCY0L3RhNCwINC+INGB0LXRgNCy0LXRgNC1OlxuIikKICAgICAgICAgICAgc2VydmVyX2luZm8gPSBzY2FuX3Jlc3VsdHMuZ2V0KCJzZXJ2ZXJfaW5mbyIsIHt9KQogICAgICAgICAgICBmLndyaXRlKGYiICAtINCh0YLQsNGC0YPRgSDQutC+0LQ6IHtzZXJ2ZXJfaW5mby5nZXQoJ3N0YXR1c19jb2RlJywgJ9CdL9CUJyl9XG4iKQogICAgICAgICAgICBmLndyaXRlKGYiICAtINCh0LXRgNCy0LXRgDoge3NlcnZlcl9pbmZvLmdldCgnc2VydmVyJywgJ9Cl0LcnKX1cbiIpCiAgICAgICAgICAgIGYud3JpdGUoZiIgIC0g0KLQtdGF0L3QvtC70L7Qs9C40Y86IHtzZXJ2ZXJfaW5mby5nZXQoJ3hfcG93ZXJlZF9ieScsICfQpdC3Jyl9XG4iKQogICAgICAgICAgICBmLndyaXRlKGYiICAtINCi0LjQvyDQutC+0L3RgtC10L3RgtCwOiB7c2VydmVyX2luZm8uZ2V0KCdjb250ZW50X3R5cGUnLCAn0KXQtycpfVxuXG4iKQoKICAgICAgICAgICAgZi53cml0ZSgi0J7QsdC90LDRgNGD0LbQtdC90L3Ri9C1INGD0Y/Qt9Cy0LjQvNC+0YHRgtC4OlxuIikKICAgICAgICAgICAgZm9yIHZ1bG5fdHlwZSwgZGF0YSBpbiB2dWxuX3Jlc3VsdHMuaXRlbXMoKToKICAgICAgICAgICAgICAgIGlmIHZ1bG5fdHlwZSBpbiBbInNzbF9jaGVjayIsICJoZWFkZXJzX2NoZWNrIiwgImNvb2tpZXNfY2hlY2siXToKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAi0J3QlSDQntCR0J3QkNCg0KPQltCV0J3QniIgaWYgZGF0YS5nZXQoInNlY3VyZSIsIEZhbHNlKSBlbHNlICLQo9Cv0JfQktCY0JzQniIKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gItCj0K/Ql9CS0JjQnNCeIiBpZiBkYXRhLmdldCgidnVsbmVyYWJsZSIsIEZhbHNlKSBlbHNlICLQndCVINCe0JHQndCQ0KDQo9CW0JXQndCeIgoKICAgICAgICAgICAgICAgIGYud3JpdGUoZiIgIC0ge3Z1bG5fdHlwZX06IHtzdGF0dXN9XG4iKQoKICAgICAgICAgICAgICAgIGlmIHZ1bG5fdHlwZSA9PSAic3NsX2NoZWNrIiBhbmQgbm90IGRhdGEuZ2V0KCJzZWN1cmUiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiICAgINCf0YDQvtCx0LvQtdC80YsgU1NMOlxuIikKICAgICAgICAgICAgICAgICAgICBmb3IgaXNzdWUgaW4gZGF0YS5nZXQoImlzc3VlcyIsIFtdKToKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIiAgICAtIHtpc3N1ZX1cbiIpCgogICAgICAgICAgICAgICAgaWYgdnVsbl90eXBlID09ICJoZWFkZXJzX2NoZWNrIiBhbmQgbm90IGRhdGEuZ2V0KCJzZWN1cmUiLCBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiICAgINCe0YLRgdGD0YLRgdGC0LLRg9GO0YnQuNC1INC30LDQs9C+0LvQvtCy0LrQuCDQsdC10LfQvtC/0LDRgdC90L7RgdGC0Lg6XG4iKQogICAgICAgICAgICAgICAgICAgIGZvciBoZWFkZXIgaW4gZGF0YS5nZXQoIm1pc3NpbmciLCBbXSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiIgICAgLSB7aGVhZGVyfVxuIikKCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiICAgINCh0LvQsNCx0YvQtSDQt9Cw0LPQvtC70L7QstC60Lgg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4OlxuIikKICAgICAgICAgICAgICAgICAgICBmb3IgaGVhZGVyIGluIGRhdGEuZ2V0KCJ3ZWFrIiwgW10pOgogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiICAgIC0ge2hlYWRlcn1cbiIpCgogICAgICAgICAgICAgICAgaWYgdnVsbl90eXBlIGluIFsic3FsX2luamVjdGlvbiIsICJ4c3MiLCAib3Blbl9yZWRpcmVjdCIsICJsZmkiLCAicmNlIl0gYW5kIGRhdGEuZ2V0KCJ2dWxuZXJhYmxlIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGYWxzZSk6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZSgiICAgINCj0Y/Qt9Cy0LjQvNGL0LUg0YLQvtGH0LrQuDpcbiIpCiAgICAgICAgICAgICAgICAgICAgZm9yIGVuZHBvaW50IGluIGRhdGEuZ2V0KCJlbmRwb2ludHMiLCBbXSk6CiAgICAgICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiIgICAgLSBVUkw6IHtlbmRwb2ludC5nZXQoJ3VybCcsICfQnS/QlCcpfVxuIikKICAgICAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIiAgICAgINCf0LDRgNCw0LzQtdGC0YA6IHtlbmRwb2ludC5nZXQoJ3BhcmFtJywgJ9CdL9CUJyl9XG4iKQogICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGYiICAgICAgUGF5bG9hZDoge2VuZHBvaW50LmdldCgncGF5bG9hZCcsICfQnS/QlCcpfVxuIikKCiAgICAgICAgICAgIGYud3JpdGUoIlxu0J3QsNC50LTQtdC90L3Ri9C1INGA0LXRgdGD0YDRgdGLOlxuIikKCiAgICAgICAgICAgIGlmICJkaXJlY3RvcmllcyIgaW4gc2Nhbl9yZXN1bHRzIGFuZCBzY2FuX3Jlc3VsdHNbImRpcmVjdG9yaWVzIl06CiAgICAgICAgICAgICAgICBmLndyaXRlKCIgINCU0LjRgNC10LrRgtC+0YDQuNC4OlxuIikKICAgICAgICAgICAgICAgIGZvciBkaXJlY3RvcnkgaW4gc2Nhbl9yZXN1bHRzWyJkaXJlY3RvcmllcyJdOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiIgIC0ge2RpcmVjdG9yeX1cbiIpCgogICAgICAgICAgICBpZiAiYWRtaW5fcGFuZWxzIiBpbiBzY2FuX3Jlc3VsdHMgYW5kIHNjYW5fcmVzdWx0c1siYWRtaW5fcGFuZWxzIl06CiAgICAgICAgICAgICAgICBmLndyaXRlKCIgINCQ0LTQvNC40L3QutC4OlxuIikKICAgICAgICAgICAgICAgIGZvciBwYW5lbCBpbiBzY2FuX3Jlc3VsdHNbImFkbWluX3BhbmVscyJdOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZiIgIC0ge3BhbmVsfVxuIikKCiAgICAgICAgICAgIGlmICJzZW5zaXRpdmVfZmlsZXMiIGluIHNjYW5fcmVzdWx0cyBhbmQgc2Nhbl9yZXN1bHRzWyJzZW5zaXRpdmVfZmlsZXMiXToKICAgICAgICAgICAgICAgIGYud3JpdGUoIiAg0KHQtdC90YHQuNGC0LjQstC90YvQtSDRhNCw0LnQu9GLOlxuIikKICAgICAgICAgICAgICAgIGZvciBmaWxlIGluIHNjYW5fcmVzdWx0c1sic2Vuc2l0aXZlX2ZpbGVzIl06CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIiAgLSB7ZmlsZX1cbiIpCgogICAgICAgICAgICBpZiAic3ViZG9tYWlucyIgaW4gc2Nhbl9yZXN1bHRzIGFuZCBzY2FuX3Jlc3VsdHNbInN1YmRvbWFpbnMiXToKICAgICAgICAgICAgICAgIGYud3JpdGUoIiAg0J/QvtC00LTQvtC80LXQvdGLOlxuIikKICAgICAgICAgICAgICAgIGZvciBzdWJkb21haW4gaW4gc2Nhbl9yZXN1bHRzWyJzdWJkb21haW5zIl06CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIiAgLSB7c3ViZG9tYWlufVxuIikKCiAgICAgICAgcHJpbnQoZiJcblsrXSDQntGC0YfQtdGCINGB0L7RhdGA0LDQvdC10L0g0LIge2ZpbGVuYW1lfSIpCgogICAgZGVmIGdlbmVyYXRlX2h0bWxfcmVwb3J0KHNlbGYsIHVybCwgc2Nhbl9yZXN1bHRzLCB2dWxuX3Jlc3VsdHMpOgogICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWSVtJWRfJUglTSVTIikKICAgICAgICBmaWxlbmFtZSA9IGYicmVwb3J0X3t1cmxwYXJzZSh1cmwpLm5ldGxvY31fe3RpbWVzdGFtcH0uaHRtbCIKCiAgICAgICAgaHRtbF9jb250ZW50ID0gZiIiIjwhRE9DVFlQRSBodG1sPgo8aHRtbD4KPGhlYWQ+CiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCI+CiAgICA8dGl0bGU+0J7RgtGH0LXRgiDQviDRgdC60LDQvdC40YDQvtCy0LDQvdC40Lgg0LTQu9GPIHt1cmx9PC90aXRsZT4KICAgIDxzdHlsZT4KICAgICAgICBib2R5IHt7IGZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsgbWFyZ2luOiAwOyBwYWRkaW5nOiAyMHB4OyB9fQogICAgICAgIGgxIHt7IGNvbG9yOiAjMzMzOyB9fQogICAgICAgIGgyIHt7IGNvbG9yOiAjNTU1OyBtYXJnaW4tdG9wOiAyMHB4OyB9fQogICAgICAgIC5jb250YWluZXIge3sgbWF4LXdpZHRoOiAxMDAwcHg7IG1hcmdpbjogMCBhdXRvOyB9fQogICAgICAgIC5pbmZvLXNlY3Rpb24ge3sgbWFyZ2luLWJvdHRvbTogMzBweDsgfX0KICAgICAgICAudnVsbi1pdGVtIHt7IG1hcmdpbi1ib3R0b206IDEwcHg7IHBhZGRpbmc6IDEwcHg7IGJvcmRlci1yYWRpdXM6IDVweDsgfX0KICAgICAgICAudnVsbmVyYWJsZSB7eyBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZlNmU2OyB9fQogICAgICAgIC5zZWN1cmUge3sgYmFja2dyb3VuZC1jb2xvcjogI2U2ZmZlNjsgfX0KICAgICAgICAuZW5kcG9pbnRzIHt7IG1hcmdpbi1sZWZ0OiAyMHB4OyB9fQogICAgICAgIC5lbmRwb2ludCB7eyBiYWNrZ3JvdW5kLWNvbG9yOiAjZjlmOWY5OyBwYWRkaW5nOiAxMHB4OyBtYXJnaW4tdG9wOiAxMHB4OyBib3JkZXItcmFkaXVzOiA1cHg7IH19CiAgICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogICAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgICAgICA8aDE+0J7RgtGH0LXRgiDQviDRgdC60LDQvdC40YDQvtCy0LDQvdC40Lg8L2gxPgogICAgICAgIDxkaXYgY2xhc3M9ImluZm8tc2VjdGlvbiI+CiAgICAgICAgICAgIDxoMj7QntCx0YnQsNGPINC40L3RhNCwPC9oMj4KICAgICAgICAgICAgPHA+PHN0cm9uZz5VUkw6PC9zdHJvbmc+IHt1cmx9PC9wPgogICAgICAgICAgICA8cD48c3Ryb25nPtCU0LDRgtCwOjwvc3Ryb25nPiB7ZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoJyVZLSVtLSVkICVIOiVNOiVTJyl9PC9wPgoKICAgICAgICAgICAgPGgzPtCY0L3RhNCwINC+INGB0LXRgNCy0LXRgNC1PC9oMz4iIiIKCiAgICAgICAgc2VydmVyX2luZm8gPSBzY2FuX3Jlc3VsdHMuZ2V0KCJzZXJ2ZXJfaW5mbyIsIHt9KQogICAgICAgIGh0bWxfY29udGVudCArPSBmIiIiCiAgICAgICAgICAgIDxwPjxzdHJvbmc+0KHRgtCw0YLRg9GBINC60L7QtDo8L3N0cm9uZz4ge3NlcnZlcl9pbmZvLmdldCgnc3RhdHVzX2NvZGUnLCAn0J0v0JQnKX08L3A+CiAgICAgICAgICAgIDxwPjxzdHJvbmc+0KHQtdGA0LLQtdGAOjwvc3Ryb25nPiB7c2VydmVyX2luZm8uZ2V0KCdzZXJ2ZXInLCAn0KXQtycpfTwvcD4KICAgICAgICAgICAgPHA+PHN0cm9uZz7QotC10YXQvdC+0LvQvtCz0LjRjzo8L3N0cm9uZz4ge3NlcnZlcl9pbmZvLmdldCgneF9wb3dlcmVkX2J5JywgJ9Cl0LcnKX08L3A+CiAgICAgICAgICAgIDxwPjxzdHJvbmc+0KLQuNC/INC60L7QvdGC0LXQvdGC0LA6PC9zdHJvbmc+IHtzZXJ2ZXJfaW5mby5nZXQoJ2NvbnRlbnRfdHlwZScsICfQpdC3Jyl9PC9wPgoKICAgICAgICAgICAgPHA+PHN0cm9uZz5XQUYg0L7QsdC90LDRgNGD0LbQtdC9Ojwvc3Ryb25nPiB7J9CU0LAnIGlmIHNjYW5fcmVzdWx0cy5nZXQoJ3dhZl9kZXRlY3RlZCcsIEZhbHNlKSBlbHNlICfQndC10YInfTwvcD4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzcz0iaW5mby1zZWN0aW9uIj4KICAgICAgICAgICAgPGgyPtCg0LXQt9GD0LvRjNGC0LDRgtGLINC/0YDQvtCy0LXRgNC60Lgg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4PC9oMj4iIiIKCiAgICAgICAgZm9yIHZ1bG5fdHlwZSwgZGF0YSBpbiB2dWxuX3Jlc3VsdHMuaXRlbXMoKToKICAgICAgICAgICAgaWYgdnVsbl90eXBlIGluIFsic3NsX2NoZWNrIiwgImhlYWRlcnNfY2hlY2siLCAiY29va2llc19jaGVjayJdOgogICAgICAgICAgICAgICAgaXNfc2VjdXJlID0gZGF0YS5nZXQoJ3NlY3VyZScsIEZhbHNlKQogICAgICAgICAgICAgICAgc3RhdHVzID0gItCd0JUg0J7QkdCd0JDQoNCj0JbQldCd0J4iIGlmIGlzX3NlY3VyZSBlbHNlICLQo9Cv0JfQktCY0JzQniIKICAgICAgICAgICAgICAgIGh0bWxfY2xhc3MgPSAic2VjdXJlIiBpZiBpc19zZWN1cmUgZWxzZSAidnVsbmVyYWJsZSIKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIGlzX3Z1bG5lcmFibGUgPSBkYXRhLmdldCgndnVsbmVyYWJsZScsIEZhbHNlKQogICAgICAgICAgICAgICAgc3RhdHVzID0gItCj0K/Ql9CS0JjQnNCeIiBpZiBpc192dWxuZXJhYmxlIGVsc2UgItCd0JUg0J7QkdCd0JDQoNCj0JbQldCd0J4iCiAgICAgICAgICAgICAgICBodG1sX2NsYXNzID0gInZ1bG5lcmFibGUiIGlmIGlzX3Z1bG5lcmFibGUgZWxzZSAic2VjdXJlIgoKICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9IGYiIiIKICAgICAgICAgICAgPGRpdiBjbGFzcz0idnVsbi1pdGVtIHtodG1sX2NsYXNzfSI+CiAgICAgICAgICAgICAgICA8aDM+e3Z1bG5fdHlwZX06IHtzdGF0dXN9PC9oMz4iIiIKCiAgICAgICAgICAgIGlmIHZ1bG5fdHlwZSA9PSAic3NsX2NoZWNrIiBhbmQgbm90IGRhdGEuZ2V0KCdzZWN1cmUnLCBGYWxzZSk6CiAgICAgICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgICAgICAgICA8cD48c3Ryb25nPtCf0YDQvtCx0LvQtdC80YsgU1NMOjwvc3Ryb25nPjwvcD4KICAgICAgICAgICAgICAgIDx1bD4iIiIKICAgICAgICAgICAgICAgIGZvciBpc3N1ZSBpbiBkYXRhLmdldCgiaXNzdWVzIiwgW10pOgogICAgICAgICAgICAgICAgICAgIGh0bWxfY29udGVudCArPSBmIiIiCiAgICAgICAgICAgICAgICAgICAgPGxpPntpc3N1ZX08L2xpPiIiIgogICAgICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9ICIiIgogICAgICAgICAgICAgICAgPC91bD4iIiIKCiAgICAgICAgICAgIGlmIHZ1bG5fdHlwZSA9PSAiaGVhZGVyc19jaGVjayIgYW5kIG5vdCBkYXRhLmdldCgnc2VjdXJlJywgRmFsc2UpOgogICAgICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9ICIiIgogICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7QntGC0YHRg9GC0YHRgtCy0YPRjtGJ0LjQtSDQt9Cw0LPQvtC70L7QstC60Lgg0LHQtdC30L7Qv9Cw0YHQvdC+0YHRgtC4Ojwvc3Ryb25nPjwvcD4KICAgICAgICAgICAgICAgIDx1bD4iIiIKICAgICAgICAgICAgICAgIGZvciBoZWFkZXIgaW4gZGF0YS5nZXQoIm1pc3NpbmciLCBbXSk6CiAgICAgICAgICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9IGYiIiIKICAgICAgICAgICAgICAgICAgICA8bGk+e2hlYWRlcn08L2xpPiIiIgogICAgICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9ICIiIgogICAgICAgICAgICAgICAgPC91bD4KICAgICAgICAgICAgICAgIDxwPjxzdHJvbmc+0KHQu9Cw0LHRi9C1INC30LDQs9C+0LvQvtCy0LrQuCDQsdC10LfQvtC/0LDRgdC90L7RgdGC0Lg6PC9zdHJvbmc+PC9wPgogICAgICAgICAgICAgICAgPHVsPiIiIgogICAgICAgICAgICAgICAgZm9yIGhlYWRlciBpbiBkYXRhLmdldCgid2VhayIsIFtdKToKICAgICAgICAgICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gZiIiIgogICAgICAgICAgICAgICAgICAgIDxsaT57aGVhZGVyfTwvbGk+IiIiCiAgICAgICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgICAgICAgICA8L3VsPiIiIgoKICAgICAgICAgICAgaWYgdnVsbl90eXBlIGluIFsic3FsX2luamVjdGlvbiIsICJ4c3MiLCAib3Blbl9yZWRpcmVjdCIsICJsZmkiLCAicmNlIl0gYW5kIGRhdGEuZ2V0KCJ2dWxuZXJhYmxlIiwgRmFsc2UpOgogICAgICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9ICIiIgogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZW5kcG9pbnRzIj4KICAgICAgICAgICAgICAgICAgICA8cD48c3Ryb25nPtCj0Y/Qt9Cy0LjQvNGL0LUg0YLQvtGH0LrQuDo8L3N0cm9uZz48L3A+IiIiCiAgICAgICAgICAgICAgICBmb3IgZW5kcG9pbnQgaW4gZGF0YS5nZXQoImVuZHBvaW50cyIsIFtdKToKICAgICAgICAgICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gZiIiIgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImVuZHBvaW50Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz5VUkw6PC9zdHJvbmc+IHtlbmRwb2ludC5nZXQoJ3VybCcsICfQnS/QlCcpfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz7Qn9Cw0YDQsNC80LXRgtGAOjwvc3Ryb25nPiB7ZW5kcG9pbnQuZ2V0KCdwYXJhbScsICfQnS/QlCcpfTwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgPHA+PHN0cm9uZz5QYXlsb2FkOjwvc3Ryb25nPiB7ZW5kcG9pbnQuZ2V0KCdwYXlsb2FkJywgJ9CdL9CUJyl9PC9wPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PiIiIgogICAgICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9ICIiIgogICAgICAgICAgICAgICAgPC9kaXY+IiIiCgogICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgICAgIDwvZGl2PiIiIgoKICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgPC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImluZm8tc2VjdGlvbiI+CiAgICAgICAgICAgIDxoMj7QndCw0LnQtNC10L3QvdGL0LUg0YDQtdGB0YPRgNGB0Ys8L2gyPiIiIgoKICAgICAgICBpZiAiZGlyZWN0b3JpZXMiIGluIHNjYW5fcmVzdWx0cyBhbmQgc2Nhbl9yZXN1bHRzWyJkaXJlY3RvcmllcyJdOgogICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgICAgIDxoMz7QlNC40YDQtdC60YLQvtGA0LjQuDwvaDM+CiAgICAgICAgICAgIDx1bD4iIiIKICAgICAgICAgICAgZm9yIGRpcmVjdG9yeSBpbiBzY2FuX3Jlc3VsdHNbImRpcmVjdG9yaWVzIl06CiAgICAgICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gZiIiIgogICAgICAgICAgICAgICAgPGxpPntkaXJlY3Rvcnl9PC9saT4iIiIKICAgICAgICAgICAgaHRtbF9jb250ZW50ICs9ICIiIgogICAgICAgICAgICA8L3VsPiIiIgoKICAgICAgICBpZiAiYWRtaW5fcGFuZWxzIiBpbiBzY2FuX3Jlc3VsdHMgYW5kIHNjYW5fcmVzdWx0c1siYWRtaW5fcGFuZWxzIl06CiAgICAgICAgICAgIGh0bWxfY29udGVudCArPSAiIiIKICAgICAgICAgICAgPGgzPtCQ0LTQvNC40L3QutC4PC9oMz4KICAgICAgICAgICAgPHVsPiIiIgogICAgICAgICAgICBmb3IgcGFuZWwgaW4gc2Nhbl9yZXN1bHRzWyJhZG1pbl9wYW5lbHMiXToKICAgICAgICAgICAgICAgIGh0bWxfY29udGVudCArPSBmIiIiCiAgICAgICAgICAgICAgICA8bGk+e3BhbmVsfTwvbGk+IiIiCiAgICAgICAgICAgIGh0bWxfY29udGVudCArPSAiIiIKICAgICAgICAgICAgPC91bD4iIiIKCiAgICAgICAgaWYgInNlbnNpdGl2ZV9maWxlcyIgaW4gc2Nhbl9yZXN1bHRzIGFuZCBzY2FuX3Jlc3VsdHNbInNlbnNpdGl2ZV9maWxlcyJdOgogICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgICAgIDxoMz7QodC10L3RgdC40YLQuNCy0L3Ri9C1INGE0LDQudC70Ys8L2gzPgogICAgICAgICAgICA8dWw+IiIiCiAgICAgICAgICAgIGZvciBmaWxlIGluIHNjYW5fcmVzdWx0c1sic2Vuc2l0aXZlX2ZpbGVzIl06CiAgICAgICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gZiIiIgogICAgICAgICAgICAgICAgPGxpPntmaWxlfTwvbGk+IiIiCiAgICAgICAgICAgIGh0bWxfY29udGVudCArPSAiIiIKICAgICAgICAgICAgPC91bD4iIiIKCiAgICAgICAgaWYgInN1YmRvbWFpbnMiIGluIHNjYW5fcmVzdWx0cyBhbmQgc2Nhbl9yZXN1bHRzWyJzdWJkb21haW5zIl06CiAgICAgICAgICAgIGh0bWxfY29udGVudCArPSAiIiIKICAgICAgICAgICAgPGgzPtCf0L7QtNC00L7QvNC10L3RizwvaDM+CiAgICAgICAgICAgIDx1bD4iIiIKICAgICAgICAgICAgZm9yIHN1YmRvbWFpbiBpbiBzY2FuX3Jlc3VsdHNbInN1YmRvbWFpbnMiXToKICAgICAgICAgICAgICAgIGh0bWxfY29udGVudCArPSBmIiIiCiAgICAgICAgICAgICAgICA8bGk+e3N1YmRvbWFpbn08L2xpPiIiIgogICAgICAgICAgICBodG1sX2NvbnRlbnQgKz0gIiIiCiAgICAgICAgICAgIDwvdWw+IiIiCgogICAgICAgIGh0bWxfY29udGVudCArPSAiIiIKICAgICAgICA8L2Rpdj4KICAgIDwvZGl2Pgo8L2JvZHk+CjwvaHRtbD4iIiIKCiAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgIGYud3JpdGUoaHRtbF9jb250ZW50KQoKICAgICAgICBwcmludChmIlxuWytdINCe0YLRh9C10YIg0YHQvtGF0YDQsNC90LXQvSDQsiB7ZmlsZW5hbWV9IikKCiAgICBkZWYgZ2VuZXJhdGVfanNvbl9yZXBvcnQoc2VsZiwgdXJsLCBzY2FuX3Jlc3VsdHMsIHZ1bG5fcmVzdWx0cyk6CiAgICAgICAgdGltZXN0YW1wID0gZGF0ZXRpbWUubm93KCkuc3RyZnRpbWUoIiVZJW0lZF8lSCVNJVMiKQogICAgICAgIGZpbGVuYW1lID0gZiJyZXBvcnRfe3VybHBhcnNlKHVybCkubmV0bG9jfV97dGltZXN0YW1wfS5qc29uIgoKICAgICAgICByZXBvcnQgPSB7CiAgICAgICAgICAgICJ1cmwiOiB1cmwsCiAgICAgICAgICAgICJzY2FuX2RhdGUiOiBkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJVktJW0tJWQgJUg6JU06JVMnKSwKICAgICAgICAgICAgInNlcnZlcl9pbmZvIjogc2Nhbl9yZXN1bHRzLmdldCgic2VydmVyX2luZm8iLCB7fSksCiAgICAgICAgICAgICJ2dWxuZXJhYmlsaXRpZXMiOiB2dWxuX3Jlc3VsdHMsCiAgICAgICAgICAgICJyZXNvdXJjZXMiOiB7CiAgICAgICAgICAgICAgICAiZGlyZWN0b3JpZXMiOiBzY2FuX3Jlc3VsdHMuZ2V0KCJkaXJlY3RvcmllcyIsIFtdKSwKICAgICAgICAgICAgICAgICJhZG1pbl9wYW5lbHMiOiBzY2FuX3Jlc3VsdHMuZ2V0KCJhZG1pbl9wYW5lbHMiLCBbXSksCiAgICAgICAgICAgICAgICAic2Vuc2l0aXZlX2ZpbGVzIjogc2Nhbl9yZXN1bHRzLmdldCgic2Vuc2l0aXZlX2ZpbGVzIiwgW10pLAogICAgICAgICAgICAgICAgInN1YmRvbWFpbnMiOiBzY2FuX3Jlc3VsdHMuZ2V0KCJzdWJkb21haW5zIiwgW10pCiAgICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIHdpdGggb3BlbihmaWxlbmFtZSwgInciLCBlbmNvZGluZz0idXRmLTgiKSBhcyBmOgogICAgICAgICAgICBqc29uLmR1bXAocmVwb3J0LCBmLCBpbmRlbnQ9NCwgZW5zdXJlX2FzY2lpPUZhbHNlKQoKICAgICAgICBwcmludChmIlxuWytdINCe0YLRh9C10YIg0YHQvtGF0YDQsNC90LXQvSDQsiB7ZmlsZW5hbWV9IikKCiAgICBkZWYgc2F2ZV9leHBsb2l0cyhzZWxmLCB1cmwsIGV4cGxvaXRzKToKICAgICAgICBkb21haW4gPSB1cmxwYXJzZSh1cmwpLm5ldGxvYwogICAgICAgIHRpbWVzdGFtcCA9IGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWSVtJWRfJUglTSVTIikKICAgICAgICBkaXJlY3RvcnkgPSBmImV4cGxvaXRzX3tkb21haW59X3t0aW1lc3RhbXB9IgoKICAgICAgICBvcy5tYWtlZGlycyhkaXJlY3RvcnksIGV4aXN0X29rPVRydWUpCgogICAgICAgIGZvciBpLCBleHBsb2l0IGluIGVudW1lcmF0ZShleHBsb2l0cyk6CiAgICAgICAgICAgIHZ1bG5fdHlwZSA9IGV4cGxvaXRbInZ1bG5lcmFiaWxpdHkiXS5sb3dlcigpLnJlcGxhY2UoIiAiLCAiXyIpCiAgICAgICAgICAgIGZpbGVuYW1lID0gZiJ7ZGlyZWN0b3J5fS97dnVsbl90eXBlfV9leHBsb2l0LnB5IgoKICAgICAgICAgICAgd2l0aCBvcGVuKGZpbGVuYW1lLCAidyIsIGVuY29kaW5nPSJ1dGYtOCIpIGFzIGY6CiAgICAgICAgICAgICAgICBpZiAicG9jIiBpbiBleHBsb2l0OgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoZXhwbG9pdFsicG9jIl0pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIGYud3JpdGUoc2VsZi5leHBsb2l0X3NjYW5uZXIuZ2VuZXJhdGVfZ2VuZXJpY19wb2ModXJsLCBleHBsb2l0WyJ2dWxuZXJhYmlsaXR5Il0pKQoKICAgICAgICBwcmludChmIlxuWytdINCt0LrRgdC/0LvQvtC50YLRiyDRgdC+0YXRgNCw0L3QtdC90Ysg0LIge2RpcmVjdG9yeX0iKQoKICAgIGRlZiBnZW5lcmF0ZV9leHBsb2l0cyhzZWxmKToKICAgICAgICBjbGVhcl9zY3JlZW4oKQogICAgICAgIGRpc3BsYXlfYmFubmVyKCkKCiAgICAgICAgcHJpbnQoIlsqXSDQktCy0LXQtNC4IFVSTCDRgdCw0LnRgtCwINC00LvRjyDQs9C10L3QtdGA0LDRhtC40Lgg0Y3QutGB0L/Qu9C+0LnRgtC+0LI6IikKICAgICAgICB1cmwgPSBpbnB1dCgiPj4+ICIpCgogICAgICAgIGlmIG5vdCB1cmw6CiAgICAgICAgICAgIHByaW50KCJbLV0gVVJMINC90LUg0LzQvtC20LXRgiDQsdGL0YLRjCDQv9GD0YHRgtGL0LwiKQogICAgICAgICAgICBpbnB1dCgiXG7QltC80LggRW50ZXIg0YfRgtC+0LEg0LLQtdGA0L3Rg9GC0YzRgdGPLi4uIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHVybCA9IHBhcnNlX3VybCh1cmwpCgogICAgICAgIHByaW50KGYiXG5bKl0g0KHQutCw0L3QuNGA0YPQtdC8INGD0Y/Qt9Cy0LjQvNC+0YHRgtC4INC00LvRjyB7dXJsfS4uLlxuIikKCiAgICAgICAgd2ViX3NjYW5uZXIgPSBXZWJTY2FubmVyKCkKICAgICAgICBzY2FuX3Jlc3VsdHMgPSB3ZWJfc2Nhbm5lci5zY2FuX3dlYnNpdGUodXJsKQoKICAgICAgICBzZWN1cml0eV9zY2FubmVyID0gU2VjdXJpdHlTY2FubmVyKCkKICAgICAgICB2dWxuX3Jlc3VsdHMgPSBzZWN1cml0eV9zY2FubmVyLnNjYW5fdnVsbmVyYWJpbGl0aWVzKHVybCwgc2Nhbl9yZXN1bHRzKQoKICAgICAgICBwcmludCgiXG5bKl0g0JPQtdC90LXRgNC40YDRg9C10Lwg0Y3QutGB0L/Qu9C+0LnRgtGLLi4uIikKCiAgICAgICAgZXhwbG9pdF9zY2FubmVyID0gRXhwbG9pdFNjYW5uZXIoKQogICAgICAgIGV4cGxvaXRzID0gZXhwbG9pdF9zY2FubmVyLmV4cGxvaXRfdnVsbmVyYWJpbGl0aWVzKHVybCwgdnVsbl9yZXN1bHRzKQoKICAgICAgICBpZiBleHBsb2l0czoKICAgICAgICAgICAgcHJpbnQoIlxuWytdINCh0LPQtdC90LXRgNC40YDQvtCy0LDQvdC90YvQtSDRjdC60YHQv9C70L7QudGC0Ys6IikKICAgICAgICAgICAgZm9yIGV4cGxvaXQgaW4gZXhwbG9pdHM6CiAgICAgICAgICAgICAgICBwcmludChmIiAgLSB7ZXhwbG9pdFsndnVsbmVyYWJpbGl0eSddfToge2V4cGxvaXQuZ2V0KCd1cmwnLCB1cmwpfSIpCgogICAgICAgICAgICBwcmludCgiXG5bKl0g0KHQvtGF0YDQsNC90LjRgtGMINGN0LrRgdC/0LvQvtC50YLRiz8gKHkvbikiKQogICAgICAgICAgICBzYXZlX2V4cGxvaXRzID0gaW5wdXQoIj4+PiAiKS5sb3dlcigpID09ICd5JwoKICAgICAgICAgICAgaWYgc2F2ZV9leHBsb2l0czoKICAgICAgICAgICAgICAgIHNlbGYuc2F2ZV9leHBsb2l0cyh1cmwsIGV4cGxvaXRzKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHByaW50KCJcblstXSDQndC1INGD0LTQsNC70L7RgdGMINGB0LPQtdC90LXRgNC40YDQvtCy0LDRgtGMINGN0LrRgdC/0LvQvtC50YLRiyIpCgogICAgICAgIGlucHV0KCJcbtCW0LzQuCBFbnRlciDRh9GC0L7QsSDQstC10YDQvdGD0YLRjNGB0Y8uLi4iKQoKCmRlZiBtYWluKCk6CiAgICB0cnk6CiAgICAgICAgdG9vbCA9IFBlbnRlc3RUb29sKCkKICAgICAgICB0b29sLm1haW5fbWVudSgpCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgcHJpbnQoIlxuXG5bKl0g0JLRi9GF0L7QtCDQuNC3INC/0YDQvtCz0YDQsNC80LzRiy4uLiIpCiAgICAgICAgc3lzLmV4aXQoMCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBwcmludChmIlxuWy1dINCe0YjQuNCx0LrQsDoge3N0cihlKX0iKQogICAgICAgIHN5cy5leGl0KDEpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIG1haW4oKQ==').decode('utf-8'))